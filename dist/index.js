!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).SplitPolygonMode={})}(this,(function(e){"use strict";function t(e){if(!e)throw new Error("geojson is required");switch(e.type){case"Feature":return n(e);case"FeatureCollection":return function(e){var t={type:"FeatureCollection"};return Object.keys(e).forEach((function(n){switch(n){case"type":case"features":return;default:t[n]=e[n]}})),t.features=e.features.map((function(e){return n(e)})),t}(e);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return i(e);default:throw new Error("unknown GeoJSON type")}}function n(e){var t={type:"Feature"};return Object.keys(e).forEach((function(n){switch(n){case"type":case"properties":case"geometry":return;default:t[n]=e[n]}})),t.properties=r(e.properties),t.geometry=i(e.geometry),t}function r(e){var t={};return e?(Object.keys(e).forEach((function(n){var i=e[n];"object"==typeof i?null===i?t[n]=null:Array.isArray(i)?t[n]=i.map((function(e){return e})):t[n]=r(i):t[n]=i})),t):t}function i(e){var t={type:e.type};return e.bbox&&(t.bbox=e.bbox),"GeometryCollection"===e.type?(t.geometries=e.geometries.map((function(e){return i(e)})),t):(t.coordinates=o(e.coordinates),t)}function o(e){var t=e;return"object"!=typeof t[0]?t.slice():t.map((function(e){return o(e)}))}function s(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if("Feature"===e.type&&null!==e.geometry&&"Point"===e.geometry.type)return e.geometry.coordinates;if("Point"===e.type)return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function l(e){if(Array.isArray(e))return e;if("Feature"===e.type){if(null!==e.geometry)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function u(e){return"Feature"===e.type?e.geometry:e}function a(e){for(var t,n,r=l(e),i=0,o=1;o<r.length;)t=n||r[0],i+=((n=r[o])[0]-t[0])*(n[1]+t[1]),o++;return i>0}function c(e,t,n){if(null!==e)for(var r,i,o,s,l,u,a,h,f=0,p=0,g=e.type,y="FeatureCollection"===g,d="Feature"===g,m=y?e.features.length:1,v=0;v<m;v++){l=(h=!!(a=y?e.features[v].geometry:d?e.geometry:e)&&"GeometryCollection"===a.type)?a.geometries.length:1;for(var w=0;w<l;w++){var b=0,x=0;if(null!==(s=h?a.geometries[w]:a)){u=s.coordinates;var E=s.type;switch(f=!n||"Polygon"!==E&&"MultiPolygon"!==E?0:1,E){case null:break;case"Point":if(!1===t(u,p,v,b,x))return!1;p++,b++;break;case"LineString":case"MultiPoint":for(r=0;r<u.length;r++){if(!1===t(u[r],p,v,b,x))return!1;p++,"MultiPoint"===E&&b++}"LineString"===E&&b++;break;case"Polygon":case"MultiLineString":for(r=0;r<u.length;r++){for(i=0;i<u[r].length-f;i++){if(!1===t(u[r][i],p,v,b,x))return!1;p++}"MultiLineString"===E&&b++,"Polygon"===E&&x++}"Polygon"===E&&b++;break;case"MultiPolygon":for(r=0;r<u.length;r++){for(x=0,i=0;i<u[r].length;i++){for(o=0;o<u[r][i].length-f;o++){if(!1===t(u[r][i][o],p,v,b,x))return!1;p++}x++}b++}break;case"GeometryCollection":for(r=0;r<s.geometries.length;r++)if(!1===c(s.geometries[r],t,n))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function h(e,t){if("Feature"===e.type)t(e,0);else if("FeatureCollection"===e.type)for(var n=0;n<e.features.length&&!1!==t(e.features[n],n);n++);}function f(e,t){var n,r,i,o,s,l,u,a,c,h,f=0,p="FeatureCollection"===e.type,g="Feature"===e.type,y=p?e.features.length:1;for(n=0;n<y;n++){for(l=p?e.features[n].geometry:g?e.geometry:e,a=p?e.features[n].properties:g?e.properties:{},c=p?e.features[n].bbox:g?e.bbox:void 0,h=p?e.features[n].id:g?e.id:void 0,s=(u=!!l&&"GeometryCollection"===l.type)?l.geometries.length:1,i=0;i<s;i++)if(null!==(o=u?l.geometries[i]:l))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(o,f,a,c,h))return!1;break;case"GeometryCollection":for(r=0;r<o.geometries.length;r++)if(!1===t(o.geometries[r],f,a,c,h))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===t(null,f,a,c,h))return!1;f++}}function p(e,n){if(!(r=n=n||{})||r.constructor!==Object)throw new Error("options is invalid");var r,i=n.reverse||!1,o=n.mutate||!1;if(!e)throw new Error("<geojson> is required");if("boolean"!=typeof i)throw new Error("<reverse> must be a boolean");if("boolean"!=typeof o)throw new Error("<mutate> must be a boolean");!1===o&&(e=t(e));var s=[];switch(e.type){case"GeometryCollection":return f(e,(function(e){g(e,i)})),e;case"FeatureCollection":return h(e,(function(e){h(g(e,i),(function(e){s.push(e)}))})),function(e,t){void 0===t&&(t={});var n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}(s)}return g(e,i)}function g(e,t){switch("Feature"===e.type?e.geometry.type:e.type){case"GeometryCollection":return f(e,(function(e){g(e,t)})),e;case"LineString":return y(l(e),t),e;case"Polygon":return d(l(e),t),e;case"MultiLineString":return l(e).forEach((function(e){y(e,t)})),e;case"MultiPolygon":return l(e).forEach((function(e){d(e,t)})),e;case"Point":case"MultiPoint":return e}}function y(e,t){a(e)===t&&e.reverse()}function d(e,t){a(e[0])!==t&&e[0].reverse();for(var n=1;n<e.length;n++)a(e[n])===t&&e[n].reverse()}function m(e,t){for(var n=0,r=0,i=0,o=0,s=0,l=0,u=0,a=0,c=null,h=null,f=e[0],p=e[1],g=t.length;n<g;n++){r=0;var y=t[n].length-1,d=t[n];if((c=d[0])[0]!==d[y][0]&&c[1]!==d[y][1])throw new Error("First and last coordinates in a ring must be the same");for(s=c[0]-f,l=c[1]-p;r<y;r++)if(a=(h=d[r+1])[1]-p,l<0&&a<0||l>0&&a>0)l=a,s=(c=h)[0]-f;else{if(u=h[0]-e[0],a>0&&l<=0){if((o=s*a-u*l)>0)i+=1;else if(0===o)return 0}else if(l>0&&a<=0){if((o=s*a-u*l)<0)i+=1;else if(0===o)return 0}else if(0===a&&l<0){if(0===(o=s*a-u*l))return 0}else if(0===l&&a<0){if(0===(o=s*a-u*l))return 0}else if(0===l&&0===a){if(u<=0&&s>=0)return 0;if(s<=0&&u>=0)return 0}c=h,l=a,s=u}}return i%2!=0}const v=134217729;function w(e,t,n,r,i){let o,s,l,u,a=t[0],c=r[0],h=0,f=0;c>a==c>-a?(o=a,a=t[++h]):(o=c,c=r[++f]);let p=0;if(h<e&&f<n)for(c>a==c>-a?(s=a+o,l=o-(s-a),a=t[++h]):(s=c+o,l=o-(s-c),c=r[++f]),o=s,0!==l&&(i[p++]=l);h<e&&f<n;)c>a==c>-a?(s=o+a,u=s-o,l=o-(s-u)+(a-u),a=t[++h]):(s=o+c,u=s-o,l=o-(s-u)+(c-u),c=r[++f]),o=s,0!==l&&(i[p++]=l);for(;h<e;)s=o+a,u=s-o,l=o-(s-u)+(a-u),a=t[++h],o=s,0!==l&&(i[p++]=l);for(;f<n;)s=o+c,u=s-o,l=o-(s-u)+(c-u),c=r[++f],o=s,0!==l&&(i[p++]=l);return 0===o&&0!==p||(i[p++]=o),p}function b(e){return new Float64Array(e)}const x=b(4),E=b(8),S=b(12),P=b(16),C=b(4);function M(e,t,n,r,i,o){const s=(t-o)*(n-i),l=(e-i)*(r-o),u=s-l;if(0===s||0===l||s>0!=l>0)return u;const a=Math.abs(s+l);return Math.abs(u)>=33306690738754716e-32*a?u:-function(e,t,n,r,i,o,s){let l,u,a,c,h,f,p,g,y,d,m,b,M,L,I,F,_,T;const O=e-i,k=n-i,A=t-o,R=r-o;L=O*R,f=v*O,p=f-(f-O),g=O-p,f=v*R,y=f-(f-R),d=R-y,I=g*d-(L-p*y-g*y-p*d),F=A*k,f=v*A,p=f-(f-A),g=A-p,f=v*k,y=f-(f-k),d=k-y,_=g*d-(F-p*y-g*y-p*d),m=I-_,h=I-m,x[0]=I-(m+h)+(h-_),b=L+m,h=b-L,M=L-(b-h)+(m-h),m=M-F,h=M-m,x[1]=M-(m+h)+(h-F),T=b+m,h=T-b,x[2]=b-(T-h)+(m-h),x[3]=T;let N=function(e,t){let n=t[0];for(let r=1;r<e;r++)n+=t[r];return n}(4,x),G=22204460492503146e-32*s;if(N>=G||-N>=G)return N;if(h=e-O,l=e-(O+h)+(h-i),h=n-k,a=n-(k+h)+(h-i),h=t-A,u=t-(A+h)+(h-o),h=r-R,c=r-(R+h)+(h-o),0===l&&0===u&&0===a&&0===c)return N;if(G=11093356479670487e-47*s+33306690738754706e-32*Math.abs(N),N+=O*c+R*l-(A*a+k*u),N>=G||-N>=G)return N;L=l*R,f=v*l,p=f-(f-l),g=l-p,f=v*R,y=f-(f-R),d=R-y,I=g*d-(L-p*y-g*y-p*d),F=u*k,f=v*u,p=f-(f-u),g=u-p,f=v*k,y=f-(f-k),d=k-y,_=g*d-(F-p*y-g*y-p*d),m=I-_,h=I-m,C[0]=I-(m+h)+(h-_),b=L+m,h=b-L,M=L-(b-h)+(m-h),m=M-F,h=M-m,C[1]=M-(m+h)+(h-F),T=b+m,h=T-b,C[2]=b-(T-h)+(m-h),C[3]=T;const B=w(4,x,4,C,E);L=O*c,f=v*O,p=f-(f-O),g=O-p,f=v*c,y=f-(f-c),d=c-y,I=g*d-(L-p*y-g*y-p*d),F=A*a,f=v*A,p=f-(f-A),g=A-p,f=v*a,y=f-(f-a),d=a-y,_=g*d-(F-p*y-g*y-p*d),m=I-_,h=I-m,C[0]=I-(m+h)+(h-_),b=L+m,h=b-L,M=L-(b-h)+(m-h),m=M-F,h=M-m,C[1]=M-(m+h)+(h-F),T=b+m,h=T-b,C[2]=b-(T-h)+(m-h),C[3]=T;const D=w(B,E,4,C,S);L=l*c,f=v*l,p=f-(f-l),g=l-p,f=v*c,y=f-(f-c),d=c-y,I=g*d-(L-p*y-g*y-p*d),F=u*a,f=v*u,p=f-(f-u),g=u-p,f=v*a,y=f-(f-a),d=a-y,_=g*d-(F-p*y-g*y-p*d),m=I-_,h=I-m,C[0]=I-(m+h)+(h-_),b=L+m,h=b-L,M=L-(b-h)+(m-h),m=M-F,h=M-m,C[1]=M-(m+h)+(h-F),T=b+m,h=T-b,C[2]=b-(T-h)+(m-h),C[3]=T;const U=w(D,S,4,C,P);return P[U-1]}(e,t,n,r,i,o,a)}var L=function(e,t,n,r,i){this.p1=e,this.p2=t,this.edgeType=n,this.originalIndex=r,this.polygonContourId=i,this.interiorRing=!1,this.minX=Math.min(e.p[0],t.p[0]),this.minY=Math.min(e.p[1],t.p[1]),this.maxX=Math.max(e.p[0],t.p[0]),this.maxY=Math.max(e.p[1],t.p[1]),this.intersectionPoints=[],this.nextEdge=null},I=function(e){this.p=e},F=function(e,t){this.id=e,this.rawCoords=t};function _(e,t){return!(e.maxX<t[0])&&(!(e.minX>t[2])&&(!(e.maxY<t[1])&&!(e.minY>t[3])))}var T=function(e,t,n,r){this.p=e,this.polylineEdge=t,this.polygonEdge=n,this.isHeadingIn=r,this.distanceFromPolylineEdgeStart=O(this.polylineEdge.p1.p,this.p),this.distanceFromPolygonEdgeStart=O(this.polygonEdge.p1.p,this.p),this.polygonEdge.intersectionPoints.push(this),this.polylineEdge.intersectionPoints.push(this),this.visitCount=0};function O(e,t){var n=t[0]-e[0],r=t[1]-e[1];return n*=n,r*=r,Math.sqrt(n+r)}T.prototype.incrementVisitCount=function(){this.visitCount=this.visitCount+1};function k(e,t){return e[0]*t[1]-e[1]*t[0]}function A(e,t){return e[0]*t[0]+e[1]*t[1]}function R(e,t,n){return[e[0]+t*n[0],e[1]+t*n[1]]}function N(e,t,n){var r=[e.p2.p[0]-e.p1.p[0],e.p2.p[1]-e.p1.p[1]],i=[t.p2.p[0]-t.p1.p[0],t.p2.p[1]-t.p1.p[1]],o=[t.p1.p[0]-e.p1.p[0],t.p1.p[1]-e.p1.p[1]],s=k(r,i),l=s*s,u=A(r,r);if(l>0){var a=k(o,i)/s;if(a<0||a>1)return null;var c=k(o,r)/s;return c<0||c>1?null:0===a||1===a?n?null:[R(e.p1.p,a,r)]:0===c||1===c?n?null:[R(t.p1.p,c,i)]:[R(e.p1.p,a,r)]}var h=A(o,o);if((l=(s=k(o,r))*s)>1e-9*u*h)return null;var f=A(r,o)/u,p=f+A(r,i)/u,g=Math.min(f,p),y=Math.max(f,p);return g<=1&&y>=0?1===g?n?null:[R(e.p1.p,g>0?g:0,r)]:0===y?n?null:[R(e.p1.p,y<1?y:1,r)]:n&&0===g&&1===y?null:[R(e.p1.p,g>0?g:0,r),R(e.p1.p,y<1?y:1,r)]:null}function G(e,t){var n=[],r=[],i=[],o=function(e,t,n,r,i){for(var o=0,s=[],l="Feature"===t.type?t.geometry:t,u="LineString"===l.type?[l.coordinates]:l.coordinates,a=0,c=0;c<u.length;c++){for(var h=u[c].length-1,f=new I(u[c][0]),p=null,g={nextEdge:null},y=0;y<h;y++){p=new I(u[c][y+1]),f.nextPoint=p,p.prevPoint=f;var d=new L(f,p,"polyline",a,null);r.push(d),g.nextEdge=d,d.prevEdge=g,i[0]=Math.min(i[0],f.p[0]),i[1]=Math.min(i[1],f.p[1]),i[2]=Math.max(i[2],f.p[0]),i[3]=Math.max(i[3],f.p[1]),f=p,a+=1,g=d}i[0]=Math.min(i[0],u[c][h][0]),i[1]=Math.min(i[1],u[c][h][1]),i[2]=Math.max(i[2],u[c][h][0]),i[3]=Math.max(i[3],u[c][h][1])}for(var m="Feature"===e.type?e.geometry:e,v="Polygon"===m.type?[m.coordinates]:m.coordinates,w=v.length,b=0;b<w;b++)for(var x=v[b].length,E=0;E<x;E++){o+=1;var S=v[b][E],P=S.length;s.push(new F(o,S));for(var C=new I(S[0]),M=C,T=void 0,O=null,k={nextEdge:null,prevEdge:null},A=null,R=1;R<P;R++)T=new I(S[R]),M.nextPoint=T,T.prevPoint=M,O=new L(M,T,"polygon",a,o),k.nextEdge=O,O.prevEdge=k,1===R&&(A=O),E>0&&(O.interiorRing=!0),O.intersectPolylineBbox=_(O,i),n.push(O),M=T,a+=1,k=O;O.nextEdge=A,A.prevEdge=O,T.nextPoint=C.nextPoint,C.prevPoint=T.prevPoint}return s}(p(e),t,r,i,[1/0,1/0,1/0,1/0]);if(function(e,t,n){var r,i,o,s=t.length,l=e.length;for(r=0;r<s;r++){var u=t[r];for(i=0;i<l;i++){var a=e[i];if(a.intersectPolylineBbox&&!(a.maxX<u.minX||a.minX>u.maxX||a.maxY<u.minY||a.minY>u.maxY)){var c=N(u,a);if(null!==c)for(o=0;o<c.length;o++){var h=M(a.p1.p[0],a.p1.p[1],a.p2.p[0],a.p2.p[1],u.p1.p[0],u.p1.p[1]),f=new T(c[o],u,a,h>0);n.push(f)}}}}t.forEach((function(e){e.intersectionPoints.sort((function(e,t){return e.distanceFromPolylineEdgeStart-t.distanceFromPolylineEdgeStart}))})),e.forEach((function(e){e.intersectionPoints.sort((function(e,t){return e.distanceFromPolygonEdgeStart-t.distanceFromPolygonEdgeStart}))}))}(r,i,n),0===n.length)return e;var s={};o.forEach((function(e){return s[e.id]=0})),n.forEach((function(e){var t=e.polygonEdge.polygonContourId;s[t]=s[t]+1}));for(var l=0,u=[],a=null,c=0;c<i.length;c++){var h=i[c];if(h.intersectionPoints.length>0){a=h.intersectionPoints[0];break}}for(var f=a,g={visitCount:1};a!==g&&!(l>2*n.length);){if(l=l++,g.visitCount>=2){for(var y=!1,d=0;d<n.length;d++){var m=n[d];if(m.visitCount<2){f=m,y=!0;break}}if(!y)break}f.visitCount=f.visitCount+1;var v=[];u.push(v),v.push(f.p),f.visitCount=f.visitCount+1;var w=q(f,v),b=!1;if(w===(g=w)&&2===n.length)for(var x=0;x<n.length;x++){n[x].visitCount<2&&(b=!0)}for(;w!==f||b;){(w=(w.isHeadingIn?$:j)(w,v))!==f&&(w=q(w,v)),b=!1}if(g.visitCount>=2){for(var E=!1,S=0;S<n.length;S++){var P=n[S];if(P.visitCount<2){f=P,E=!0;break}}E&&(g=f)}f=g}for(var C=u.map((function(e){return[e]})),O=Object.keys(s),k=0;k<O.length;k++){var A=O[k];if(0===s[A])U(D(B(r,parseInt(A)),o),C)}return{type:"Feature",properties:{},geometry:{type:"MultiPolygon",coordinates:C}}}function B(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(r.polygonContourId===t)return r}}function D(e,t){return t.find((function(t){return t.id===e.polygonContourId})).rawCoords}function U(e,t){for(var n=0;n<t.length;n++){var r=t[n];if(m(e[0],[r[0]]))return void r.push(e)}t.push([e])}function q(e,t){var n=e.polygonEdge;if(n.intersectionPoints.length>1&&n.intersectionPoints[n.intersectionPoints.length-1]!==e){var r=V(e,n.intersectionPoints),i=n.intersectionPoints[r+1];return t.push(i.p),i.incrementVisitCount(),i}for(var o=!0;o;){if(t.push(n.p2.p),null===(n=n.nextEdge))return e;n.intersectionPoints.length>0&&(o=!1)}return n.intersectionPoints[0].incrementVisitCount(),t.push(n.intersectionPoints[0].p),n.intersectionPoints[0]}function V(e,t){for(var n=0;n<t.length;n++){if(t[n]===e)return n}return null}function j(e,t){var n=e.polylineEdge;if(2===n.intersectionPoints.length){var r=n.intersectionPoints[n.intersectionPoints.length-1];if(r===e){var i=n.intersectionPoints[0];return t.push(i.p),i.incrementVisitCount(),i}return t.push(r.p),r.incrementVisitCount(),r}if(n.intersectionPoints.length>2&&n.intersectionPoints[0]!==e){var o=V(e,n.intersectionPoints),s=n.intersectionPoints[o-1];return t.push(s.p),s.incrementVisitCount(),s}for(var l=!0;l;){if(t.push(n.p1.p),void 0===(n=n.prevEdge).originalIndex)return e;n.intersectionPoints.length>0&&(l=!1)}if(void 0===n.originalIndex)return e;var u=n.intersectionPoints[n.intersectionPoints.length-1];return u.incrementVisitCount(),t.push(u.p),u}function $(e,t){var n=e.polylineEdge;if(n.intersectionPoints.length>1&&n.intersectionPoints[n.intersectionPoints.length-1]!==e){var r=V(e,n.intersectionPoints),i=n.intersectionPoints[r+1];return t.push(i.p),i.incrementVisitCount(),i}for(var o=!0;o;){if(t.push(n.p2.p),null===(n=n.nextEdge))return e;n.intersectionPoints.length>0&&(o=!1)}if(void 0===n)return e;var s=n.intersectionPoints[0];return s.incrementVisitCount(),t.push(s.p),s}const z="add",Y="move",W="pointer",H="none",J="polygon",K="line_string",Z="point",X="Feature",Q="Polygon",ee="LineString",te="Point",ne="MultiPolygon",re="simple_select",ie="draw.create",oe="draw.update",se="feature",le="vertex",ue="true",ae="false";var ce=6371008.8,he={centimeters:637100880,centimetres:637100880,degrees:360/(2*Math.PI),feet:20902260.511392,inches:39.37*ce,kilometers:6371.0088,kilometres:6371.0088,meters:ce,metres:ce,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:ce/1852,radians:1,yards:6967335.223679999};function fe(e,t,n={}){const r={type:"Feature"};return(0===n.id||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=t||{},r.geometry=e,r}function pe(e,t,n={}){for(const t of e){if(t.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(t[t.length-1].length!==t[0].length)throw new Error("First and last Position are not equivalent.");for(let e=0;e<t[t.length-1].length;e++)if(t[t.length-1][e]!==t[0][e])throw new Error("First and last Position are not equivalent.")}return fe({type:"Polygon",coordinates:e},t,n)}function ge(e,t,n={}){if(e.length<2)throw new Error("coordinates must be an array of two or more positions");return fe({type:"LineString",coordinates:e},t,n)}function ye(e,t={}){const n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=e,n}function de(e,t,n={}){return fe({type:"MultiLineString",coordinates:e},t,n)}function me(e,t,n={}){return fe({type:"MultiPolygon",coordinates:e},t,n)}function ve(e,t){return n=function(e,t="kilometers"){const n=he[t];if(!n)throw new Error(t+" units is invalid");return e/n}(e,t),n%(2*Math.PI)*180/Math.PI;var n}function we(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}class be{constructor(e=[],t=xe){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let e=(this.length>>1)-1;e>=0;e--)this._down(e)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:n}=this,r=t[e];for(;e>0;){const i=e-1>>1,o=t[i];if(n(r,o)>=0)break;t[e]=o,e=i}t[e]=r}_down(e){const{data:t,compare:n}=this,r=this.length>>1,i=t[e];for(;e<r;){let r=1+(e<<1),o=t[r];const s=r+1;if(s<this.length&&n(t[s],o)<0&&(r=s,o=t[s]),n(o,i)>=0)break;t[e]=o,e=r}t[e]=i}}function xe(e,t){return e<t?-1:e>t?1:0}function Ee(e,t){return e.p.x>t.p.x?1:e.p.x<t.p.x?-1:e.p.y!==t.p.y?e.p.y>t.p.y?1:-1:1}function Se(e,t){return e.rightSweepEvent.p.x>t.rightSweepEvent.p.x?1:e.rightSweepEvent.p.x<t.rightSweepEvent.p.x?-1:e.rightSweepEvent.p.y!==t.rightSweepEvent.p.y?e.rightSweepEvent.p.y<t.rightSweepEvent.p.y?1:-1:1}class Pe{constructor(e,t,n,r){this.p={x:e[0],y:e[1]},this.featureId=t,this.ringId=n,this.eventId=r,this.otherEvent=null,this.isLeftEndpoint=null}isSamePoint(e){return this.p.x===e.p.x&&this.p.y===e.p.y}}let Ce=0,Me=0,Le=0;function Ie(e,t){const n="Feature"===e.type?e.geometry:e;let r=n.coordinates;"Polygon"!==n.type&&"MultiLineString"!==n.type||(r=[r]),"LineString"===n.type&&(r=[[r]]);for(let e=0;e<r.length;e++)for(let n=0;n<r[e].length;n++){let i=r[e][n][0],o=null;Me+=1;for(let s=0;s<r[e][n].length-1;s++){o=r[e][n][s+1];const l=new Pe(i,Ce,Me,Le),u=new Pe(o,Ce,Me,Le+1);l.otherEvent=u,u.otherEvent=l,Ee(l,u)>0?(u.isLeftEndpoint=!0,l.isLeftEndpoint=!1):(l.isLeftEndpoint=!0,u.isLeftEndpoint=!1),t.push(l),t.push(u),i=o,Le+=1}}Ce+=1}let Fe=class{constructor(e){this.leftSweepEvent=e,this.rightSweepEvent=e.otherEvent}};function _e(e,t){if(null===e||null===t)return!1;if(e.leftSweepEvent.ringId===t.leftSweepEvent.ringId&&(e.rightSweepEvent.isSamePoint(t.leftSweepEvent)||e.rightSweepEvent.isSamePoint(t.leftSweepEvent)||e.rightSweepEvent.isSamePoint(t.rightSweepEvent)||e.leftSweepEvent.isSamePoint(t.leftSweepEvent)||e.leftSweepEvent.isSamePoint(t.rightSweepEvent)))return!1;const n=e.leftSweepEvent.p.x,r=e.leftSweepEvent.p.y,i=e.rightSweepEvent.p.x,o=e.rightSweepEvent.p.y,s=t.leftSweepEvent.p.x,l=t.leftSweepEvent.p.y,u=t.rightSweepEvent.p.x,a=t.rightSweepEvent.p.y,c=(a-l)*(i-n)-(u-s)*(o-r),h=(u-s)*(r-l)-(a-l)*(n-s),f=(i-n)*(r-l)-(o-r)*(n-s);if(0===c)return!1;const p=h/c,g=f/c;if(p>=0&&p<=1&&g>=0&&g<=1){return[n+p*(i-n),r+p*(o-r)]}return!1}var Te=function(e,t){const n=new be([],Ee);return function(e,t){if("FeatureCollection"===e.type){const n=e.features;for(let e=0;e<n.length;e++)Ie(n[e],t)}else Ie(e,t)}(e,n),function(e,t){t=t||!1;const n=[],r=new be([],Se);for(;e.length;){const i=e.pop();if(i.isLeftEndpoint){const e=new Fe(i);for(let o=0;o<r.data.length;o++){const s=r.data[o];if(t&&s.leftSweepEvent.featureId===i.featureId)continue;const l=_e(e,s);!1!==l&&n.push(l)}r.push(e)}else!1===i.isLeftEndpoint&&r.pop()}return n}(n,t)};function Oe(e,t,n={}){const{removeDuplicates:r=!0,ignoreSelfIntersections:i=!0}=n;let o=[];"FeatureCollection"===e.type?o=o.concat(e.features):"Feature"===e.type?o.push(e):"LineString"!==e.type&&"Polygon"!==e.type&&"MultiLineString"!==e.type&&"MultiPolygon"!==e.type||o.push(fe(e)),"FeatureCollection"===t.type?o=o.concat(t.features):"Feature"===t.type?o.push(t):"LineString"!==t.type&&"Polygon"!==t.type&&"MultiLineString"!==t.type&&"MultiPolygon"!==t.type||o.push(fe(t));const s=Te(ye(o),i);let l=[];if(r){const e={};s.forEach((t=>{const n=t.join(",");e[n]||(e[n]=!0,l.push(t))}))}else l=s;return ye(l.map((e=>function(e,t,n={}){if(!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!we(e[0])||!we(e[1]))throw new Error("coordinates must contain numbers");return fe({type:"Point",coordinates:e},t,n)}(e))))}var ke=Oe;function Ae(e){return"Feature"===e.type?e.geometry:e}function Re(e,t,n={}){if(!e)throw new Error("point is required");if(!t)throw new Error("polygon is required");const r=function(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if("Feature"===e.type&&null!==e.geometry&&"Point"===e.geometry.type)return[...e.geometry.coordinates];if("Point"===e.type)return[...e.coordinates]}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return[...e];throw new Error("coord must be GeoJSON Point or an Array of numbers")}(e),i=Ae(t),o=i.type,s=t.bbox;let l=i.coordinates;if(s&&!1===function(e,t){return t[0]<=e[0]&&t[1]<=e[1]&&t[2]>=e[0]&&t[3]>=e[1]}(r,s))return!1;"Polygon"===o&&(l=[l]);let u=!1;for(var a=0;a<l.length;++a){const e=m(r,l[a]);if(0===e)return!n.ignoreBoundary;e&&(u=!0)}return u}function Ne(e,t){!function(e,t){var n,r,i,o,s,l,u,a,c,h,f=0,p="FeatureCollection"===e.type,g="Feature"===e.type,y=p?e.features.length:1;for(n=0;n<y;n++){for(l=p?e.features[n].geometry:g?e.geometry:e,a=p?e.features[n].properties:g?e.properties:{},c=p?e.features[n].bbox:g?e.bbox:void 0,h=p?e.features[n].id:g?e.id:void 0,s=(u=!!l&&"GeometryCollection"===l.type)?l.geometries.length:1,i=0;i<s;i++)if(null!==(o=u?l.geometries[i]:l))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(o,f,a,c,h))return!1;break;case"GeometryCollection":for(r=0;r<o.geometries.length;r++)if(!1===t(o.geometries[r],f,a,c,h))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===t(null,f,a,c,h))return!1;f++}}(e,(function(e,n,r,i,o){var s,l=null===e?null:e.type;switch(l){case null:case"Point":case"LineString":case"Polygon":return!1!==t(fe(e,r,{bbox:i,id:o}),n,0)&&void 0}switch(l){case"MultiPoint":s="Point";break;case"MultiLineString":s="LineString";break;case"MultiPolygon":s="Polygon"}for(var u=0;u<e.coordinates.length;u++){var a=e.coordinates[u];if(!1===t(fe({type:s,coordinates:a},r),n,u))return!1}}))}function Ge(e,t={}){const n=Ae(e);switch(t.properties||"Feature"!==e.type||(t.properties=e.properties),n.type){case"Polygon":return function(e,t={}){const n=Ae(e).coordinates,r=t.properties?t.properties:"Feature"===e.type?e.properties:{};return Be(n,r)}(n,t);case"MultiPolygon":return function(e,t={}){const n=Ae(e).coordinates,r=t.properties?t.properties:"Feature"===e.type?e.properties:{},i=[];return n.forEach((e=>{i.push(Be(e,r))})),ye(i)}(n,t);default:throw new Error("invalid poly")}}function Be(e,t){return e.length>1?de(e,t):ge(e[0],t)}function De(e,t){for(let n=0;n<e.coordinates.length-1;n++)if(qe(e.coordinates[n],e.coordinates[n+1],t.coordinates))return!0;return!1}function Ue(e,t,n){for(const n of t.coordinates)if(Re(n,e))return!0;return Oe(t,Ge(e),{ignoreSelfIntersections:n}).features.length>0}function qe(e,t,n){const r=n[0]-e[0],i=n[1]-e[1],o=t[0]-e[0],s=t[1]-e[1];return 0==r*s-i*o&&(Math.abs(o)>=Math.abs(s)?o>0?e[0]<=n[0]&&n[0]<=t[0]:t[0]<=n[0]&&n[0]<=e[0]:s>0?e[1]<=n[1]&&n[1]<=t[1]:t[1]<=n[1]&&n[1]<=e[1])}var Ve=function(e,t,{ignoreSelfIntersections:n=!0}={ignoreSelfIntersections:!0}){let r=!0;return Ne(e,(e=>{Ne(t,(t=>{if(!1===r)return!1;r=function(e,t,n){switch(e.type){case"Point":switch(t.type){case"Point":return r=e.coordinates,i=t.coordinates,!(r[0]===i[0]&&r[1]===i[1]);case"LineString":return!De(t,e);case"Polygon":return!Re(e,t)}break;case"LineString":switch(t.type){case"Point":return!De(e,t);case"LineString":return!function(e,t,n){if(Oe(e,t,{ignoreSelfIntersections:n}).features.length>0)return!0;return!1}(e,t,n);case"Polygon":return!Ue(t,e,n)}break;case"Polygon":switch(t.type){case"Point":return!Re(t,e);case"LineString":return!Ue(e,t,n);case"Polygon":return!function(e,t,n){for(const n of e.coordinates[0])if(Re(n,t))return!0;for(const n of t.coordinates[0])if(Re(n,e))return!0;if(Oe(Ge(e),Ge(t),{ignoreSelfIntersections:n}).features.length>0)return!0;return!1}(t,e,n)}}var r,i;return!1}(e.geometry,t.geometry,n)}))})),r};function je(e,t){!function(e,t){var n,r,i,o,s,l,u,a,c,h,f=0,p="FeatureCollection"===e.type,g="Feature"===e.type,y=p?e.features.length:1;for(n=0;n<y;n++){for(l=p?e.features[n].geometry:g?e.geometry:e,a=p?e.features[n].properties:g?e.properties:{},c=p?e.features[n].bbox:g?e.bbox:void 0,h=p?e.features[n].id:g?e.id:void 0,s=(u=!!l&&"GeometryCollection"===l.type)?l.geometries.length:1,i=0;i<s;i++)if(null!==(o=u?l.geometries[i]:l))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(o,f,a,c,h))return!1;break;case"GeometryCollection":for(r=0;r<o.geometries.length;r++)if(!1===t(o.geometries[r],f,a,c,h))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===t(null,f,a,c,h))return!1;f++}}(e,(function(e,n,r,i,o){var s,l=null===e?null:e.type;switch(l){case null:case"Point":case"LineString":case"Polygon":return!1!==t(fe(e,r,{bbox:i,id:o}),n,0)&&void 0}switch(l){case"MultiPoint":s="Point";break;case"MultiLineString":s="LineString";break;case"MultiPolygon":s="Polygon"}for(var u=0;u<e.coordinates.length;u++){var a=e.coordinates[u];if(!1===t(fe({type:s,coordinates:a},r),n,u))return!1}}))}function $e(e){var t=e[0],n=e[1];return[n[0]-t[0],n[1]-t[1]]}function ze(e,t){return e[0]*t[1]-t[0]*e[1]}function Ye(e,t){return!function(e,t){return 0===ze($e(e),$e(t))}(e,t)&&function(e,t){var n,r,i=e[0],o=$e(e),s=t[0],l=$e(t),u=ze(o,l),a=function(e,t){return[e[0]+t[0],e[1]+t[1]]}(i,function(e,t){return[e*t[0],e*t[1]]}(ze((r=i,[(n=s)[0]-r[0],n[1]-r[1]]),l)/u,o));return a}(e,t)}function We(e,t,n){var r=[],i=ve(t,n),o=function(e){if(Array.isArray(e))return e;if("Feature"===e.type){if(null!==e.geometry)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}(e),s=[];return o.forEach((function(e,t){if(t!==o.length-1){var n=(a=e,c=o[t+1],h=i,f=Math.sqrt((a[0]-c[0])*(a[0]-c[0])+(a[1]-c[1])*(a[1]-c[1])),p=a[0]+h*(c[1]-a[1])/f,g=c[0]+h*(c[1]-a[1])/f,y=a[1]+h*(a[0]-c[0])/f,d=c[1]+h*(a[0]-c[0])/f,[[p,y],[g,d]]);if(r.push(n),t>0){var l=r[t-1],u=Ye(n,l);!1!==u&&(l[1]=u,n[0]=u),s.push(l[0]),t===o.length-2&&(s.push(n[0]),s.push(n[1]))}2===o.length&&(s.push(n[0]),s.push(n[1]))}var a,c,h,f,p,g,y,d})),ge(s,e.properties)}var He=function(e,t,n){if(null===(r=n=n||{})||"object"!=typeof r||Array.isArray(r))throw new Error("options is invalid");var r,i=n.units;if(!e)throw new Error("geojson is required");if(null==t||isNaN(t))throw new Error("distance is required");var o=function(e,t){return"FeatureCollection"===e.type?"FeatureCollection":"GeometryCollection"===e.type?"GeometryCollection":"Feature"===e.type&&null!==e.geometry?e.geometry.type:e.type}(e),s=e.properties;switch(o){case"LineString":return We(e,t,i);case"MultiLineString":var l=[];return je(e,(function(e){l.push(We(e,t,i).geometry.coordinates)})),de(l,s);default:throw new Error("geometry "+o+" is not supported")}};function Je(e,t,n){if(null!==e)for(var r,i,o,s,l,u,a,c,h=0,f=0,p=e.type,g="FeatureCollection"===p,y="Feature"===p,d=g?e.features.length:1,m=0;m<d;m++){l=(c=!!(a=g?e.features[m].geometry:y?e.geometry:e)&&"GeometryCollection"===a.type)?a.geometries.length:1;for(var v=0;v<l;v++){var w=0,b=0;if(null!==(s=c?a.geometries[v]:a)){u=s.coordinates;var x=s.type;switch(h=!n||"Polygon"!==x&&"MultiPolygon"!==x?0:1,x){case null:break;case"Point":if(!1===t(u,f,m,w,b))return!1;f++,w++;break;case"LineString":case"MultiPoint":for(r=0;r<u.length;r++){if(!1===t(u[r],f,m,w,b))return!1;f++,"MultiPoint"===x&&w++}"LineString"===x&&w++;break;case"Polygon":case"MultiLineString":for(r=0;r<u.length;r++){for(i=0;i<u[r].length-h;i++){if(!1===t(u[r][i],f,m,w,b))return!1;f++}"MultiLineString"===x&&w++,"Polygon"===x&&b++}"Polygon"===x&&w++;break;case"MultiPolygon":for(r=0;r<u.length;r++){for(b=0,i=0;i<u[r].length;i++){for(o=0;o<u[r][i].length-h;o++){if(!1===t(u[r][i][o],f,m,w,b))return!1;f++}b++}w++}break;case"GeometryCollection":for(r=0;r<s.geometries.length;r++)if(!1===Je(s.geometries[r],t,n))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Ke(e,t={}){if(null!=e.bbox&&!0!==t.recompute)return e.bbox;const n=[1/0,1/0,-1/0,-1/0];return Je(e,(e=>{n[0]>e[0]&&(n[0]=e[0]),n[1]>e[1]&&(n[1]=e[1]),n[2]<e[0]&&(n[2]=e[0]),n[3]<e[1]&&(n[3]=e[1])})),n}function Ze(e){if(!e)throw new Error("geojson is required");switch(e.type){case"Feature":return Xe(e);case"FeatureCollection":return function(e){const t={type:"FeatureCollection"};return Object.keys(e).forEach((n=>{switch(n){case"type":case"features":return;default:t[n]=e[n]}})),t.features=e.features.map((e=>Xe(e))),t}(e);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return et(e);default:throw new Error("unknown GeoJSON type")}}function Xe(e){const t={type:"Feature"};return Object.keys(e).forEach((n=>{switch(n){case"type":case"properties":case"geometry":return;default:t[n]=e[n]}})),t.properties=Qe(e.properties),null==e.geometry?t.geometry=null:t.geometry=et(e.geometry),t}function Qe(e){const t={};return e?(Object.keys(e).forEach((n=>{const r=e[n];"object"==typeof r?null===r?t[n]=null:Array.isArray(r)?t[n]=r.map((e=>e)):t[n]=Qe(r):t[n]=r})),t):t}function et(e){const t={type:e.type};return e.bbox&&(t.bbox=e.bbox),"GeometryCollection"===e.type?(t.geometries=e.geometries.map((e=>et(e))),t):(t.coordinates=tt(e.coordinates),t)}function tt(e){const t=e;return"object"!=typeof t[0]?t.slice():t.map((e=>tt(e)))}function nt(e,t,n,r){t=t||("Feature"===e.type?e.properties:{});var i,o="Feature"===(i=e).type?i.geometry:i,s=o.coordinates,l=o.type;if(!s.length)throw new Error("line must contain coordinates");switch(l){case"LineString":return n&&(s=rt(s)),pe([s],t);case"MultiLineString":var u=[],a=0;return s.forEach((function(e){if(n&&(e=rt(e)),r){var t=function(e){var t=e[0],n=e[1],r=e[2],i=e[3];return Math.abs(t-r)*Math.abs(n-i)}(Ke(ge(e)));t>a?(u.unshift(e),a=t):u.push(e)}else u.push(e)})),pe(u,t);default:throw new Error("geometry type "+l+" is not supported")}}function rt(e){var t=e[0],n=t[0],r=t[1],i=e[e.length-1],o=i[0],s=i[1];return n===o&&r===s||e.push(t),e}var it=function(e,t={}){var n,r,i,o=t.properties,s=null==(n=t.autoComplete)||n,l=null==(r=t.orderCoords)||r;if(null!=(i=t.mutate)&&i||(e=Ze(e)),"FeatureCollection"===e.type){var u=[];return e.features.forEach((function(e){u.push(function(e){if(Array.isArray(e))return e;if("Feature"===e.type){if(null!==e.geometry)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}(nt(e,{},s,l)))})),me(u,o)}return nt(e,o,s,l)},ot=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,st=Math.ceil,lt=Math.floor,ut="[BigNumber Error] ",at=ut+"Number primitive has more than 15 significant digits: ",ct=1e14,ht=14,ft=9007199254740991,pt=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13],gt=1e7,yt=1e9;function dt(e){var t=0|e;return e>0||e===t?t:t-1}function mt(e){for(var t,n,r=1,i=e.length,o=e[0]+"";r<i;){for(t=e[r++]+"",n=ht-t.length;n--;t="0"+t);o+=t}for(i=o.length;48===o.charCodeAt(--i););return o.slice(0,i+1||1)}function vt(e,t){var n,r,i=e.c,o=t.c,s=e.s,l=t.s,u=e.e,a=t.e;if(!s||!l)return null;if(n=i&&!i[0],r=o&&!o[0],n||r)return n?r?0:-l:s;if(s!=l)return s;if(n=s<0,r=u==a,!i||!o)return r?0:!i^n?1:-1;if(!r)return u>a^n?1:-1;for(l=(u=i.length)<(a=o.length)?u:a,s=0;s<l;s++)if(i[s]!=o[s])return i[s]>o[s]^n?1:-1;return u==a?0:u>a^n?1:-1}function wt(e,t,n,r){if(e<t||e>n||e!==lt(e))throw Error(ut+(r||"Argument")+("number"==typeof e?e<t||e>n?" out of range: ":" not an integer: ":" not a primitive number: ")+String(e))}function bt(e){var t=e.c.length-1;return dt(e.e/ht)==t&&e.c[t]%2!=0}function xt(e,t){return(e.length>1?e.charAt(0)+"."+e.slice(1):e)+(t<0?"e":"e+")+t}function Et(e,t,n){var r,i;if(t<0){for(i=n+".";++t;i+=n);e=i+e}else if(++t>(r=e.length)){for(i=n,t-=r;--t;i+=n);e+=i}else t<r&&(e=e.slice(0,t)+"."+e.slice(t));return e}var St=function e(t){var n,r,i,o,s,l,u,a,c,h,f=M.prototype={constructor:M,toString:null,valueOf:null},p=new M(1),g=20,y=4,d=-7,m=21,v=-1e7,w=1e7,b=!1,x=1,E=0,S={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:" ",suffix:""},P="0123456789abcdefghijklmnopqrstuvwxyz",C=!0;function M(e,t){var n,o,s,l,u,a,c,h,f=this;if(!(f instanceof M))return new M(e,t);if(null==t){if(e&&!0===e._isBigNumber)return f.s=e.s,void(!e.c||e.e>w?f.c=f.e=null:e.e<v?f.c=[f.e=0]:(f.e=e.e,f.c=e.c.slice()));if((a="number"==typeof e)&&0*e==0){if(f.s=1/e<0?(e=-e,-1):1,e===~~e){for(l=0,u=e;u>=10;u/=10,l++);return void(l>w?f.c=f.e=null:(f.e=l,f.c=[e]))}h=String(e)}else{if(!ot.test(h=String(e)))return i(f,h,a);f.s=45==h.charCodeAt(0)?(h=h.slice(1),-1):1}(l=h.indexOf("."))>-1&&(h=h.replace(".","")),(u=h.search(/e/i))>0?(l<0&&(l=u),l+=+h.slice(u+1),h=h.substring(0,u)):l<0&&(l=h.length)}else{if(wt(t,2,P.length,"Base"),10==t&&C)return _(f=new M(e),g+f.e+1,y);if(h=String(e),a="number"==typeof e){if(0*e!=0)return i(f,h,a,t);if(f.s=1/e<0?(h=h.slice(1),-1):1,M.DEBUG&&h.replace(/^0\.0*|\./,"").length>15)throw Error(at+e)}else f.s=45===h.charCodeAt(0)?(h=h.slice(1),-1):1;for(n=P.slice(0,t),l=u=0,c=h.length;u<c;u++)if(n.indexOf(o=h.charAt(u))<0){if("."==o){if(u>l){l=c;continue}}else if(!s&&(h==h.toUpperCase()&&(h=h.toLowerCase())||h==h.toLowerCase()&&(h=h.toUpperCase()))){s=!0,u=-1,l=0;continue}return i(f,String(e),a,t)}a=!1,(l=(h=r(h,t,10,f.s)).indexOf("."))>-1?h=h.replace(".",""):l=h.length}for(u=0;48===h.charCodeAt(u);u++);for(c=h.length;48===h.charCodeAt(--c););if(h=h.slice(u,++c)){if(c-=u,a&&M.DEBUG&&c>15&&(e>ft||e!==lt(e)))throw Error(at+f.s*e);if((l=l-u-1)>w)f.c=f.e=null;else if(l<v)f.c=[f.e=0];else{if(f.e=l,f.c=[],u=(l+1)%ht,l<0&&(u+=ht),u<c){for(u&&f.c.push(+h.slice(0,u)),c-=ht;u<c;)f.c.push(+h.slice(u,u+=ht));u=ht-(h=h.slice(u)).length}else u-=c;for(;u--;h+="0");f.c.push(+h)}}else f.c=[f.e=0]}function L(e,t,n,r){var i,o,s,l,u;if(null==n?n=y:wt(n,0,8),!e.c)return e.toString();if(i=e.c[0],s=e.e,null==t)u=mt(e.c),u=1==r||2==r&&(s<=d||s>=m)?xt(u,s):Et(u,s,"0");else if(o=(e=_(new M(e),t,n)).e,l=(u=mt(e.c)).length,1==r||2==r&&(t<=o||o<=d)){for(;l<t;u+="0",l++);u=xt(u,o)}else if(t-=s,u=Et(u,o,"0"),o+1>l){if(--t>0)for(u+=".";t--;u+="0");}else if((t+=o-l)>0)for(o+1==l&&(u+=".");t--;u+="0");return e.s<0&&i?"-"+u:u}function I(e,t){for(var n,r,i=1,o=new M(e[0]);i<e.length;i++)(!(r=new M(e[i])).s||(n=vt(o,r))===t||0===n&&o.s===t)&&(o=r);return o}function F(e,t,n){for(var r=1,i=t.length;!t[--i];t.pop());for(i=t[0];i>=10;i/=10,r++);return(n=r+n*ht-1)>w?e.c=e.e=null:n<v?e.c=[e.e=0]:(e.e=n,e.c=t),e}function _(e,t,n,r){var i,o,s,l,u,a,c,h=e.c,f=pt;if(h){e:{for(i=1,l=h[0];l>=10;l/=10,i++);if((o=t-i)<0)o+=ht,s=t,u=h[a=0],c=lt(u/f[i-s-1]%10);else if((a=st((o+1)/ht))>=h.length){if(!r)break e;for(;h.length<=a;h.push(0));u=c=0,i=1,s=(o%=ht)-ht+1}else{for(u=l=h[a],i=1;l>=10;l/=10,i++);c=(s=(o%=ht)-ht+i)<0?0:lt(u/f[i-s-1]%10)}if(r=r||t<0||null!=h[a+1]||(s<0?u:u%f[i-s-1]),r=n<4?(c||r)&&(0==n||n==(e.s<0?3:2)):c>5||5==c&&(4==n||r||6==n&&(o>0?s>0?u/f[i-s]:0:h[a-1])%10&1||n==(e.s<0?8:7)),t<1||!h[0])return h.length=0,r?(t-=e.e+1,h[0]=f[(ht-t%ht)%ht],e.e=-t||0):h[0]=e.e=0,e;if(0==o?(h.length=a,l=1,a--):(h.length=a+1,l=f[ht-o],h[a]=s>0?lt(u/f[i-s]%f[s])*l:0),r)for(;;){if(0==a){for(o=1,s=h[0];s>=10;s/=10,o++);for(s=h[0]+=l,l=1;s>=10;s/=10,l++);o!=l&&(e.e++,h[0]==ct&&(h[0]=1));break}if(h[a]+=l,h[a]!=ct)break;h[a--]=0,l=1}for(o=h.length;0===h[--o];h.pop());}e.e>w?e.c=e.e=null:e.e<v&&(e.c=[e.e=0])}return e}function T(e){var t,n=e.e;return null===n?e.toString():(t=mt(e.c),t=n<=d||n>=m?xt(t,n):Et(t,n,"0"),e.s<0?"-"+t:t)}return M.clone=e,M.ROUND_UP=0,M.ROUND_DOWN=1,M.ROUND_CEIL=2,M.ROUND_FLOOR=3,M.ROUND_HALF_UP=4,M.ROUND_HALF_DOWN=5,M.ROUND_HALF_EVEN=6,M.ROUND_HALF_CEIL=7,M.ROUND_HALF_FLOOR=8,M.EUCLID=9,M.config=M.set=function(e){var t,n;if(null!=e){if("object"!=typeof e)throw Error(ut+"Object expected: "+e);if(e.hasOwnProperty(t="DECIMAL_PLACES")&&(wt(n=e[t],0,yt,t),g=n),e.hasOwnProperty(t="ROUNDING_MODE")&&(wt(n=e[t],0,8,t),y=n),e.hasOwnProperty(t="EXPONENTIAL_AT")&&((n=e[t])&&n.pop?(wt(n[0],-yt,0,t),wt(n[1],0,yt,t),d=n[0],m=n[1]):(wt(n,-yt,yt,t),d=-(m=n<0?-n:n))),e.hasOwnProperty(t="RANGE"))if((n=e[t])&&n.pop)wt(n[0],-yt,-1,t),wt(n[1],1,yt,t),v=n[0],w=n[1];else{if(wt(n,-yt,yt,t),!n)throw Error(ut+t+" cannot be zero: "+n);v=-(w=n<0?-n:n)}if(e.hasOwnProperty(t="CRYPTO")){if((n=e[t])!==!!n)throw Error(ut+t+" not true or false: "+n);if(n){if("undefined"==typeof crypto||!crypto||!crypto.getRandomValues&&!crypto.randomBytes)throw b=!n,Error(ut+"crypto unavailable");b=n}else b=n}if(e.hasOwnProperty(t="MODULO_MODE")&&(wt(n=e[t],0,9,t),x=n),e.hasOwnProperty(t="POW_PRECISION")&&(wt(n=e[t],0,yt,t),E=n),e.hasOwnProperty(t="FORMAT")){if("object"!=typeof(n=e[t]))throw Error(ut+t+" not an object: "+n);S=n}if(e.hasOwnProperty(t="ALPHABET")){if("string"!=typeof(n=e[t])||/^.?$|[+\-.\s]|(.).*\1/.test(n))throw Error(ut+t+" invalid: "+n);C="0123456789"==n.slice(0,10),P=n}}return{DECIMAL_PLACES:g,ROUNDING_MODE:y,EXPONENTIAL_AT:[d,m],RANGE:[v,w],CRYPTO:b,MODULO_MODE:x,POW_PRECISION:E,FORMAT:S,ALPHABET:P}},M.isBigNumber=function(e){if(!e||!0!==e._isBigNumber)return!1;if(!M.DEBUG)return!0;var t,n,r=e.c,i=e.e,o=e.s;e:if("[object Array]"=={}.toString.call(r)){if((1===o||-1===o)&&i>=-yt&&i<=yt&&i===lt(i)){if(0===r[0]){if(0===i&&1===r.length)return!0;break e}if((t=(i+1)%ht)<1&&(t+=ht),String(r[0]).length==t){for(t=0;t<r.length;t++)if((n=r[t])<0||n>=ct||n!==lt(n))break e;if(0!==n)return!0}}}else if(null===r&&null===i&&(null===o||1===o||-1===o))return!0;throw Error(ut+"Invalid BigNumber: "+e)},M.maximum=M.max=function(){return I(arguments,-1)},M.minimum=M.min=function(){return I(arguments,1)},M.random=(o=9007199254740992,s=Math.random()*o&2097151?function(){return lt(Math.random()*o)}:function(){return 8388608*(1073741824*Math.random()|0)+(8388608*Math.random()|0)},function(e){var t,n,r,i,o,l=0,u=[],a=new M(p);if(null==e?e=g:wt(e,0,yt),i=st(e/ht),b)if(crypto.getRandomValues){for(t=crypto.getRandomValues(new Uint32Array(i*=2));l<i;)(o=131072*t[l]+(t[l+1]>>>11))>=9e15?(n=crypto.getRandomValues(new Uint32Array(2)),t[l]=n[0],t[l+1]=n[1]):(u.push(o%1e14),l+=2);l=i/2}else{if(!crypto.randomBytes)throw b=!1,Error(ut+"crypto unavailable");for(t=crypto.randomBytes(i*=7);l<i;)(o=281474976710656*(31&t[l])+1099511627776*t[l+1]+4294967296*t[l+2]+16777216*t[l+3]+(t[l+4]<<16)+(t[l+5]<<8)+t[l+6])>=9e15?crypto.randomBytes(7).copy(t,l):(u.push(o%1e14),l+=7);l=i/7}if(!b)for(;l<i;)(o=s())<9e15&&(u[l++]=o%1e14);for(i=u[--l],e%=ht,i&&e&&(o=pt[ht-e],u[l]=lt(i/o)*o);0===u[l];u.pop(),l--);if(l<0)u=[r=0];else{for(r=-1;0===u[0];u.splice(0,1),r-=ht);for(l=1,o=u[0];o>=10;o/=10,l++);l<ht&&(r-=ht-l)}return a.e=r,a.c=u,a}),M.sum=function(){for(var e=1,t=arguments,n=new M(t[0]);e<t.length;)n=n.plus(t[e++]);return n},r=function(){var e="0123456789";function t(e,t,n,r){for(var i,o,s=[0],l=0,u=e.length;l<u;){for(o=s.length;o--;s[o]*=t);for(s[0]+=r.indexOf(e.charAt(l++)),i=0;i<s.length;i++)s[i]>n-1&&(null==s[i+1]&&(s[i+1]=0),s[i+1]+=s[i]/n|0,s[i]%=n)}return s.reverse()}return function(r,i,o,s,l){var u,a,c,h,f,p,d,m,v=r.indexOf("."),w=g,b=y;for(v>=0&&(h=E,E=0,r=r.replace(".",""),p=(m=new M(i)).pow(r.length-v),E=h,m.c=t(Et(mt(p.c),p.e,"0"),10,o,e),m.e=m.c.length),c=h=(d=t(r,i,o,l?(u=P,e):(u=e,P))).length;0==d[--h];d.pop());if(!d[0])return u.charAt(0);if(v<0?--c:(p.c=d,p.e=c,p.s=s,d=(p=n(p,m,w,b,o)).c,f=p.r,c=p.e),v=d[a=c+w+1],h=o/2,f=f||a<0||null!=d[a+1],f=b<4?(null!=v||f)&&(0==b||b==(p.s<0?3:2)):v>h||v==h&&(4==b||f||6==b&&1&d[a-1]||b==(p.s<0?8:7)),a<1||!d[0])r=f?Et(u.charAt(1),-w,u.charAt(0)):u.charAt(0);else{if(d.length=a,f)for(--o;++d[--a]>o;)d[a]=0,a||(++c,d=[1].concat(d));for(h=d.length;!d[--h];);for(v=0,r="";v<=h;r+=u.charAt(d[v++]));r=Et(r,c,u.charAt(0))}return r}}(),n=function(){function e(e,t,n){var r,i,o,s,l=0,u=e.length,a=t%gt,c=t/gt|0;for(e=e.slice();u--;)l=((i=a*(o=e[u]%gt)+(r=c*o+(s=e[u]/gt|0)*a)%gt*gt+l)/n|0)+(r/gt|0)+c*s,e[u]=i%n;return l&&(e=[l].concat(e)),e}function t(e,t,n,r){var i,o;if(n!=r)o=n>r?1:-1;else for(i=o=0;i<n;i++)if(e[i]!=t[i]){o=e[i]>t[i]?1:-1;break}return o}function n(e,t,n,r){for(var i=0;n--;)e[n]-=i,i=e[n]<t[n]?1:0,e[n]=i*r+e[n]-t[n];for(;!e[0]&&e.length>1;e.splice(0,1));}return function(r,i,o,s,l){var u,a,c,h,f,p,g,y,d,m,v,w,b,x,E,S,P,C=r.s==i.s?1:-1,L=r.c,I=i.c;if(!(L&&L[0]&&I&&I[0]))return new M(r.s&&i.s&&(L?!I||L[0]!=I[0]:I)?L&&0==L[0]||!I?0*C:C/0:NaN);for(d=(y=new M(C)).c=[],C=o+(a=r.e-i.e)+1,l||(l=ct,a=dt(r.e/ht)-dt(i.e/ht),C=C/ht|0),c=0;I[c]==(L[c]||0);c++);if(I[c]>(L[c]||0)&&a--,C<0)d.push(1),h=!0;else{for(x=L.length,S=I.length,c=0,C+=2,(f=lt(l/(I[0]+1)))>1&&(I=e(I,f,l),L=e(L,f,l),S=I.length,x=L.length),b=S,v=(m=L.slice(0,S)).length;v<S;m[v++]=0);P=I.slice(),P=[0].concat(P),E=I[0],I[1]>=l/2&&E++;do{if(f=0,(u=t(I,m,S,v))<0){if(w=m[0],S!=v&&(w=w*l+(m[1]||0)),(f=lt(w/E))>1)for(f>=l&&(f=l-1),g=(p=e(I,f,l)).length,v=m.length;1==t(p,m,g,v);)f--,n(p,S<g?P:I,g,l),g=p.length,u=1;else 0==f&&(u=f=1),g=(p=I.slice()).length;if(g<v&&(p=[0].concat(p)),n(m,p,v,l),v=m.length,-1==u)for(;t(I,m,S,v)<1;)f++,n(m,S<v?P:I,v,l),v=m.length}else 0===u&&(f++,m=[0]);d[c++]=f,m[0]?m[v++]=L[b]||0:(m=[L[b]],v=1)}while((b++<x||null!=m[0])&&C--);h=null!=m[0],d[0]||d.splice(0,1)}if(l==ct){for(c=1,C=d[0];C>=10;C/=10,c++);_(y,o+(y.e=c+a*ht-1)+1,s,h)}else y.e=a,y.r=+h;return y}}(),l=/^(-?)0([xbo])(?=\w[\w.]*$)/i,u=/^([^.]+)\.$/,a=/^\.([^.]+)$/,c=/^-?(Infinity|NaN)$/,h=/^\s*\+(?=[\w.])|^\s+|\s+$/g,i=function(e,t,n,r){var i,o=n?t:t.replace(h,"");if(c.test(o))e.s=isNaN(o)?null:o<0?-1:1;else{if(!n&&(o=o.replace(l,(function(e,t,n){return i="x"==(n=n.toLowerCase())?16:"b"==n?2:8,r&&r!=i?e:t})),r&&(i=r,o=o.replace(u,"$1").replace(a,"0.$1")),t!=o))return new M(o,i);if(M.DEBUG)throw Error(ut+"Not a"+(r?" base "+r:"")+" number: "+t);e.s=null}e.c=e.e=null},f.absoluteValue=f.abs=function(){var e=new M(this);return e.s<0&&(e.s=1),e},f.comparedTo=function(e,t){return vt(this,new M(e,t))},f.decimalPlaces=f.dp=function(e,t){var n,r,i,o=this;if(null!=e)return wt(e,0,yt),null==t?t=y:wt(t,0,8),_(new M(o),e+o.e+1,t);if(!(n=o.c))return null;if(r=((i=n.length-1)-dt(this.e/ht))*ht,i=n[i])for(;i%10==0;i/=10,r--);return r<0&&(r=0),r},f.dividedBy=f.div=function(e,t){return n(this,new M(e,t),g,y)},f.dividedToIntegerBy=f.idiv=function(e,t){return n(this,new M(e,t),0,1)},f.exponentiatedBy=f.pow=function(e,t){var n,r,i,o,s,l,u,a,c=this;if((e=new M(e)).c&&!e.isInteger())throw Error(ut+"Exponent not an integer: "+T(e));if(null!=t&&(t=new M(t)),s=e.e>14,!c.c||!c.c[0]||1==c.c[0]&&!c.e&&1==c.c.length||!e.c||!e.c[0])return a=new M(Math.pow(+T(c),s?e.s*(2-bt(e)):+T(e))),t?a.mod(t):a;if(l=e.s<0,t){if(t.c?!t.c[0]:!t.s)return new M(NaN);(r=!l&&c.isInteger()&&t.isInteger())&&(c=c.mod(t))}else{if(e.e>9&&(c.e>0||c.e<-1||(0==c.e?c.c[0]>1||s&&c.c[1]>=24e7:c.c[0]<8e13||s&&c.c[0]<=9999975e7)))return o=c.s<0&&bt(e)?-0:0,c.e>-1&&(o=1/o),new M(l?1/o:o);E&&(o=st(E/ht+2))}for(s?(n=new M(.5),l&&(e.s=1),u=bt(e)):u=(i=Math.abs(+T(e)))%2,a=new M(p);;){if(u){if(!(a=a.times(c)).c)break;o?a.c.length>o&&(a.c.length=o):r&&(a=a.mod(t))}if(i){if(0===(i=lt(i/2)))break;u=i%2}else if(_(e=e.times(n),e.e+1,1),e.e>14)u=bt(e);else{if(0===(i=+T(e)))break;u=i%2}c=c.times(c),o?c.c&&c.c.length>o&&(c.c.length=o):r&&(c=c.mod(t))}return r?a:(l&&(a=p.div(a)),t?a.mod(t):o?_(a,E,y,undefined):a)},f.integerValue=function(e){var t=new M(this);return null==e?e=y:wt(e,0,8),_(t,t.e+1,e)},f.isEqualTo=f.eq=function(e,t){return 0===vt(this,new M(e,t))},f.isFinite=function(){return!!this.c},f.isGreaterThan=f.gt=function(e,t){return vt(this,new M(e,t))>0},f.isGreaterThanOrEqualTo=f.gte=function(e,t){return 1===(t=vt(this,new M(e,t)))||0===t},f.isInteger=function(){return!!this.c&&dt(this.e/ht)>this.c.length-2},f.isLessThan=f.lt=function(e,t){return vt(this,new M(e,t))<0},f.isLessThanOrEqualTo=f.lte=function(e,t){return-1===(t=vt(this,new M(e,t)))||0===t},f.isNaN=function(){return!this.s},f.isNegative=function(){return this.s<0},f.isPositive=function(){return this.s>0},f.isZero=function(){return!!this.c&&0==this.c[0]},f.minus=function(e,t){var n,r,i,o,s=this,l=s.s;if(t=(e=new M(e,t)).s,!l||!t)return new M(NaN);if(l!=t)return e.s=-t,s.plus(e);var u=s.e/ht,a=e.e/ht,c=s.c,h=e.c;if(!u||!a){if(!c||!h)return c?(e.s=-t,e):new M(h?s:NaN);if(!c[0]||!h[0])return h[0]?(e.s=-t,e):new M(c[0]?s:3==y?-0:0)}if(u=dt(u),a=dt(a),c=c.slice(),l=u-a){for((o=l<0)?(l=-l,i=c):(a=u,i=h),i.reverse(),t=l;t--;i.push(0));i.reverse()}else for(r=(o=(l=c.length)<(t=h.length))?l:t,l=t=0;t<r;t++)if(c[t]!=h[t]){o=c[t]<h[t];break}if(o&&(i=c,c=h,h=i,e.s=-e.s),(t=(r=h.length)-(n=c.length))>0)for(;t--;c[n++]=0);for(t=ct-1;r>l;){if(c[--r]<h[r]){for(n=r;n&&!c[--n];c[n]=t);--c[n],c[r]+=ct}c[r]-=h[r]}for(;0==c[0];c.splice(0,1),--a);return c[0]?F(e,c,a):(e.s=3==y?-1:1,e.c=[e.e=0],e)},f.modulo=f.mod=function(e,t){var r,i,o=this;return e=new M(e,t),!o.c||!e.s||e.c&&!e.c[0]?new M(NaN):!e.c||o.c&&!o.c[0]?new M(o):(9==x?(i=e.s,e.s=1,r=n(o,e,0,3),e.s=i,r.s*=i):r=n(o,e,0,x),(e=o.minus(r.times(e))).c[0]||1!=x||(e.s=o.s),e)},f.multipliedBy=f.times=function(e,t){var n,r,i,o,s,l,u,a,c,h,f,p,g,y,d,m=this,v=m.c,w=(e=new M(e,t)).c;if(!(v&&w&&v[0]&&w[0]))return!m.s||!e.s||v&&!v[0]&&!w||w&&!w[0]&&!v?e.c=e.e=e.s=null:(e.s*=m.s,v&&w?(e.c=[0],e.e=0):e.c=e.e=null),e;for(r=dt(m.e/ht)+dt(e.e/ht),e.s*=m.s,(u=v.length)<(h=w.length)&&(g=v,v=w,w=g,i=u,u=h,h=i),i=u+h,g=[];i--;g.push(0));for(y=ct,d=gt,i=h;--i>=0;){for(n=0,f=w[i]%d,p=w[i]/d|0,o=i+(s=u);o>i;)n=((a=f*(a=v[--s]%d)+(l=p*a+(c=v[s]/d|0)*f)%d*d+g[o]+n)/y|0)+(l/d|0)+p*c,g[o--]=a%y;g[o]=n}return n?++r:g.splice(0,1),F(e,g,r)},f.negated=function(){var e=new M(this);return e.s=-e.s||null,e},f.plus=function(e,t){var n,r=this,i=r.s;if(t=(e=new M(e,t)).s,!i||!t)return new M(NaN);if(i!=t)return e.s=-t,r.minus(e);var o=r.e/ht,s=e.e/ht,l=r.c,u=e.c;if(!o||!s){if(!l||!u)return new M(i/0);if(!l[0]||!u[0])return u[0]?e:new M(l[0]?r:0*i)}if(o=dt(o),s=dt(s),l=l.slice(),i=o-s){for(i>0?(s=o,n=u):(i=-i,n=l),n.reverse();i--;n.push(0));n.reverse()}for((i=l.length)-(t=u.length)<0&&(n=u,u=l,l=n,t=i),i=0;t;)i=(l[--t]=l[t]+u[t]+i)/ct|0,l[t]=ct===l[t]?0:l[t]%ct;return i&&(l=[i].concat(l),++s),F(e,l,s)},f.precision=f.sd=function(e,t){var n,r,i,o=this;if(null!=e&&e!==!!e)return wt(e,1,yt),null==t?t=y:wt(t,0,8),_(new M(o),e,t);if(!(n=o.c))return null;if(r=(i=n.length-1)*ht+1,i=n[i]){for(;i%10==0;i/=10,r--);for(i=n[0];i>=10;i/=10,r++);}return e&&o.e+1>r&&(r=o.e+1),r},f.shiftedBy=function(e){return wt(e,-9007199254740991,ft),this.times("1e"+e)},f.squareRoot=f.sqrt=function(){var e,t,r,i,o,s=this,l=s.c,u=s.s,a=s.e,c=g+4,h=new M("0.5");if(1!==u||!l||!l[0])return new M(!u||u<0&&(!l||l[0])?NaN:l?s:1/0);if(0==(u=Math.sqrt(+T(s)))||u==1/0?(((t=mt(l)).length+a)%2==0&&(t+="0"),u=Math.sqrt(+t),a=dt((a+1)/2)-(a<0||a%2),r=new M(t=u==1/0?"5e"+a:(t=u.toExponential()).slice(0,t.indexOf("e")+1)+a)):r=new M(u+""),r.c[0])for((u=(a=r.e)+c)<3&&(u=0);;)if(o=r,r=h.times(o.plus(n(s,o,c,1))),mt(o.c).slice(0,u)===(t=mt(r.c)).slice(0,u)){if(r.e<a&&--u,"9999"!=(t=t.slice(u-3,u+1))&&(i||"4999"!=t)){+t&&(+t.slice(1)||"5"!=t.charAt(0))||(_(r,r.e+g+2,1),e=!r.times(r).eq(s));break}if(!i&&(_(o,o.e+g+2,0),o.times(o).eq(s))){r=o;break}c+=4,u+=4,i=1}return _(r,r.e+g+1,y,e)},f.toExponential=function(e,t){return null!=e&&(wt(e,0,yt),e++),L(this,e,t,1)},f.toFixed=function(e,t){return null!=e&&(wt(e,0,yt),e=e+this.e+1),L(this,e,t)},f.toFormat=function(e,t,n){var r,i=this;if(null==n)null!=e&&t&&"object"==typeof t?(n=t,t=null):e&&"object"==typeof e?(n=e,e=t=null):n=S;else if("object"!=typeof n)throw Error(ut+"Argument not an object: "+n);if(r=i.toFixed(e,t),i.c){var o,s=r.split("."),l=+n.groupSize,u=+n.secondaryGroupSize,a=n.groupSeparator||"",c=s[0],h=s[1],f=i.s<0,p=f?c.slice(1):c,g=p.length;if(u&&(o=l,l=u,u=o,g-=o),l>0&&g>0){for(o=g%l||l,c=p.substr(0,o);o<g;o+=l)c+=a+p.substr(o,l);u>0&&(c+=a+p.slice(o)),f&&(c="-"+c)}r=h?c+(n.decimalSeparator||"")+((u=+n.fractionGroupSize)?h.replace(new RegExp("\\d{"+u+"}\\B","g"),"$&"+(n.fractionGroupSeparator||"")):h):c}return(n.prefix||"")+r+(n.suffix||"")},f.toFraction=function(e){var t,r,i,o,s,l,u,a,c,h,f,g,d=this,m=d.c;if(null!=e&&(!(u=new M(e)).isInteger()&&(u.c||1!==u.s)||u.lt(p)))throw Error(ut+"Argument "+(u.isInteger()?"out of range: ":"not an integer: ")+T(u));if(!m)return new M(d);for(t=new M(p),c=r=new M(p),i=a=new M(p),g=mt(m),s=t.e=g.length-d.e-1,t.c[0]=pt[(l=s%ht)<0?ht+l:l],e=!e||u.comparedTo(t)>0?s>0?t:c:u,l=w,w=1/0,u=new M(g),a.c[0]=0;h=n(u,t,0,1),1!=(o=r.plus(h.times(i))).comparedTo(e);)r=i,i=o,c=a.plus(h.times(o=c)),a=o,t=u.minus(h.times(o=t)),u=o;return o=n(e.minus(r),i,0,1),a=a.plus(o.times(c)),r=r.plus(o.times(i)),a.s=c.s=d.s,f=n(c,i,s*=2,y).minus(d).abs().comparedTo(n(a,r,s,y).minus(d).abs())<1?[c,i]:[a,r],w=l,f},f.toNumber=function(){return+T(this)},f.toPrecision=function(e,t){return null!=e&&wt(e,1,yt),L(this,e,t,2)},f.toString=function(e){var t,n=this,i=n.s,o=n.e;return null===o?i?(t="Infinity",i<0&&(t="-"+t)):t="NaN":(null==e?t=o<=d||o>=m?xt(mt(n.c),o):Et(mt(n.c),o,"0"):10===e&&C?t=Et(mt((n=_(new M(n),g+o+1,y)).c),n.e,"0"):(wt(e,2,P.length,"Base"),t=r(Et(mt(n.c),o,"0"),10,e,i,!0)),i<0&&n.c[0]&&(t="-"+t)),t},f.valueOf=f.toJSON=function(){return T(this)},f._isBigNumber=!0,f[Symbol.toStringTag]="BigNumber",f[Symbol.for("nodejs.util.inspect.custom")]=f.valueOf,null!=t&&M.set(t),M}(),Pt=class{key;left=null;right=null;constructor(e){this.key=e}},Ct=class extends Pt{constructor(e){super(e)}},Mt=class{size=0;modificationCount=0;splayCount=0;splay(e){const t=this.root;if(null==t)return this.compare(e,e),-1;let n=null,r=null,i=null,o=null,s=t;const l=this.compare;let u;for(;;)if(u=l(s.key,e),u>0){let t=s.left;if(null==t)break;if(u=l(t.key,e),u>0&&(s.left=t.right,t.right=s,s=t,t=s.left,null==t))break;null==n?r=s:n.left=s,n=s,s=t}else{if(!(u<0))break;{let t=s.right;if(null==t)break;if(u=l(t.key,e),u<0&&(s.right=t.left,t.left=s,s=t,t=s.right,null==t))break;null==i?o=s:i.right=s,i=s,s=t}}return null!=i&&(i.right=s.left,s.left=o),null!=n&&(n.left=s.right,s.right=r),this.root!==s&&(this.root=s,this.splayCount++),u}splayMin(e){let t=e,n=t.left;for(;null!=n;){const e=n;t.left=e.right,e.right=t,t=e,n=t.left}return t}splayMax(e){let t=e,n=t.right;for(;null!=n;){const e=n;t.right=e.left,e.left=t,t=e,n=t.right}return t}_delete(e){if(null==this.root)return null;if(0!=this.splay(e))return null;let t=this.root;const n=t,r=t.left;if(this.size--,null==r)this.root=t.right;else{const e=t.right;t=this.splayMax(r),t.right=e,this.root=t}return this.modificationCount++,n}addNewRoot(e,t){this.size++,this.modificationCount++;const n=this.root;null!=n?(t<0?(e.left=n,e.right=n.right,n.right=null):(e.right=n,e.left=n.left,n.left=null),this.root=e):this.root=e}_first(){const e=this.root;return null==e?null:(this.root=this.splayMin(e),this.root)}_last(){const e=this.root;return null==e?null:(this.root=this.splayMax(e),this.root)}clear(){this.root=null,this.size=0,this.modificationCount++}has(e){return this.validKey(e)&&0==this.splay(e)}defaultCompare(){return(e,t)=>e<t?-1:e>t?1:0}wrap(){return{getRoot:()=>this.root,setRoot:e=>{this.root=e},getSize:()=>this.size,getModificationCount:()=>this.modificationCount,getSplayCount:()=>this.splayCount,setSplayCount:e=>{this.splayCount=e},splay:e=>this.splay(e),has:e=>this.has(e)}}},Lt=class e extends Mt{root=null;compare;validKey;constructor(e,t){super(),this.compare=e??this.defaultCompare(),this.validKey=t??(e=>null!=e&&null!=e)}delete(e){return!!this.validKey(e)&&null!=this._delete(e)}deleteAll(e){for(const t of e)this.delete(t)}forEach(e){const t=this[Symbol.iterator]();let n;for(;n=t.next(),!n.done;)e(n.value,n.value,this)}add(e){const t=this.splay(e);return 0!=t&&this.addNewRoot(new Ct(e),t),this}addAndReturn(e){const t=this.splay(e);return 0!=t&&this.addNewRoot(new Ct(e),t),this.root.key}addAll(e){for(const t of e)this.add(t)}isEmpty(){return null==this.root}isNotEmpty(){return null!=this.root}single(){if(0==this.size)throw"Bad state: No element";if(this.size>1)throw"Bad state: Too many element";return this.root.key}first(){if(0==this.size)throw"Bad state: No element";return this._first().key}last(){if(0==this.size)throw"Bad state: No element";return this._last().key}lastBefore(e){if(null==e)throw"Invalid arguments(s)";if(null==this.root)return null;if(this.splay(e)<0)return this.root.key;let t=this.root.left;if(null==t)return null;let n=t.right;for(;null!=n;)t=n,n=t.right;return t.key}firstAfter(e){if(null==e)throw"Invalid arguments(s)";if(null==this.root)return null;if(this.splay(e)>0)return this.root.key;let t=this.root.right;if(null==t)return null;let n=t.left;for(;null!=n;)t=n,n=t.left;return t.key}retainAll(t){const n=new e(this.compare,this.validKey),r=this.modificationCount;for(const e of t){if(r!=this.modificationCount)throw"Concurrent modification during iteration.";this.validKey(e)&&0==this.splay(e)&&n.add(this.root.key)}n.size!=this.size&&(this.root=n.root,this.size=n.size,this.modificationCount++)}lookup(e){if(!this.validKey(e))return null;return 0!=this.splay(e)?null:this.root.key}intersection(t){const n=new e(this.compare,this.validKey);for(const e of this)t.has(e)&&n.add(e);return n}difference(t){const n=new e(this.compare,this.validKey);for(const e of this)t.has(e)||n.add(e);return n}union(e){const t=this.clone();return t.addAll(e),t}clone(){const t=new e(this.compare,this.validKey);return t.size=this.size,t.root=this.copyNode(this.root),t}copyNode(e){if(null==e)return null;const t=new Ct(e.key);return function e(t,n){let r,i;do{if(r=t.left,i=t.right,null!=r){const t=new Ct(r.key);n.left=t,e(r,t)}if(null!=i){const e=new Ct(i.key);n.right=e,t=i,n=e}}while(null!=i)}(e,t),t}toSet(){return this.clone()}entries(){return new _t(this.wrap())}keys(){return this[Symbol.iterator]()}values(){return this[Symbol.iterator]()}[Symbol.iterator](){return new Ft(this.wrap())}[Symbol.toStringTag]="[object Set]"},It=class{tree;path=new Array;modificationCount=null;splayCount;constructor(e){this.tree=e,this.splayCount=e.getSplayCount()}[Symbol.iterator](){return this}next(){return this.moveNext()?{done:!1,value:this.current()}:{done:!0,value:null}}current(){if(!this.path.length)return null;const e=this.path[this.path.length-1];return this.getValue(e)}rebuildPath(e){this.path.splice(0,this.path.length),this.tree.splay(e),this.path.push(this.tree.getRoot()),this.splayCount=this.tree.getSplayCount()}findLeftMostDescendent(e){for(;null!=e;)this.path.push(e),e=e.left}moveNext(){if(this.modificationCount!=this.tree.getModificationCount()){if(null==this.modificationCount){this.modificationCount=this.tree.getModificationCount();let e=this.tree.getRoot();for(;null!=e;)this.path.push(e),e=e.left;return this.path.length>0}throw"Concurrent modification during iteration."}if(!this.path.length)return!1;this.splayCount!=this.tree.getSplayCount()&&this.rebuildPath(this.path[this.path.length-1].key);let e=this.path[this.path.length-1],t=e.right;if(null!=t){for(;null!=t;)this.path.push(t),t=t.left;return!0}for(this.path.pop();this.path.length&&this.path[this.path.length-1].right===e;)e=this.path.pop();return this.path.length>0}},Ft=class extends It{getValue(e){return e.key}},_t=class extends It{getValue(e){return[e.key,e.key]}},Tt=e=>()=>e,Ot=e=>{const t=e?(t,n)=>n.minus(t).abs().isLessThanOrEqualTo(e):Tt(!1);return(e,n)=>t(e,n)?0:e.comparedTo(n)};function kt(e){const t=e?(t,n,r,i,o)=>t.exponentiatedBy(2).isLessThanOrEqualTo(i.minus(n).exponentiatedBy(2).plus(o.minus(r).exponentiatedBy(2)).times(e)):Tt(!1);return(e,n,r)=>{const i=e.x,o=e.y,s=r.x,l=r.y,u=o.minus(l).times(n.x.minus(s)).minus(i.minus(s).times(n.y.minus(l)));return t(u,i,o,s,l)?0:u.comparedTo(0)}}var At=e=>e,Rt=e=>{if(e){const t=new Lt(Ot(e)),n=new Lt(Ot(e)),r=(e,t)=>t.addAndReturn(e),i=e=>({x:r(e.x,t),y:r(e.y,n)});return i({x:new St(0),y:new St(0)}),i}return At},Nt=e=>({set:e=>{Gt=Nt(e)},reset:()=>Nt(e),compare:Ot(e),snap:Rt(e),orient:kt(e)}),Gt=Nt(),Bt=(e,t)=>e.ll.x.isLessThanOrEqualTo(t.x)&&t.x.isLessThanOrEqualTo(e.ur.x)&&e.ll.y.isLessThanOrEqualTo(t.y)&&t.y.isLessThanOrEqualTo(e.ur.y),Dt=(e,t)=>{if(t.ur.x.isLessThan(e.ll.x)||e.ur.x.isLessThan(t.ll.x)||t.ur.y.isLessThan(e.ll.y)||e.ur.y.isLessThan(t.ll.y))return null;const n=e.ll.x.isLessThan(t.ll.x)?t.ll.x:e.ll.x,r=e.ur.x.isLessThan(t.ur.x)?e.ur.x:t.ur.x;return{ll:{x:n,y:e.ll.y.isLessThan(t.ll.y)?t.ll.y:e.ll.y},ur:{x:r,y:e.ur.y.isLessThan(t.ur.y)?e.ur.y:t.ur.y}}},Ut=(e,t)=>e.x.times(t.y).minus(e.y.times(t.x)),qt=(e,t)=>e.x.times(t.x).plus(e.y.times(t.y)),Vt=e=>qt(e,e).sqrt(),jt=(e,t,n)=>{const r={x:t.x.minus(e.x),y:t.y.minus(e.y)},i={x:n.x.minus(e.x),y:n.y.minus(e.y)};return Ut(i,r).div(Vt(i)).div(Vt(r))},$t=(e,t,n)=>{const r={x:t.x.minus(e.x),y:t.y.minus(e.y)},i={x:n.x.minus(e.x),y:n.y.minus(e.y)};return qt(i,r).div(Vt(i)).div(Vt(r))},zt=(e,t,n)=>t.y.isZero()?null:{x:e.x.plus(t.x.div(t.y).times(n.minus(e.y))),y:n},Yt=(e,t,n)=>t.x.isZero()?null:{x:n,y:e.y.plus(t.y.div(t.x).times(n.minus(e.x)))},Wt=class e{point;isLeft;segment;otherSE;consumedBy;static compare(t,n){const r=e.comparePoints(t.point,n.point);return 0!==r?r:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:Qt.compare(t.segment,n.segment))}static comparePoints(e,t){return e.x.isLessThan(t.x)?-1:e.x.isGreaterThan(t.x)?1:e.y.isLessThan(t.y)?-1:e.y.isGreaterThan(t.y)?1:0}constructor(e,t){void 0===e.events?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=t}link(e){if(e.point===this.point)throw new Error("Tried to link already linked events");const t=e.point.events;for(let e=0,n=t.length;e<n;e++){const n=t[e];this.point.events.push(n),n.point=this.point}this.checkForConsuming()}checkForConsuming(){const e=this.point.events.length;for(let t=0;t<e;t++){const n=this.point.events[t];if(void 0===n.segment.consumedBy)for(let r=t+1;r<e;r++){const e=this.point.events[r];void 0===e.consumedBy&&(n.otherSE.point.events===e.otherSE.point.events&&n.segment.consume(e.segment))}}}getAvailableLinkedEvents(){const e=[];for(let t=0,n=this.point.events.length;t<n;t++){const n=this.point.events[t];n!==this&&!n.segment.ringOut&&n.segment.isInResult()&&e.push(n)}return e}getLeftmostComparator(e){const t=new Map,n=n=>{const r=n.otherSE;t.set(n,{sine:jt(this.point,e.point,r.point),cosine:$t(this.point,e.point,r.point)})};return(e,r)=>{t.has(e)||n(e),t.has(r)||n(r);const{sine:i,cosine:o}=t.get(e),{sine:s,cosine:l}=t.get(r);return i.isGreaterThanOrEqualTo(0)&&s.isGreaterThanOrEqualTo(0)?o.isLessThan(l)?1:o.isGreaterThan(l)?-1:0:i.isLessThan(0)&&s.isLessThan(0)?o.isLessThan(l)?-1:o.isGreaterThan(l)?1:0:s.isLessThan(i)?-1:s.isGreaterThan(i)?1:0}}},Ht=class e{events;poly;_isExteriorRing;_enclosingRing;static factory(t){const n=[];for(let r=0,i=t.length;r<i;r++){const i=t[r];if(!i.isInResult()||i.ringOut)continue;let o=null,s=i.leftSE,l=i.rightSE;const u=[s],a=s.point,c=[];for(;o=s,s=l,u.push(s),s.point!==a;)for(;;){const t=s.getAvailableLinkedEvents();if(0===t.length){const e=u[0].point,t=u[u.length-1].point;throw new Error(`Unable to complete output ring starting at [${e.x}, ${e.y}]. Last matching segment found ends at [${t.x}, ${t.y}].`)}if(1===t.length){l=t[0].otherSE;break}let r=null;for(let e=0,t=c.length;e<t;e++)if(c[e].point===s.point){r=e;break}if(null!==r){const t=c.splice(r)[0],i=u.splice(t.index);i.unshift(i[0].otherSE),n.push(new e(i.reverse()));continue}c.push({index:u.length,point:s.point});const i=s.getLeftmostComparator(o);l=t.sort(i)[0].otherSE;break}n.push(new e(u))}return n}constructor(e){this.events=e;for(let t=0,n=e.length;t<n;t++)e[t].segment.ringOut=this;this.poly=null}getGeom(){let e=this.events[0].point;const t=[e];for(let n=1,r=this.events.length-1;n<r;n++){const r=this.events[n].point,i=this.events[n+1].point;0!==Gt.orient(r,e,i)&&(t.push(r),e=r)}if(1===t.length)return null;const n=t[0],r=t[1];0===Gt.orient(n,e,r)&&t.shift(),t.push(t[0]);const i=this.isExteriorRing()?1:-1,o=this.isExteriorRing()?0:t.length-1,s=this.isExteriorRing()?t.length:-1,l=[];for(let e=o;e!=s;e+=i)l.push([t[e].x.toNumber(),t[e].y.toNumber()]);return l}isExteriorRing(){if(void 0===this._isExteriorRing){const e=this.enclosingRing();this._isExteriorRing=!e||!e.isExteriorRing()}return this._isExteriorRing}enclosingRing(){return void 0===this._enclosingRing&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let e=this.events[0];for(let t=1,n=this.events.length;t<n;t++){const n=this.events[t];Wt.compare(e,n)>0&&(e=n)}let t=e.segment.prevInResult(),n=t?t.prevInResult():null;for(;;){if(!t)return null;if(!n)return t.ringOut;if(n.ringOut!==t.ringOut)return n.ringOut?.enclosingRing()!==t.ringOut?t.ringOut:t.ringOut?.enclosingRing();t=n.prevInResult(),n=t?t.prevInResult():null}}},Jt=class{exteriorRing;interiorRings;constructor(e){this.exteriorRing=e,e.poly=this,this.interiorRings=[]}addInterior(e){this.interiorRings.push(e),e.poly=this}getGeom(){const e=this.exteriorRing.getGeom();if(null===e)return null;const t=[e];for(let e=0,n=this.interiorRings.length;e<n;e++){const n=this.interiorRings[e].getGeom();null!==n&&t.push(n)}return t}},Kt=new class{type;numMultiPolys;run(e,t,n){Kt.type=e;const r=[new nn(t,!0)];for(let e=0,t=n.length;e<t;e++)r.push(new nn(n[e],!1));if(Kt.numMultiPolys=r.length,"difference"===Kt.type){const e=r[0];let t=1;for(;t<r.length;)null!==Dt(r[t].bbox,e.bbox)?t++:r.splice(t,1)}if("intersection"===Kt.type)for(let e=0,t=r.length;e<t;e++){const t=r[e];for(let n=e+1,i=r.length;n<i;n++)if(null===Dt(t.bbox,r[n].bbox))return[]}const i=new Lt(Wt.compare);for(let e=0,t=r.length;e<t;e++){const t=r[e].getSweepEvents();for(let e=0,n=t.length;e<n;e++)i.add(t[e])}const o=new class{queue;tree;segments;constructor(e,t=Qt.compare){this.queue=e,this.tree=new Lt(t),this.segments=[]}process(e){const t=e.segment,n=[];if(e.consumedBy)return e.isLeft?this.queue.delete(e.otherSE):this.tree.delete(t),n;e.isLeft&&this.tree.add(t);let r=t,i=t;do{r=this.tree.lastBefore(r)}while(null!=r&&null!=r.consumedBy);do{i=this.tree.firstAfter(i)}while(null!=i&&null!=i.consumedBy);if(e.isLeft){let o=null;if(r){const e=r.getIntersection(t);if(null!==e&&(t.isAnEndpoint(e)||(o=e),!r.isAnEndpoint(e))){const t=this._splitSafely(r,e);for(let e=0,r=t.length;e<r;e++)n.push(t[e])}}let s=null;if(i){const e=i.getIntersection(t);if(null!==e&&(t.isAnEndpoint(e)||(s=e),!i.isAnEndpoint(e))){const t=this._splitSafely(i,e);for(let e=0,r=t.length;e<r;e++)n.push(t[e])}}if(null!==o||null!==s){let e=null;e=null===o?s:null===s||Wt.comparePoints(o,s)<=0?o:s,this.queue.delete(t.rightSE),n.push(t.rightSE);const r=t.split(e);for(let e=0,t=r.length;e<t;e++)n.push(r[e])}n.length>0?(this.tree.delete(t),n.push(e)):(this.segments.push(t),t.prev=r)}else{if(r&&i){const e=r.getIntersection(i);if(null!==e){if(!r.isAnEndpoint(e)){const t=this._splitSafely(r,e);for(let e=0,r=t.length;e<r;e++)n.push(t[e])}if(!i.isAnEndpoint(e)){const t=this._splitSafely(i,e);for(let e=0,r=t.length;e<r;e++)n.push(t[e])}}}this.tree.delete(t)}return n}_splitSafely(e,t){this.tree.delete(e);const n=e.rightSE;this.queue.delete(n);const r=e.split(t);return r.push(n),void 0===e.consumedBy&&this.tree.add(e),r}}(i);let s=null;for(0!=i.size&&(s=i.first(),i.delete(s));s;){const e=o.process(s);for(let t=0,n=e.length;t<n;t++){const n=e[t];void 0===n.consumedBy&&i.add(n)}0!=i.size?(s=i.first(),i.delete(s)):s=null}Gt.reset();const l=Ht.factory(o.segments),u=new class{rings;polys;constructor(e){this.rings=e,this.polys=this._composePolys(e)}getGeom(){const e=[];for(let t=0,n=this.polys.length;t<n;t++){const n=this.polys[t].getGeom();null!==n&&e.push(n)}return e}_composePolys(e){const t=[];for(let n=0,r=e.length;n<r;n++){const r=e[n];if(!r.poly)if(r.isExteriorRing())t.push(new Jt(r));else{const e=r.enclosingRing();e?.poly||t.push(new Jt(e)),e?.poly?.addInterior(r)}}return t}}(l);return u.getGeom()}},Zt=Kt,Xt=0,Qt=class e{id;leftSE;rightSE;rings;windings;ringOut;consumedBy;prev;_prevInResult;_beforeState;_afterState;_isInResult;static compare(e,t){const n=e.leftSE.point.x,r=t.leftSE.point.x,i=e.rightSE.point.x,o=t.rightSE.point.x;if(o.isLessThan(n))return 1;if(i.isLessThan(r))return-1;const s=e.leftSE.point.y,l=t.leftSE.point.y,u=e.rightSE.point.y,a=t.rightSE.point.y;if(n.isLessThan(r)){if(l.isLessThan(s)&&l.isLessThan(u))return 1;if(l.isGreaterThan(s)&&l.isGreaterThan(u))return-1;const n=e.comparePoint(t.leftSE.point);if(n<0)return 1;if(n>0)return-1;const r=t.comparePoint(e.rightSE.point);return 0!==r?r:-1}if(n.isGreaterThan(r)){if(s.isLessThan(l)&&s.isLessThan(a))return-1;if(s.isGreaterThan(l)&&s.isGreaterThan(a))return 1;const n=t.comparePoint(e.leftSE.point);if(0!==n)return n;const r=e.comparePoint(t.rightSE.point);return r<0?1:r>0?-1:1}if(s.isLessThan(l))return-1;if(s.isGreaterThan(l))return 1;if(i.isLessThan(o)){const n=t.comparePoint(e.rightSE.point);if(0!==n)return n}if(i.isGreaterThan(o)){const n=e.comparePoint(t.rightSE.point);if(n<0)return 1;if(n>0)return-1}if(!i.eq(o)){const e=u.minus(s),t=i.minus(n),c=a.minus(l),h=o.minus(r);if(e.isGreaterThan(t)&&c.isLessThan(h))return 1;if(e.isLessThan(t)&&c.isGreaterThan(h))return-1}return i.isGreaterThan(o)?1:i.isLessThan(o)||u.isLessThan(a)?-1:u.isGreaterThan(a)?1:e.id<t.id?-1:e.id>t.id?1:0}constructor(e,t,n,r){this.id=++Xt,this.leftSE=e,e.segment=this,e.otherSE=t,this.rightSE=t,t.segment=this,t.otherSE=e,this.rings=n,this.windings=r}static fromRing(t,n,r){let i,o,s;const l=Wt.comparePoints(t,n);if(l<0)i=t,o=n,s=1;else{if(!(l>0))throw new Error(`Tried to create degenerate segment at [${t.x}, ${t.y}]`);i=n,o=t,s=-1}const u=new Wt(i,!0),a=new Wt(o,!1);return new e(u,a,[r],[s])}replaceRightSE(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const e=this.leftSE.point.y,t=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e.isLessThan(t)?e:t},ur:{x:this.rightSE.point.x,y:e.isGreaterThan(t)?e:t}}}vector(){return{x:this.rightSE.point.x.minus(this.leftSE.point.x),y:this.rightSE.point.y.minus(this.leftSE.point.y)}}isAnEndpoint(e){return e.x.eq(this.leftSE.point.x)&&e.y.eq(this.leftSE.point.y)||e.x.eq(this.rightSE.point.x)&&e.y.eq(this.rightSE.point.y)}comparePoint(e){return Gt.orient(this.leftSE.point,e,this.rightSE.point)}getIntersection(e){const t=this.bbox(),n=e.bbox(),r=Dt(t,n);if(null===r)return null;const i=this.leftSE.point,o=this.rightSE.point,s=e.leftSE.point,l=e.rightSE.point,u=Bt(t,s)&&0===this.comparePoint(s),a=Bt(n,i)&&0===e.comparePoint(i),c=Bt(t,l)&&0===this.comparePoint(l),h=Bt(n,o)&&0===e.comparePoint(o);if(a&&u)return h&&!c?o:!h&&c?l:null;if(a)return c&&i.x.eq(l.x)&&i.y.eq(l.y)?null:i;if(u)return h&&o.x.eq(s.x)&&o.y.eq(s.y)?null:s;if(h&&c)return null;if(h)return o;if(c)return l;const f=((e,t,n,r)=>{if(t.x.isZero())return Yt(n,r,e.x);if(r.x.isZero())return Yt(e,t,n.x);if(t.y.isZero())return zt(n,r,e.y);if(r.y.isZero())return zt(e,t,n.y);const i=Ut(t,r);if(i.isZero())return null;const o={x:n.x.minus(e.x),y:n.y.minus(e.y)},s=Ut(o,t).div(i),l=Ut(o,r).div(i),u=e.x.plus(l.times(t.x)),a=n.x.plus(s.times(r.x)),c=e.y.plus(l.times(t.y)),h=n.y.plus(s.times(r.y));return{x:u.plus(a).div(2),y:c.plus(h).div(2)}})(i,this.vector(),s,e.vector());return null===f?null:Bt(r,f)?Gt.snap(f):null}split(t){const n=[],r=void 0!==t.events,i=new Wt(t,!0),o=new Wt(t,!1),s=this.rightSE;this.replaceRightSE(o),n.push(o),n.push(i);const l=new e(i,s,this.rings.slice(),this.windings.slice());return Wt.comparePoints(l.leftSE.point,l.rightSE.point)>0&&l.swapEvents(),Wt.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),r&&(i.checkForConsuming(),o.checkForConsuming()),n}swapEvents(){const e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let e=0,t=this.windings.length;e<t;e++)this.windings[e]*=-1}consume(t){let n=this,r=t;for(;n.consumedBy;)n=n.consumedBy;for(;r.consumedBy;)r=r.consumedBy;const i=e.compare(n,r);if(0!==i){if(i>0){const e=n;n=r,r=e}if(n.prev===r){const e=n;n=r,r=e}for(let e=0,t=r.rings.length;e<t;e++){const t=r.rings[e],i=r.windings[e],o=n.rings.indexOf(t);-1===o?(n.rings.push(t),n.windings.push(i)):n.windings[o]+=i}r.rings=null,r.windings=null,r.consumedBy=n,r.leftSE.consumedBy=n.leftSE,r.rightSE.consumedBy=n.rightSE}}prevInResult(){return void 0!==this._prevInResult||(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null),this._prevInResult}beforeState(){if(void 0!==this._beforeState)return this._beforeState;if(this.prev){const e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}else this._beforeState={rings:[],windings:[],multiPolys:[]};return this._beforeState}afterState(){if(void 0!==this._afterState)return this._afterState;const e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};const t=this._afterState.rings,n=this._afterState.windings,r=this._afterState.multiPolys;for(let e=0,r=this.rings.length;e<r;e++){const r=this.rings[e],i=this.windings[e],o=t.indexOf(r);-1===o?(t.push(r),n.push(i)):n[o]+=i}const i=[],o=[];for(let e=0,r=t.length;e<r;e++){if(0===n[e])continue;const r=t[e],s=r.poly;if(-1===o.indexOf(s))if(r.isExterior)i.push(s);else{-1===o.indexOf(s)&&o.push(s);const e=i.indexOf(r.poly);-1!==e&&i.splice(e,1)}}for(let e=0,t=i.length;e<t;e++){const t=i[e].multiPoly;-1===r.indexOf(t)&&r.push(t)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(void 0!==this._isInResult)return this._isInResult;const e=this.beforeState().multiPolys,t=this.afterState().multiPolys;switch(Zt.type){case"union":{const n=0===e.length,r=0===t.length;this._isInResult=n!==r;break}case"intersection":{let n,r;e.length<t.length?(n=e.length,r=t.length):(n=t.length,r=e.length),this._isInResult=r===Zt.numMultiPolys&&n<r;break}case"xor":{const n=Math.abs(e.length-t.length);this._isInResult=n%2==1;break}case"difference":{const n=e=>1===e.length&&e[0].isSubject;this._isInResult=n(e)!==n(t);break}}return this._isInResult}},en=class{poly;isExterior;segments;bbox;constructor(e,t,n){if(!Array.isArray(e)||0===e.length)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=t,this.isExterior=n,this.segments=[],"number"!=typeof e[0][0]||"number"!=typeof e[0][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const r=Gt.snap({x:new St(e[0][0]),y:new St(e[0][1])});this.bbox={ll:{x:r.x,y:r.y},ur:{x:r.x,y:r.y}};let i=r;for(let t=1,n=e.length;t<n;t++){if("number"!=typeof e[t][0]||"number"!=typeof e[t][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const n=Gt.snap({x:new St(e[t][0]),y:new St(e[t][1])});n.x.eq(i.x)&&n.y.eq(i.y)||(this.segments.push(Qt.fromRing(i,n,this)),n.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=n.x),n.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=n.y),n.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=n.x),n.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=n.y),i=n)}r.x.eq(i.x)&&r.y.eq(i.y)||this.segments.push(Qt.fromRing(i,r,this))}getSweepEvents(){const e=[];for(let t=0,n=this.segments.length;t<n;t++){const n=this.segments[t];e.push(n.leftSE),e.push(n.rightSE)}return e}},tn=class{multiPoly;exteriorRing;interiorRings;bbox;constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new en(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let t=1,n=e.length;t<n;t++){const n=new en(e[t],this,!1);n.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=n.bbox.ll.x),n.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=n.bbox.ll.y),n.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=n.bbox.ur.x),n.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=n.bbox.ur.y),this.interiorRings.push(n)}this.multiPoly=t}getSweepEvents(){const e=this.exteriorRing.getSweepEvents();for(let t=0,n=this.interiorRings.length;t<n;t++){const n=this.interiorRings[t].getSweepEvents();for(let t=0,r=n.length;t<r;t++)e.push(n[t])}return e}},nn=class{isSubject;polys;bbox;constructor(e,t){if(!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{"number"==typeof e[0][0][0]&&(e=[e])}catch(e){}this.polys=[],this.bbox={ll:{x:new St(Number.POSITIVE_INFINITY),y:new St(Number.POSITIVE_INFINITY)},ur:{x:new St(Number.NEGATIVE_INFINITY),y:new St(Number.NEGATIVE_INFINITY)}};for(let t=0,n=e.length;t<n;t++){const n=new tn(e[t],this);n.bbox.ll.x.isLessThan(this.bbox.ll.x)&&(this.bbox.ll.x=n.bbox.ll.x),n.bbox.ll.y.isLessThan(this.bbox.ll.y)&&(this.bbox.ll.y=n.bbox.ll.y),n.bbox.ur.x.isGreaterThan(this.bbox.ur.x)&&(this.bbox.ur.x=n.bbox.ur.x),n.bbox.ur.y.isGreaterThan(this.bbox.ur.y)&&(this.bbox.ur.y=n.bbox.ur.y),this.polys.push(n)}this.isSubject=t}getSweepEvents(){const e=[];for(let t=0,n=this.polys.length;t<n;t++){const n=this.polys[t].getSweepEvents();for(let t=0,r=n.length;t<r;t++)e.push(n[t])}return e}};Gt.set;var rn=function(e){const t=[];if(function(e,t){var n,r,i,o,s,l,u,a,c,h,f=0,p="FeatureCollection"===e.type,g="Feature"===e.type,y=p?e.features.length:1;for(n=0;n<y;n++){for(l=p?e.features[n].geometry:g?e.geometry:e,a=p?e.features[n].properties:g?e.properties:{},c=p?e.features[n].bbox:g?e.bbox:void 0,h=p?e.features[n].id:g?e.id:void 0,s=(u=!!l&&"GeometryCollection"===l.type)?l.geometries.length:1,i=0;i<s;i++)if(null!==(o=u?l.geometries[i]:l))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(o,f,a,c,h))return!1;break;case"GeometryCollection":for(r=0;r<o.geometries.length;r++)if(!1===t(o.geometries[r],f,a,c,h))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===t(null,f,a,c,h))return!1;f++}}(e,(e=>{t.push(e.coordinates)})),t.length<2)throw new Error("Must have at least two features");const n=e.features[0].properties||{},r=((e,...t)=>Zt.run("difference",e,t))(t[0],...t.slice(1));return 0===r.length?null:1===r.length?pe(r[0],n):me(r,n)};function on(e){var t=[1/0,1/0,-1/0,-1/0];return c(e,(function(e){t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[0]&&(t[2]=e[0]),t[3]<e[1]&&(t[3]=e[1])})),t}function sn(e,t,n){if(void 0===n&&(n={}),!e)throw new Error("point is required");if(!t)throw new Error("polygon is required");var r=s(e),i=u(t),o=i.type,l=t.bbox,a=i.coordinates;if(l&&!1===function(e,t){return t[0]<=e[0]&&t[1]<=e[1]&&t[2]>=e[0]&&t[3]>=e[1]}(r,l))return!1;"Polygon"===o&&(a=[a]);for(var c=!1,h=0;h<a.length&&!c;h++)if(ln(r,a[h][0],n.ignoreBoundary)){for(var f=!1,p=1;p<a[h].length&&!f;)ln(r,a[h][p],!n.ignoreBoundary)&&(f=!0),p++;f||(c=!0)}return c}function ln(e,t,n){var r=!1;t[0][0]===t[t.length-1][0]&&t[0][1]===t[t.length-1][1]&&(t=t.slice(0,t.length-1));for(var i=0,o=t.length-1;i<t.length;o=i++){var s=t[i][0],l=t[i][1],u=t[o][0],a=t[o][1];if(e[1]*(s-u)+l*(u-e[0])+a*(e[0]-s)==0&&(s-e[0])*(u-e[0])<=0&&(l-e[1])*(a-e[1])<=0)return!n;l>e[1]!=a>e[1]&&e[0]<(u-s)*(e[1]-l)/(a-l)+s&&(r=!r)}return r}function un(e,t,n){void 0===n&&(n={});for(var r=s(e),i=l(t),o=0;o<i.length-1;o++){var u=!1;if(n.ignoreEndVertices&&(0===o&&(u="start"),o===i.length-2&&(u="end"),0===o&&o+1===i.length-1&&(u="both")),an(i[o],i[o+1],r,u,void 0===n.epsilon?null:n.epsilon))return!0}return!1}function an(e,t,n,r,i){var o=n[0],s=n[1],l=e[0],u=e[1],a=t[0],c=t[1],h=a-l,f=c-u,p=(n[0]-l)*f-(n[1]-u)*h;if(null!==i){if(Math.abs(p)>i)return!1}else if(0!==p)return!1;return r?"start"===r?Math.abs(h)>=Math.abs(f)?h>0?l<o&&o<=a:a<=o&&o<l:f>0?u<s&&s<=c:c<=s&&s<u:"end"===r?Math.abs(h)>=Math.abs(f)?h>0?l<=o&&o<a:a<o&&o<=l:f>0?u<=s&&s<c:c<s&&s<=u:"both"===r&&(Math.abs(h)>=Math.abs(f)?h>0?l<o&&o<a:a<o&&o<l:f>0?u<s&&s<c:c<s&&s<u):Math.abs(h)>=Math.abs(f)?h>0?l<=o&&o<=a:a<=o&&o<=l:f>0?u<=s&&s<=c:c<=s&&s<=u}function cn(e,t){var n=u(e),r=u(t),i=n.type,o=r.type,s=n.coordinates,l=r.coordinates;switch(i){case"Point":if("Point"===o)return fn(s,l);throw new Error("feature2 "+o+" geometry not supported");case"MultiPoint":switch(o){case"Point":return function(e,t){var n,r=!1;for(n=0;n<e.coordinates.length;n++)if(fn(e.coordinates[n],t.coordinates)){r=!0;break}return r}(n,r);case"MultiPoint":return function(e,t){for(var n=0,r=t.coordinates;n<r.length;n++){for(var i=r[n],o=!1,s=0,l=e.coordinates;s<l.length;s++){if(fn(i,l[s])){o=!0;break}}if(!o)return!1}return!0}(n,r);default:throw new Error("feature2 "+o+" geometry not supported")}case"LineString":switch(o){case"Point":return un(r,n,{ignoreEndVertices:!0});case"LineString":return function(e,t){for(var n=!1,r=0,i=t.coordinates;r<i.length;r++){var o=i[r];if(un({type:"Point",coordinates:o},e,{ignoreEndVertices:!0})&&(n=!0),!un({type:"Point",coordinates:o},e,{ignoreEndVertices:!1}))return!1}return n}(n,r);case"MultiPoint":return function(e,t){for(var n=!1,r=0,i=t.coordinates;r<i.length;r++){var o=i[r];if(un(o,e,{ignoreEndVertices:!0})&&(n=!0),!un(o,e))return!1}if(n)return!0;return!1}(n,r);default:throw new Error("feature2 "+o+" geometry not supported")}case"Polygon":switch(o){case"Point":return sn(r,n,{ignoreBoundary:!0});case"LineString":return function(e,t){var n=!1,r=0,i=on(e),o=on(t);if(!hn(i,o))return!1;for(;r<t.coordinates.length-1;r++){if(sn({type:"Point",coordinates:pn(t.coordinates[r],t.coordinates[r+1])},e,{ignoreBoundary:!0})){n=!0;break}}return n}(n,r);case"Polygon":return function(e,t){if("Feature"===e.type&&null===e.geometry)return!1;if("Feature"===t.type&&null===t.geometry)return!1;var n=on(e),r=on(t);if(!hn(n,r))return!1;for(var i=u(t).coordinates,o=0,s=i;o<s.length;o++)for(var l=0,a=s[o];l<a.length;l++){if(!sn(a[l],e))return!1}return!0}(n,r);case"MultiPoint":return function(e,t){for(var n=0,r=t.coordinates;n<r.length;n++){if(!sn(r[n],e,{ignoreBoundary:!0}))return!1}return!0}(n,r);default:throw new Error("feature2 "+o+" geometry not supported")}default:throw new Error("feature1 "+i+" geometry not supported")}}function hn(e,t){return!(e[0]>t[0])&&(!(e[2]<t[2])&&(!(e[1]>t[1])&&!(e[3]<t[3])))}function fn(e,t){return e[0]===t[0]&&e[1]===t[1]}function pn(e,t){return[(e[0]+t[0])/2,(e[1]+t[1])/2]}on.default=on;const gn="split_polygon",yn="split_polygon_passing_draw_line_string",dn="split_polygon_highlight",mn={highlightColor:"#222",lineWidth:0,lineWidthUnit:"kilometers",onSelectFeatureRequest(){throw new Error("no Feature is selected to split.")}},vn={SPLIT_POLYGON_MODE_STOP:"draw:split_polygon_mode:stop",SPLIT_POLYGON_MORE_THAN_TWO_POLYGONS:"draw:split_polygon_mode:more_than_two_polygons"};var wn=Object.freeze({__proto__:null,modeName:gn,passingModeName:yn,highlightPropertyName:dn,defaultOptions:mn,splitPolygonModeEvents:vn});const bn={};bn.onSetup=function(e){const{featureIds:t=[],highlightColor:n=mn.highlightColor,lineWidth:r=mn.lineWidth,lineWidthUnit:i=mn.lineWidthUnit,onSelectFeatureRequest:o=mn.onSelectFeatureRequest}=e||{},s=this._ctx.api,l=[],u=this.getSelected();if(0!==t.length)l.push.apply(l,t.map((e=>s.get(e))));else{if(0===u.length)return o();l.push.apply(l,u.filter((e=>e.type===Q||e.type===ne)).map((e=>e.toGeoJSON())))}const a={options:{highlightColor:n,lineWidth:r,lineWidthUnit:i},featuresToSplit:l,api:s};return setTimeout(this.drawAndSplit.bind(this,a),0),this.highlighFeatures(a),a},bn.drawAndSplit=function(e){const{api:t,options:n}=e,{lineWidth:r,lineWidthUnit:i}=n;try{this.changeMode(yn,{onDraw:n=>{const o=[];e.featuresToSplit.forEach((e=>{try{if(cn(e,n))return console.info(`Line is completely within Polygon ${e.id}`),void o.push(e);if(Ve(e,n))return console.info(`Line was outside of Polygon ${e.id}`),void o.push(e);if(0===r){const r=(s=e.geometry,l=n.geometry,G(s,l));r.id=e.id,t.add(r),o.push(r)}else{const s=function(e,t,n){const{line_width:r,line_width_unit:i}=n||{},o=[],s=null;let l,u,a,c,h,f;if(void 0===r||void 0===i||e.type!=Q&&e.type!=ne||t.type!=ee)return s;if(Ve(t,e))return s;if(a=ke(e,t),0===a.features.length)return s;for(o[0]=He(t,r,{units:i}),o[1]=He(t,-r,{units:i}),l=0;l<=1;l++){c=l;const n=[];for(u=0;u<t.coordinates.length;u++)n.push(t.coordinates[u]);for(u=o[c].geometry.coordinates.length-1;u>=0;u--)n.push(o[c].geometry.coordinates[u]);n.push(t.coordinates[0]),h=ge(n),it(h),f=rn(e)}return f}(e.geometry,n.geometry,{line_width:r,line_width_unit:i});s.id=e.id,t.add(s),o.push(s)}}catch(e){console.error("Error processing polygon split:",e)}var s,l})),this.fireUpdate(o),this.highlighFeatures(e,!1),(1!==o.length||"MultiPolygon"===o[0].geometry.type&&2!==o[0].geometry.coordinates.length)&&this.map.fire(vn.SPLIT_POLYGON_MORE_THAN_TWO_POLYGONS,{newPolygons:o})},onCancel:()=>{this.highlighFeatures(e,!1),this.map.fire(vn.SPLIT_POLYGON_MODE_STOP)}})}catch(e){console.error("🚀 ~ file: mode.js ~ line 118 ~ err",e)}},bn.highlighFeatures=function(e,t=!0){const n=t?e.options.highlightColor:void 0;e.featuresToSplit.forEach((t=>{e.api.setFeatureProperty(t.id,dn,n)}))},bn.toDisplayFeatures=function(e,t,n){n(t)},bn.fireUpdate=function(e){this.map.fire(oe,{action:gn,features:e})};const xn="user_split_polygon_highlight";function En(e){const t=e.featureTarget;return!!t&&(!!t.properties&&t.properties.meta===le)}function Sn(e){return 27===e.keyCode}function Pn(e){return 13===e.keyCode}const Cn={onSetup:function(){const e=this.newFeature({type:X,properties:{},geometry:{type:te,coordinates:[]}});return this.addFeature(e),this.clearSelectedFeatures(),this.updateUIClasses({mouse:z}),this.activateUIButton(Z),this.setActionableState({trash:!0}),{point:e}},stopDrawingAndRemove:function(e){this.deleteFeature([e.point.id],{silent:!0}),this.changeMode(re)}};Cn.onTap=Cn.onClick=function(e,t){this.updateUIClasses({mouse:Y}),e.point.updateCoordinate("",t.lngLat.lng,t.lngLat.lat),this.map.fire(ie,{features:[e.point.toGeoJSON()]}),this.changeMode(re,{featureIds:[e.point.id]})},Cn.onStop=function(e){this.activateUIButton(),e.point.getCoordinate().length||this.deleteFeature([e.point.id],{silent:!0})},Cn.toDisplayFeatures=function(e,t,n){const r=t.properties.id===e.point.id;if(t.properties.active=r?ue:ae,!r)return n(t)},Cn.onTrash=Cn.stopDrawingAndRemove,Cn.onKeyUp=function(e,t){if(Sn(t)||Pn(t))return this.stopDrawingAndRemove(e,t)};const{onSetup:Mn,onClick:Ln,...In}=Cn;function Fn(e,t){return!!e.lngLat&&(e.lngLat.lng===t[0]&&e.lngLat.lat===t[1])}var _n={enable(e){setTimeout((()=>{e.map&&e.map.doubleClickZoom&&e._ctx&&e._ctx.store&&e._ctx.store.getInitialConfigValue&&e._ctx.store.getInitialConfigValue("doubleClickZoom")&&e.map.doubleClickZoom.enable()}),0)},disable(e){setTimeout((()=>{e.map&&e.map.doubleClickZoom&&e.map.doubleClickZoom.disable()}),0)}};function Tn(e,t,n,r){return{type:X,properties:{meta:le,parent:e,coord_path:n,active:r?ue:ae},geometry:{type:te,coordinates:t}}}const On={onSetup:function(e){const t=(e=e||{}).featureId;let n,r,i="forward";if(t){if(n=this.getFeature(t),!n)throw new Error("Could not find a feature with the provided featureId");let o=e.from;if(o&&"Feature"===o.type&&o.geometry&&"Point"===o.geometry.type&&(o=o.geometry),o&&"Point"===o.type&&o.coordinates&&2===o.coordinates.length&&(o=o.coordinates),!o||!Array.isArray(o))throw new Error("Please use the `from` property to indicate which point to continue the line from");const s=n.coordinates.length-1;if(n.coordinates[s][0]===o[0]&&n.coordinates[s][1]===o[1])r=s+1,n.addCoordinate(r,...n.coordinates[s]);else{if(n.coordinates[0][0]!==o[0]||n.coordinates[0][1]!==o[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");i="backwards",r=0,n.addCoordinate(r,...n.coordinates[0])}}else n=this.newFeature({type:X,properties:{},geometry:{type:ee,coordinates:[]}}),r=0,this.addFeature(n);return this.clearSelectedFeatures(),_n.disable(this),this.updateUIClasses({mouse:z}),this.activateUIButton(K),this.setActionableState({trash:!0}),{line:n,currentVertexPosition:r,direction:i}},clickAnywhere:function(e,t){if(e.currentVertexPosition>0&&Fn(t,e.line.coordinates[e.currentVertexPosition-1])||"backwards"===e.direction&&Fn(t,e.line.coordinates[e.currentVertexPosition+1]))return this.changeMode(re,{featureIds:[e.line.id]});this.updateUIClasses({mouse:z}),e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),"forward"===e.direction?(e.currentVertexPosition++,e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat)):e.line.addCoordinate(0,t.lngLat.lng,t.lngLat.lat)},clickOnVertex:function(e){return this.changeMode(re,{featureIds:[e.line.id]})},onMouseMove:function(e,t){e.line.updateCoordinate(e.currentVertexPosition,t.lngLat.lng,t.lngLat.lat),En(t)&&this.updateUIClasses({mouse:W})}};On.onTap=On.onClick=function(e,t){if(En(t))return this.clickOnVertex(e,t);this.clickAnywhere(e,t)},On.onKeyUp=function(e,t){Pn(t)?this.changeMode(re,{featureIds:[e.line.id]}):Sn(t)&&(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(re))},On.onStop=function(e){_n.enable(this),this.activateUIButton(),void 0!==this.getFeature(e.line.id)&&(e.line.removeCoordinate(`${e.currentVertexPosition}`),e.line.isValid()?this.map.fire(ie,{features:[e.line.toGeoJSON()]}):(this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(re,{},{silent:!0})))},On.onTrash=function(e){this.deleteFeature([e.line.id],{silent:!0}),this.changeMode(re)},On.toDisplayFeatures=function(e,t,n){const r=t.properties.id===e.line.id;if(t.properties.active=r?ue:ae,!r)return n(t);t.geometry.coordinates.length<2||(t.properties.meta=se,n(Tn(e.line.id,t.geometry.coordinates["forward"===e.direction?t.geometry.coordinates.length-2:1],""+("forward"===e.direction?t.geometry.coordinates.length-2:1),!1)),n(t))};const{onSetup:kn,onMouseMove:An,...Rn}=On,Nn={originOnSetup:kn,originOnMouseMove:An,...Rn};Nn.onSetup=function(e){const t=this.originOnSetup(),{onDraw:n,onCancel:r}=e;return t.onDraw=n,t.onCancel=r,t},Nn.onMouseMove=function(e,t){this.updateUIClasses({mouse:z}),this.originOnMouseMove(e,t)},Nn.onStop=function(e){const t=e.line;this.updateUIClasses({mouse:H}),_n.enable(this),this.activateUIButton();void 0!==this.getFeature(t.id)?(t.removeCoordinate(`${e.currentVertexPosition}`),t.isValid()&&("function"==typeof e.onDraw?e.onDraw(t.toGeoJSON()):this.map.fire("draw.passing-create",{features:[t.toGeoJSON()]})),this.deleteFeature([t.id],{silent:!0}),this.changeMode(re,{},{silent:!0})):"function"==typeof e.onCancel&&e.onCancel()};const Gn={onSetup:function(){const e=this.newFeature({type:X,properties:{},geometry:{type:Q,coordinates:[[]]}});return this.addFeature(e),this.clearSelectedFeatures(),_n.disable(this),this.updateUIClasses({mouse:z}),this.activateUIButton(J),this.setActionableState({trash:!0}),{polygon:e,currentVertexPosition:0}},clickAnywhere:function(e,t){if(e.currentVertexPosition>0&&Fn(t,e.polygon.coordinates[0][e.currentVertexPosition-1]))return this.changeMode(re,{featureIds:[e.polygon.id]});this.updateUIClasses({mouse:z}),e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,t.lngLat.lng,t.lngLat.lat),e.currentVertexPosition++,e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,t.lngLat.lng,t.lngLat.lat)},clickOnVertex:function(e){return this.changeMode(re,{featureIds:[e.polygon.id]})},onMouseMove:function(e,t){e.polygon.updateCoordinate(`0.${e.currentVertexPosition}`,t.lngLat.lng,t.lngLat.lat),En(t)&&this.updateUIClasses({mouse:W})}};Gn.onTap=Gn.onClick=function(e,t){return En(t)?this.clickOnVertex(e,t):this.clickAnywhere(e,t)},Gn.onKeyUp=function(e,t){Sn(t)?(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(re)):Pn(t)&&this.changeMode(re,{featureIds:[e.polygon.id]})},Gn.onStop=function(e){this.updateUIClasses({mouse:H}),_n.enable(this),this.activateUIButton(),void 0!==this.getFeature(e.polygon.id)&&(e.polygon.removeCoordinate(`0.${e.currentVertexPosition}`),e.polygon.isValid()?this.map.fire(ie,{features:[e.polygon.toGeoJSON()]}):(this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(re,{},{silent:!0})))},Gn.toDisplayFeatures=function(e,t,n){const r=t.properties.id===e.polygon.id;if(t.properties.active=r?ue:ae,!r)return n(t);if(0===t.geometry.coordinates.length)return;const i=t.geometry.coordinates[0].length;if(!(i<3)){if(t.properties.meta=se,n(Tn(e.polygon.id,t.geometry.coordinates[0][0],"0.0",!1)),i>3){const r=t.geometry.coordinates[0].length-3;n(Tn(e.polygon.id,t.geometry.coordinates[0][r],`0.${r}`,!1))}if(i<=4){const e=[[t.geometry.coordinates[0][0][0],t.geometry.coordinates[0][0][1]],[t.geometry.coordinates[0][1][0],t.geometry.coordinates[0][1][1]]];if(n({type:X,properties:t.properties,geometry:{coordinates:e,type:ee}}),3===i)return}return n(t)}},Gn.onTrash=function(e){this.deleteFeature([e.polygon.id],{silent:!0}),this.changeMode(re)};const{onSetup:Bn,onMouseMove:Dn,...Un}=Gn,qn="select_feature",Vn=`${qn}_highlight`,jn={highlightColor:"#222"},$n={};function zn(e){return{...e,[qn]:$n}}$n.onSetup=function(e){const{selectHighlightColor:t,onSelect:n,onCancel:r}=e,i={hoveredFeatureID:null,selectedFeatureID:null};i.onSelect=n,i.onCancel=r,i.api=this._ctx.api;const{selectHighlightColor:o=jn.highlightColor}=this._ctx.options;return i.options={selectHighlightColor:t||o},i},$n.onMouseMove=function(e,t){const{api:n}=e,{featureTarget:r}=t;if(r){this.updateUIClasses({mouse:W});const t=r.properties.id;null!==e.hoveredFeatureID&&e.hoveredFeatureID!==t&&n.setFeatureProperty(e.hoveredFeatureID,Vn,void 0),e.hoveredFeatureID=t,n.setFeatureProperty(e.hoveredFeatureID,Vn,e.options.selectHighlightColor)}else e.hoveredFeatureID&&n.setFeatureProperty(e.hoveredFeatureID,Vn,void 0),e.hoveredFeatureID=null},$n.onClick=function(e,t){e.selectedFeatureID=e.hoveredFeatureID,this.onStop(e,t)},$n.toDisplayFeatures=function(e,t,n){n(t)},$n.onKeyUp=function(e,t){Sn(t)&&this.changeMode(re)},$n.onStop=function(e){this.updateUIClasses({mouse:H}),_n.enable(this),this.activateUIButton(),e.selectedFeatureID?("function"==typeof e.onSelect?e.onSelect(e.selectedFeatureID):this.map.fire("draw.select_mode.select",{featureID:e.selectedFeatureID}),e.selectedFeatureID=null,this.changeMode(re,{},{silent:!0})):"function"==typeof e.onCancel&&e.onCancel(),e.hoveredFeatureID&&(this._ctx.api.setFeatureProperty(e.hoveredFeatureID,Vn,void 0),e.hoveredFeatureID=null)},e.Constants=wn,e.default=function(e){return{...zn(e),[yn]:Nn,[gn]:bn}},e.drawStyles=e=>e.map((e=>e.id.endsWith("inactive")?{...e,filter:[...e.filter,["!has",xn]]}:e)).concat([{id:"split_polygon-fill-active",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["has",xn]],paint:{"fill-color":["get",xn],"fill-outline-color":["get",xn],"fill-opacity":.1}},{id:"split_polygon-stroke-active",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["has",xn]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["get",xn],"line-dasharray":[.2,2],"line-width":2}}]),e.splitPolygonMode=bn,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=index.js.map
