!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).SplitPolygonMode={})}(this,(function(t){"use strict";function e(t){if(!t)throw new Error("geojson is required");switch(t.type){case"Feature":return n(t);case"FeatureCollection":return function(t){var e={type:"FeatureCollection"};return Object.keys(t).forEach((function(n){switch(n){case"type":case"features":return;default:e[n]=t[n]}})),e.features=t.features.map((function(t){return n(t)})),e}(t);case"Point":case"LineString":case"Polygon":case"MultiPoint":case"MultiLineString":case"MultiPolygon":case"GeometryCollection":return i(t);default:throw new Error("unknown GeoJSON type")}}function n(t){var e={type:"Feature"};return Object.keys(t).forEach((function(n){switch(n){case"type":case"properties":case"geometry":return;default:e[n]=t[n]}})),e.properties=r(t.properties),e.geometry=i(t.geometry),e}function r(t){var e={};return t?(Object.keys(t).forEach((function(n){var i=t[n];"object"==typeof i?null===i?e[n]=null:Array.isArray(i)?e[n]=i.map((function(t){return t})):e[n]=r(i):e[n]=i})),e):e}function i(t){var e={type:t.type};return t.bbox&&(e.bbox=t.bbox),"GeometryCollection"===t.type?(e.geometries=t.geometries.map((function(t){return i(t)})),e):(e.coordinates=o(t.coordinates),e)}function o(t){var e=t;return"object"!=typeof e[0]?e.slice():e.map((function(t){return o(t)}))}var s=6371008.8,u={centimeters:637100880,centimetres:637100880,degrees:57.22891354143274,feet:20902260.511392,inches:39.37*s,kilometers:6371.0088,kilometres:6371.0088,meters:s,metres:s,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:s/1852,radians:1,yards:6967335.223679999};function a(t,e,n){void 0===n&&(n={});var r={type:"Feature"};return(0===n.id||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}function l(t,e,n){void 0===n&&(n={});for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var s=0;s<o[o.length-1].length;s++)if(o[o.length-1][s]!==o[0][s])throw new Error("First and last Position are not equivalent.")}return a({type:"Polygon",coordinates:t},e,n)}function h(t,e,n){if(void 0===n&&(n={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");return a({type:"LineString",coordinates:t},e,n)}function c(t,e){void 0===e&&(e={});var n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}function f(t,e,n){return void 0===n&&(n={}),a({type:"MultiLineString",coordinates:t},e,n)}function p(t,e,n){return void 0===n&&(n={}),a({type:"MultiPolygon",coordinates:t},e,n)}function g(t,e){return n=function(t,e){void 0===e&&(e="kilometers");var n=u[e];if(!n)throw new Error(e+" units is invalid");return t/n}(t,e),n%(2*Math.PI)*180/Math.PI;var n}function d(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}function y(t){return!!t&&t.constructor===Object}function v(t){if(Array.isArray(t))return t;if("Feature"===t.type){if(null!==t.geometry)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function m(t){return"Feature"===t.type?t.geometry:t}function x(t){for(var e,n,r=v(t),i=0,o=1;o<r.length;)e=n||r[0],i+=((n=r[o])[0]-e[0])*(n[1]+e[1]),o++;return i>0}function b(t,e,n){if(null!==t)for(var r,i,o,s,u,a,l,h,c=0,f=0,p=t.type,g="FeatureCollection"===p,d="Feature"===p,y=g?t.features.length:1,v=0;v<y;v++){u=(h=!!(l=g?t.features[v].geometry:d?t.geometry:t)&&"GeometryCollection"===l.type)?l.geometries.length:1;for(var m=0;m<u;m++){var x=0,w=0;if(null!==(s=h?l.geometries[m]:l)){a=s.coordinates;var E=s.type;switch(c=!n||"Polygon"!==E&&"MultiPolygon"!==E?0:1,E){case null:break;case"Point":if(!1===e(a,f,v,x,w))return!1;f++,x++;break;case"LineString":case"MultiPoint":for(r=0;r<a.length;r++){if(!1===e(a[r],f,v,x,w))return!1;f++,"MultiPoint"===E&&x++}"LineString"===E&&x++;break;case"Polygon":case"MultiLineString":for(r=0;r<a.length;r++){for(i=0;i<a[r].length-c;i++){if(!1===e(a[r][i],f,v,x,w))return!1;f++}"MultiLineString"===E&&x++,"Polygon"===E&&w++}"Polygon"===E&&x++;break;case"MultiPolygon":for(r=0;r<a.length;r++){for(w=0,i=0;i<a[r].length;i++){for(o=0;o<a[r][i].length-c;o++){if(!1===e(a[r][i][o],f,v,x,w))return!1;f++}w++}x++}break;case"GeometryCollection":for(r=0;r<s.geometries.length;r++)if(!1===b(s.geometries[r],e,n))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function w(t,e){if("Feature"===t.type)e(t,0);else if("FeatureCollection"===t.type)for(var n=0;n<t.features.length&&!1!==e(t.features[n],n);n++);}function E(t,e){var n,r,i,o,s,u,a,l,h,c,f=0,p="FeatureCollection"===t.type,g="Feature"===t.type,d=p?t.features.length:1;for(n=0;n<d;n++){for(u=p?t.features[n].geometry:g?t.geometry:t,l=p?t.features[n].properties:g?t.properties:{},h=p?t.features[n].bbox:g?t.bbox:void 0,c=p?t.features[n].id:g?t.id:void 0,s=(a=!!u&&"GeometryCollection"===u.type)?u.geometries.length:1,i=0;i<s;i++)if(null!==(o=a?u.geometries[i]:u))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(o,f,l,h,c))return!1;break;case"GeometryCollection":for(r=0;r<o.geometries.length;r++)if(!1===e(o.geometries[r],f,l,h,c))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===e(null,f,l,h,c))return!1;f++}}function S(t,e){E(t,(function(t,n,r,i,o){var s,u=null===t?null:t.type;switch(u){case null:case"Point":case"LineString":case"Polygon":return!1!==e(a(t,r,{bbox:i,id:o}),n,0)&&void 0}switch(u){case"MultiPoint":s="Point";break;case"MultiLineString":s="LineString";break;case"MultiPolygon":s="Polygon"}for(var l=0;l<t.coordinates.length;l++){var h=t.coordinates[l];if(!1===e(a({type:s,coordinates:h},r),n,l))return!1}}))}function P(t,e){switch("Feature"===t.type?t.geometry.type:t.type){case"GeometryCollection":return E(t,(function(t){P(t,e)})),t;case"LineString":return _(v(t),e),t;case"Polygon":return k(v(t),e),t;case"MultiLineString":return v(t).forEach((function(t){_(t,e)})),t;case"MultiPolygon":return v(t).forEach((function(t){k(t,e)})),t;case"Point":case"MultiPoint":return t}}function _(t,e){x(t)===e&&t.reverse()}function k(t,e){x(t[0])!==e&&t[0].reverse();for(var n=1;n<t.length;n++)x(t[n])===e&&t[n].reverse()}function M(t,e){for(var n=0,r=0,i=0,o=0,s=0,u=0,a=0,l=0,h=null,c=null,f=t[0],p=t[1],g=e.length;n<g;n++){r=0;var d=e[n].length-1,y=e[n];if((h=y[0])[0]!==y[d][0]&&h[1]!==y[d][1])throw new Error("First and last coordinates in a ring must be the same");for(s=h[0]-f,u=h[1]-p;r<d;r++)if(l=(c=y[r+1])[1]-p,u<0&&l<0||u>0&&l>0)u=l,s=(h=c)[0]-f;else{if(a=c[0]-t[0],l>0&&u<=0){if((o=s*l-a*u)>0)i+=1;else if(0===o)return 0}else if(u>0&&l<=0){if((o=s*l-a*u)<0)i+=1;else if(0===o)return 0}else if(0===l&&u<0){if(0===(o=s*l-a*u))return 0}else if(0===u&&l<0){if(0===(o=s*l-a*u))return 0}else if(0===u&&0===l){if(a<=0&&s>=0)return 0;if(s<=0&&a>=0)return 0}h=c,u=l,s=a}}return i%2!=0}const I=134217729;function C(t,e,n,r,i){let o,s,u,a,l=e[0],h=r[0],c=0,f=0;h>l==h>-l?(o=l,l=e[++c]):(o=h,h=r[++f]);let p=0;if(c<t&&f<n)for(h>l==h>-l?(s=l+o,u=o-(s-l),l=e[++c]):(s=h+o,u=o-(s-h),h=r[++f]),o=s,0!==u&&(i[p++]=u);c<t&&f<n;)h>l==h>-l?(s=o+l,a=s-o,u=o-(s-a)+(l-a),l=e[++c]):(s=o+h,a=s-o,u=o-(s-a)+(h-a),h=r[++f]),o=s,0!==u&&(i[p++]=u);for(;c<t;)s=o+l,a=s-o,u=o-(s-a)+(l-a),l=e[++c],o=s,0!==u&&(i[p++]=u);for(;f<n;)s=o+h,a=s-o,u=o-(s-a)+(h-a),h=r[++f],o=s,0!==u&&(i[p++]=u);return 0===o&&0!==p||(i[p++]=o),p}function F(t){return new Float64Array(t)}const R=F(4),L=F(8),A=F(12),O=F(16),B=F(4);function Y(t,e,n,r,i,o){const s=(e-o)*(n-i),u=(t-i)*(r-o),a=s-u;if(0===s||0===u||s>0!=u>0)return a;const l=Math.abs(s+u);return Math.abs(a)>=33306690738754716e-32*l?a:-function(t,e,n,r,i,o,s){let u,a,l,h,c,f,p,g,d,y,v,m,x,b,w,E,S,P;const _=t-i,k=n-i,M=e-o,F=r-o;b=_*F,f=I*_,p=f-(f-_),g=_-p,f=I*F,d=f-(f-F),y=F-d,w=g*y-(b-p*d-g*d-p*y),E=M*k,f=I*M,p=f-(f-M),g=M-p,f=I*k,d=f-(f-k),y=k-d,S=g*y-(E-p*d-g*d-p*y),v=w-S,c=w-v,R[0]=w-(v+c)+(c-S),m=b+v,c=m-b,x=b-(m-c)+(v-c),v=x-E,c=x-v,R[1]=x-(v+c)+(c-E),P=m+v,c=P-m,R[2]=m-(P-c)+(v-c),R[3]=P;let Y=function(t,e){let n=e[0];for(let r=1;r<t;r++)n+=e[r];return n}(4,R),N=22204460492503146e-32*s;if(Y>=N||-Y>=N)return Y;if(c=t-_,u=t-(_+c)+(c-i),c=n-k,l=n-(k+c)+(c-i),c=e-M,a=e-(M+c)+(c-o),c=r-F,h=r-(F+c)+(c-o),0===u&&0===a&&0===l&&0===h)return Y;if(N=11093356479670487e-47*s+33306690738754706e-32*Math.abs(Y),Y+=_*h+F*u-(M*l+k*a),Y>=N||-Y>=N)return Y;b=u*F,f=I*u,p=f-(f-u),g=u-p,f=I*F,d=f-(f-F),y=F-d,w=g*y-(b-p*d-g*d-p*y),E=a*k,f=I*a,p=f-(f-a),g=a-p,f=I*k,d=f-(f-k),y=k-d,S=g*y-(E-p*d-g*d-p*y),v=w-S,c=w-v,B[0]=w-(v+c)+(c-S),m=b+v,c=m-b,x=b-(m-c)+(v-c),v=x-E,c=x-v,B[1]=x-(v+c)+(c-E),P=m+v,c=P-m,B[2]=m-(P-c)+(v-c),B[3]=P;const X=C(4,R,4,B,L);b=_*h,f=I*_,p=f-(f-_),g=_-p,f=I*h,d=f-(f-h),y=h-d,w=g*y-(b-p*d-g*d-p*y),E=M*l,f=I*M,p=f-(f-M),g=M-p,f=I*l,d=f-(f-l),y=l-d,S=g*y-(E-p*d-g*d-p*y),v=w-S,c=w-v,B[0]=w-(v+c)+(c-S),m=b+v,c=m-b,x=b-(m-c)+(v-c),v=x-E,c=x-v,B[1]=x-(v+c)+(c-E),P=m+v,c=P-m,B[2]=m-(P-c)+(v-c),B[3]=P;const j=C(X,L,4,B,A);b=u*h,f=I*u,p=f-(f-u),g=u-p,f=I*h,d=f-(f-h),y=h-d,w=g*y-(b-p*d-g*d-p*y),E=a*l,f=I*a,p=f-(f-a),g=a-p,f=I*l,d=f-(f-l),y=l-d,S=g*y-(E-p*d-g*d-p*y),v=w-S,c=w-v,B[0]=w-(v+c)+(c-S),m=b+v,c=m-b,x=b-(m-c)+(v-c),v=x-E,c=x-v,B[1]=x-(v+c)+(c-E),P=m+v,c=P-m,B[2]=m-(P-c)+(v-c),B[3]=P;const G=C(j,A,4,B,O);return O[G-1]}(t,e,n,r,i,o,l)}var N=function(t,e,n,r,i){this.p1=t,this.p2=e,this.edgeType=n,this.originalIndex=r,this.polygonContourId=i,this.interiorRing=!1,this.minX=Math.min(t.p[0],e.p[0]),this.minY=Math.min(t.p[1],e.p[1]),this.maxX=Math.max(t.p[0],e.p[0]),this.maxY=Math.max(t.p[1],e.p[1]),this.intersectionPoints=[],this.nextEdge=null},X=function(t){this.p=t},j=function(t,e){this.id=t,this.rawCoords=e};function G(t,e){return!(t.maxX<e[0])&&(!(t.minX>e[2])&&(!(t.maxY<e[1])&&!(t.minY>e[3])))}var U=function(t,e,n,r){this.p=t,this.polylineEdge=e,this.polygonEdge=n,this.isHeadingIn=r,this.distanceFromPolylineEdgeStart=T(this.polylineEdge.p1.p,this.p),this.distanceFromPolygonEdgeStart=T(this.polygonEdge.p1.p,this.p),this.polygonEdge.intersectionPoints.push(this),this.polylineEdge.intersectionPoints.push(this),this.visitCount=0};function T(t,e){var n=e[0]-t[0],r=e[1]-t[1];return n*=n,r*=r,Math.sqrt(n+r)}U.prototype.incrementVisitCount=function(){this.visitCount=this.visitCount+1};function V(t,e){return t[0]*e[1]-t[1]*e[0]}function D(t,e){return t[0]*e[0]+t[1]*e[1]}function q(t,e,n){return[t[0]+e*n[0],t[1]+e*n[1]]}function z(t,e,n){var r=[t.p2.p[0]-t.p1.p[0],t.p2.p[1]-t.p1.p[1]],i=[e.p2.p[0]-e.p1.p[0],e.p2.p[1]-e.p1.p[1]],o=[e.p1.p[0]-t.p1.p[0],e.p1.p[1]-t.p1.p[1]],s=V(r,i),u=s*s,a=D(r,r);if(u>0){var l=V(o,i)/s;if(l<0||l>1)return null;var h=V(o,r)/s;return h<0||h>1?null:0===l||1===l?n?null:[q(t.p1.p,l,r)]:0===h||1===h?n?null:[q(e.p1.p,h,i)]:[q(t.p1.p,l,r)]}var c=D(o,o);if((u=(s=V(o,r))*s)>1e-9*a*c)return null;var f=D(r,o)/a,p=f+D(r,i)/a,g=Math.min(f,p),d=Math.max(f,p);return g<=1&&d>=0?1===g?n?null:[q(t.p1.p,g>0?g:0,r)]:0===d?n?null:[q(t.p1.p,d<1?d:1,r)]:n&&0===g&&1===d?null:[q(t.p1.p,g>0?g:0,r),q(t.p1.p,d<1?d:1,r)]:null}function J(t,n){var r=function(t,n){if(!y(n=n||{}))throw new Error("options is invalid");var r=n.reverse||!1,i=n.mutate||!1;if(!t)throw new Error("<geojson> is required");if("boolean"!=typeof r)throw new Error("<reverse> must be a boolean");if("boolean"!=typeof i)throw new Error("<mutate> must be a boolean");!1===i&&(t=e(t));var o=[];switch(t.type){case"GeometryCollection":return E(t,(function(t){P(t,r)})),t;case"FeatureCollection":return w(t,(function(t){w(P(t,r),(function(t){o.push(t)}))})),c(o)}return P(t,r)}(t),i=[],o=[],s=[],u=function(t,e,n,r,i){for(var o=0,s=[],u="Feature"===e.type?e.geometry:e,a="LineString"===u.type?[u.coordinates]:u.coordinates,l=0,h=0;h<a.length;h++){for(var c=a[h].length-1,f=new X(a[h][0]),p=null,g={nextEdge:null},d=0;d<c;d++){p=new X(a[h][d+1]),f.nextPoint=p,p.prevPoint=f;var y=new N(f,p,"polyline",l,null);r.push(y),g.nextEdge=y,y.prevEdge=g,i[0]=Math.min(i[0],f.p[0]),i[1]=Math.min(i[1],f.p[1]),i[2]=Math.max(i[2],f.p[0]),i[3]=Math.max(i[3],f.p[1]),f=p,l+=1,g=y}i[0]=Math.min(i[0],a[h][c][0]),i[1]=Math.min(i[1],a[h][c][1]),i[2]=Math.max(i[2],a[h][c][0]),i[3]=Math.max(i[3],a[h][c][1])}for(var v="Feature"===t.type?t.geometry:t,m="Polygon"===v.type?[v.coordinates]:v.coordinates,x=m.length,b=0;b<x;b++)for(var w=m[b].length,E=0;E<w;E++){o+=1;var S=m[b][E],P=S.length;s.push(new j(o,S));for(var _=new X(S[0]),k=_,M=void 0,I=null,C={nextEdge:null,prevEdge:null},F=null,R=1;R<P;R++)M=new X(S[R]),k.nextPoint=M,M.prevPoint=k,I=new N(k,M,"polygon",l,o),C.nextEdge=I,I.prevEdge=C,1===R&&(F=I),E>0&&(I.interiorRing=!0),I.intersectPolylineBbox=G(I,i),n.push(I),k=M,l+=1,C=I;I.nextEdge=F,F.prevEdge=I,M.nextPoint=_.nextPoint,_.prevPoint=M.prevPoint}return s}(r,n,o,s,[1/0,1/0,1/0,1/0]);if(function(t,e,n){var r,i,o,s=e.length,u=t.length;for(r=0;r<s;r++){var a=e[r];for(i=0;i<u;i++){var l=t[i];if(l.intersectPolylineBbox&&!(l.maxX<a.minX||l.minX>a.maxX||l.maxY<a.minY||l.minY>a.maxY)){var h=z(a,l);if(null!==h)for(o=0;o<h.length;o++){var c=Y(l.p1.p[0],l.p1.p[1],l.p2.p[0],l.p2.p[1],a.p1.p[0],a.p1.p[1]),f=new U(h[o],a,l,c>0);n.push(f)}}}}e.forEach((function(t){t.intersectionPoints.sort((function(t,e){return t.distanceFromPolylineEdgeStart-e.distanceFromPolylineEdgeStart}))})),t.forEach((function(t){t.intersectionPoints.sort((function(t,e){return t.distanceFromPolygonEdgeStart-e.distanceFromPolygonEdgeStart}))}))}(o,s,i),0===i.length)return t;var a={};u.forEach((function(t){return a[t.id]=0})),i.forEach((function(t){var e=t.polygonEdge.polygonContourId;a[e]=a[e]+1}));for(var l=0,h=[],f=null,p=0;p<s.length;p++){var g=s[p];if(g.intersectionPoints.length>0){f=g.intersectionPoints[0];break}}for(var d=f,v={visitCount:1};f!==v&&!(l>2*i.length);){if(l=l++,v.visitCount>=2){for(var m=!1,x=0;x<i.length;x++){var b=i[x];if(b.visitCount<2){d=b,m=!0;break}}if(!m)break}d.visitCount=d.visitCount+1;var S=[];h.push(S),S.push(d.p),d.visitCount=d.visitCount+1;var _=Z(d,S),k=!1;if(_===(v=_)&&2===i.length)for(var M=0;M<i.length;M++){i[M].visitCount<2&&(k=!0)}for(;_!==d||k;){(_=(_.isHeadingIn?tt:Q)(_,S))!==d&&(_=Z(_,S)),k=!1}if(v.visitCount>=2){for(var I=!1,C=0;C<i.length;C++){var F=i[C];if(F.visitCount<2){d=F,I=!0;break}}I&&(v=d)}d=v}for(var R=h.map((function(t){return[t]})),L=Object.keys(a),A=0;A<L.length;A++){var O=L[A];if(0===a[O])H($(W(o,parseInt(O)),u),R)}return{type:"Feature",properties:{},geometry:{type:"MultiPolygon",coordinates:R}}}function W(t,e){for(var n=0;n<t.length;n++){var r=t[n];if(r.polygonContourId===e)return r}}function $(t,e){return e.find((function(e){return e.id===t.polygonContourId})).rawCoords}function H(t,e){for(var n=0;n<e.length;n++){var r=e[n];if(M(t[0],[r[0]]))return void r.push(t)}e.push([t])}function Z(t,e){var n=t.polygonEdge;if(n.intersectionPoints.length>1&&n.intersectionPoints[n.intersectionPoints.length-1]!==t){var r=K(t,n.intersectionPoints),i=n.intersectionPoints[r+1];return e.push(i.p),i.incrementVisitCount(),i}for(var o=!0;o;){if(e.push(n.p2.p),null===(n=n.nextEdge))return t;n.intersectionPoints.length>0&&(o=!1)}return n.intersectionPoints[0].incrementVisitCount(),e.push(n.intersectionPoints[0].p),n.intersectionPoints[0]}function K(t,e){for(var n=0;n<e.length;n++){if(e[n]===t)return n}return null}function Q(t,e){var n=t.polylineEdge;if(2===n.intersectionPoints.length){var r=n.intersectionPoints[n.intersectionPoints.length-1];if(r===t){var i=n.intersectionPoints[0];return e.push(i.p),i.incrementVisitCount(),i}return e.push(r.p),r.incrementVisitCount(),r}if(n.intersectionPoints.length>2&&n.intersectionPoints[0]!==t){var o=K(t,n.intersectionPoints),s=n.intersectionPoints[o-1];return e.push(s.p),s.incrementVisitCount(),s}for(var u=!0;u;){if(e.push(n.p1.p),void 0===(n=n.prevEdge).originalIndex)return t;n.intersectionPoints.length>0&&(u=!1)}if(void 0===n.originalIndex)return t;var a=n.intersectionPoints[n.intersectionPoints.length-1];return a.incrementVisitCount(),e.push(a.p),a}function tt(t,e){var n=t.polylineEdge;if(n.intersectionPoints.length>1&&n.intersectionPoints[n.intersectionPoints.length-1]!==t){var r=K(t,n.intersectionPoints),i=n.intersectionPoints[r+1];return e.push(i.p),i.incrementVisitCount(),i}for(var o=!0;o;){if(e.push(n.p2.p),null===(n=n.nextEdge))return t;n.intersectionPoints.length>0&&(o=!1)}if(void 0===n)return t;var s=n.intersectionPoints[0];return s.incrementVisitCount(),e.push(s.p),s}const et="add",nt="move",rt="pointer",it="none",ot="polygon",st="line_string",ut="point",at="Feature",lt="Polygon",ht="LineString",ct="Point",ft="MultiPolygon",pt="simple_select",gt="draw.create",dt="draw.update",yt="feature",vt="vertex",mt="true",xt="false";function bt(t){if(!t)throw new Error("geojson is required");var e=[];return S(t,(function(t){!function(t,e){var n=[],r=t.geometry;if(null!==r){switch(r.type){case"Polygon":n=v(r);break;case"LineString":n=[v(r)]}n.forEach((function(n){var r=function(t,e){var n=[];return t.reduce((function(t,r){var i,o,s,u,a,l,c=h([t,r],e);return c.bbox=(o=r,s=(i=t)[0],u=i[1],a=o[0],l=o[1],[s<a?s:a,u<l?u:l,s>a?s:a,u>l?u:l]),n.push(c),r})),n}(n,t.properties);r.forEach((function(t){t.id=e.length,e.push(t)}))}))}}(t,e)})),c(e)}function wt(t){var e=t.default;if("function"==typeof e){var n=function(){return e.apply(this,arguments)};n.prototype=e.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(t).forEach((function(e){var r=Object.getOwnPropertyDescriptor(t,e);Object.defineProperty(n,e,r.get?r:{enumerable:!0,get:function(){return t[e]}})})),n}var Et={exports:{}};function St(t,e,n,r,i){Pt(t,e,n||0,r||t.length-1,i||kt)}function Pt(t,e,n,r,i){for(;r>n;){if(r-n>600){var o=r-n+1,s=e-n+1,u=Math.log(o),a=.5*Math.exp(2*u/3),l=.5*Math.sqrt(u*a*(o-a)/o)*(s-o/2<0?-1:1);Pt(t,e,Math.max(n,Math.floor(e-s*a/o+l)),Math.min(r,Math.floor(e+(o-s)*a/o+l)),i)}var h=t[e],c=n,f=r;for(_t(t,n,e),i(t[r],h)>0&&_t(t,n,r);c<f;){for(_t(t,c,f),c++,f--;i(t[c],h)<0;)c++;for(;i(t[f],h)>0;)f--}0===i(t[n],h)?_t(t,n,f):_t(t,++f,r),f<=e&&(n=f+1),e<=f&&(r=f-1)}}function _t(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function kt(t,e){return t<e?-1:t>e?1:0}function Mt(t,e,n){if(!n)return e.indexOf(t);for(let r=0;r<e.length;r++)if(n(t,e[r]))return r;return-1}function It(t,e){Ct(t,0,t.children.length,e,t)}function Ct(t,e,n,r,i){i||(i=Xt(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(let o=e;o<n;o++){const e=t.children[o];Ft(i,t.leaf?r(e):e)}return i}function Ft(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function Rt(t,e){return t.minX-e.minX}function Lt(t,e){return t.minY-e.minY}function At(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function Ot(t){return t.maxX-t.minX+(t.maxY-t.minY)}function Bt(t,e){const n=Math.max(t.minX,e.minX),r=Math.max(t.minY,e.minY),i=Math.min(t.maxX,e.maxX),o=Math.min(t.maxY,e.maxY);return Math.max(0,i-n)*Math.max(0,o-r)}function Yt(t,e){return t.minX<=e.minX&&t.minY<=e.minY&&e.maxX<=t.maxX&&e.maxY<=t.maxY}function Nt(t,e){return e.minX<=t.maxX&&e.minY<=t.maxY&&e.maxX>=t.minX&&e.maxY>=t.minY}function Xt(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function jt(t,e,n,r,i){const o=[e,n];for(;o.length;){if((n=o.pop())-(e=o.pop())<=r)continue;const s=e+Math.ceil((n-e)/r/2)*r;St(t,s,e,n,i),o.push(e,s,s,n)}}var Gt=Object.freeze({__proto__:null,default:class{constructor(t=9){this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}all(){return this._all(this.data,[])}search(t){let e=this.data;const n=[];if(!Nt(t,e))return n;const r=this.toBBox,i=[];for(;e;){for(let o=0;o<e.children.length;o++){const s=e.children[o],u=e.leaf?r(s):s;Nt(t,u)&&(e.leaf?n.push(s):Yt(t,u)?this._all(s,n):i.push(s))}e=i.pop()}return n}collides(t){let e=this.data;if(!Nt(t,e))return!1;const n=[];for(;e;){for(let r=0;r<e.children.length;r++){const i=e.children[r],o=e.leaf?this.toBBox(i):i;if(Nt(t,o)){if(e.leaf||Yt(t,o))return!0;n.push(i)}}e=n.pop()}return!1}load(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(let e=0;e<t.length;e++)this.insert(t[e]);return this}let e=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===e.height)this._splitRoot(this.data,e);else{if(this.data.height<e.height){const t=this.data;this.data=e,e=t}this._insert(e,this.data.height-e.height-1,!0)}else this.data=e;return this}insert(t){return t&&this._insert(t,this.data.height-1),this}clear(){return this.data=Xt([]),this}remove(t,e){if(!t)return this;let n=this.data;const r=this.toBBox(t),i=[],o=[];let s,u,a;for(;n||i.length;){if(n||(n=i.pop(),u=i[i.length-1],s=o.pop(),a=!0),n.leaf){const r=Mt(t,n.children,e);if(-1!==r)return n.children.splice(r,1),i.push(n),this._condense(i),this}a||n.leaf||!Yt(n,r)?u?(s++,n=u.children[s],a=!1):n=null:(i.push(n),o.push(s),s=0,u=n,n=n.children[0])}return this}toBBox(t){return t}compareMinX(t,e){return t.minX-e.minX}compareMinY(t,e){return t.minY-e.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}_all(t,e){const n=[];for(;t;)t.leaf?e.push(...t.children):n.push(...t.children),t=n.pop();return e}_build(t,e,n,r){const i=n-e+1;let o,s=this._maxEntries;if(i<=s)return o=Xt(t.slice(e,n+1)),It(o,this.toBBox),o;r||(r=Math.ceil(Math.log(i)/Math.log(s)),s=Math.ceil(i/Math.pow(s,r-1))),o=Xt([]),o.leaf=!1,o.height=r;const u=Math.ceil(i/s),a=u*Math.ceil(Math.sqrt(s));jt(t,e,n,a,this.compareMinX);for(let i=e;i<=n;i+=a){const e=Math.min(i+a-1,n);jt(t,i,e,u,this.compareMinY);for(let n=i;n<=e;n+=u){const i=Math.min(n+u-1,e);o.children.push(this._build(t,n,i,r-1))}}return It(o,this.toBBox),o}_chooseSubtree(t,e,n,r){for(;r.push(e),!e.leaf&&r.length-1!==n;){let n,r=1/0,s=1/0;for(let u=0;u<e.children.length;u++){const a=e.children[u],l=At(a),h=(i=t,o=a,(Math.max(o.maxX,i.maxX)-Math.min(o.minX,i.minX))*(Math.max(o.maxY,i.maxY)-Math.min(o.minY,i.minY))-l);h<s?(s=h,r=l<r?l:r,n=a):h===s&&l<r&&(r=l,n=a)}e=n||e.children[0]}var i,o;return e}_insert(t,e,n){const r=n?t:this.toBBox(t),i=[],o=this._chooseSubtree(r,this.data,e,i);for(o.children.push(t),Ft(o,r);e>=0&&i[e].children.length>this._maxEntries;)this._split(i,e),e--;this._adjustParentBBoxes(r,i,e)}_split(t,e){const n=t[e],r=n.children.length,i=this._minEntries;this._chooseSplitAxis(n,i,r);const o=this._chooseSplitIndex(n,i,r),s=Xt(n.children.splice(o,n.children.length-o));s.height=n.height,s.leaf=n.leaf,It(n,this.toBBox),It(s,this.toBBox),e?t[e-1].children.push(s):this._splitRoot(n,s)}_splitRoot(t,e){this.data=Xt([t,e]),this.data.height=t.height+1,this.data.leaf=!1,It(this.data,this.toBBox)}_chooseSplitIndex(t,e,n){let r,i=1/0,o=1/0;for(let s=e;s<=n-e;s++){const e=Ct(t,0,s,this.toBBox),u=Ct(t,s,n,this.toBBox),a=Bt(e,u),l=At(e)+At(u);a<i?(i=a,r=s,o=l<o?l:o):a===i&&l<o&&(o=l,r=s)}return r||n-e}_chooseSplitAxis(t,e,n){const r=t.leaf?this.compareMinX:Rt,i=t.leaf?this.compareMinY:Lt;this._allDistMargin(t,e,n,r)<this._allDistMargin(t,e,n,i)&&t.children.sort(r)}_allDistMargin(t,e,n,r){t.children.sort(r);const i=this.toBBox,o=Ct(t,0,e,i),s=Ct(t,n-e,n,i);let u=Ot(o)+Ot(s);for(let r=e;r<n-e;r++){const e=t.children[r];Ft(o,t.leaf?i(e):e),u+=Ot(o)}for(let r=n-e-1;r>=e;r--){const e=t.children[r];Ft(s,t.leaf?i(e):e),u+=Ot(s)}return u}_adjustParentBBoxes(t,e,n){for(let r=n;r>=0;r--)Ft(e[r],t)}_condense(t){for(let e,n=t.length-1;n>=0;n--)0===t[n].children.length?n>0?(e=t[n-1].children,e.splice(e.indexOf(t[n]),1)):this.clear():It(t[n],this.toBBox)}}}),Ut=wt(Gt),Tt={};!function(t){function e(t,e,n){void 0===n&&(n={});var r={type:"Feature"};return(0===n.id||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}function n(t,n,r){if(void 0===r&&(r={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!f(t[0])||!f(t[1]))throw new Error("coordinates must contain numbers");return e({type:"Point",coordinates:t},n,r)}function r(t,n,r){void 0===r&&(r={});for(var i=0,o=t;i<o.length;i++){var s=o[i];if(s.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var u=0;u<s[s.length-1].length;u++)if(s[s.length-1][u]!==s[0][u])throw new Error("First and last Position are not equivalent.")}return e({type:"Polygon",coordinates:t},n,r)}function i(t,n,r){if(void 0===r&&(r={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");return e({type:"LineString",coordinates:t},n,r)}function o(t,e){void 0===e&&(e={});var n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}function s(t,n,r){return void 0===r&&(r={}),e({type:"MultiLineString",coordinates:t},n,r)}function u(t,n,r){return void 0===r&&(r={}),e({type:"MultiPoint",coordinates:t},n,r)}function a(t,n,r){return void 0===r&&(r={}),e({type:"MultiPolygon",coordinates:t},n,r)}function l(e,n){void 0===n&&(n="kilometers");var r=t.factors[n];if(!r)throw new Error(n+" units is invalid");return e*r}function h(e,n){void 0===n&&(n="kilometers");var r=t.factors[n];if(!r)throw new Error(n+" units is invalid");return e/r}function c(t){return 180*(t%(2*Math.PI))/Math.PI}function f(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}Object.defineProperty(t,"__esModule",{value:!0}),t.earthRadius=6371008.8,t.factors={centimeters:100*t.earthRadius,centimetres:100*t.earthRadius,degrees:t.earthRadius/111325,feet:3.28084*t.earthRadius,inches:39.37*t.earthRadius,kilometers:t.earthRadius/1e3,kilometres:t.earthRadius/1e3,meters:t.earthRadius,metres:t.earthRadius,miles:t.earthRadius/1609.344,millimeters:1e3*t.earthRadius,millimetres:1e3*t.earthRadius,nauticalmiles:t.earthRadius/1852,radians:1,yards:1.0936*t.earthRadius},t.unitsFactors={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/t.earthRadius,yards:1.0936133},t.areaFactors={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046},t.feature=e,t.geometry=function(t,e,o){switch(t){case"Point":return n(e).geometry;case"LineString":return i(e).geometry;case"Polygon":return r(e).geometry;case"MultiPoint":return u(e).geometry;case"MultiLineString":return s(e).geometry;case"MultiPolygon":return a(e).geometry;default:throw new Error(t+" is invalid")}},t.point=n,t.points=function(t,e,r){return void 0===r&&(r={}),o(t.map((function(t){return n(t,e)})),r)},t.polygon=r,t.polygons=function(t,e,n){return void 0===n&&(n={}),o(t.map((function(t){return r(t,e)})),n)},t.lineString=i,t.lineStrings=function(t,e,n){return void 0===n&&(n={}),o(t.map((function(t){return i(t,e)})),n)},t.featureCollection=o,t.multiLineString=s,t.multiPoint=u,t.multiPolygon=a,t.geometryCollection=function(t,n,r){return void 0===r&&(r={}),e({type:"GeometryCollection",geometries:t},n,r)},t.round=function(t,e){if(void 0===e&&(e=0),e&&!(e>=0))throw new Error("precision must be a positive number");var n=Math.pow(10,e||0);return Math.round(t*n)/n},t.radiansToLength=l,t.lengthToRadians=h,t.lengthToDegrees=function(t,e){return c(h(t,e))},t.bearingToAzimuth=function(t){var e=t%360;return e<0&&(e+=360),e},t.radiansToDegrees=c,t.degreesToRadians=function(t){return t%360*Math.PI/180},t.convertLength=function(t,e,n){if(void 0===e&&(e="kilometers"),void 0===n&&(n="kilometers"),!(t>=0))throw new Error("length must be a positive number");return l(h(t,e),n)},t.convertArea=function(e,n,r){if(void 0===n&&(n="meters"),void 0===r&&(r="kilometers"),!(e>=0))throw new Error("area must be a positive number");var i=t.areaFactors[n];if(!i)throw new Error("invalid original units");var o=t.areaFactors[r];if(!o)throw new Error("invalid final units");return e/i*o},t.isNumber=f,t.isObject=function(t){return!!t&&t.constructor===Object},t.validateBBox=function(t){if(!t)throw new Error("bbox is required");if(!Array.isArray(t))throw new Error("bbox must be an Array");if(4!==t.length&&6!==t.length)throw new Error("bbox must be an Array of 4 or 6 numbers");t.forEach((function(t){if(!f(t))throw new Error("bbox must only contain numbers")}))},t.validateId=function(t){if(!t)throw new Error("id is required");if(-1===["string","number"].indexOf(typeof t))throw new Error("id must be a number or a string")}}(Tt);var Vt={};Object.defineProperty(Vt,"__esModule",{value:!0});var Dt=Tt;function qt(t,e,n){if(null!==t)for(var r,i,o,s,u,a,l,h,c=0,f=0,p=t.type,g="FeatureCollection"===p,d="Feature"===p,y=g?t.features.length:1,v=0;v<y;v++){u=(h=!!(l=g?t.features[v].geometry:d?t.geometry:t)&&"GeometryCollection"===l.type)?l.geometries.length:1;for(var m=0;m<u;m++){var x=0,b=0;if(null!==(s=h?l.geometries[m]:l)){a=s.coordinates;var w=s.type;switch(c=!n||"Polygon"!==w&&"MultiPolygon"!==w?0:1,w){case null:break;case"Point":if(!1===e(a,f,v,x,b))return!1;f++,x++;break;case"LineString":case"MultiPoint":for(r=0;r<a.length;r++){if(!1===e(a[r],f,v,x,b))return!1;f++,"MultiPoint"===w&&x++}"LineString"===w&&x++;break;case"Polygon":case"MultiLineString":for(r=0;r<a.length;r++){for(i=0;i<a[r].length-c;i++){if(!1===e(a[r][i],f,v,x,b))return!1;f++}"MultiLineString"===w&&x++,"Polygon"===w&&b++}"Polygon"===w&&x++;break;case"MultiPolygon":for(r=0;r<a.length;r++){for(b=0,i=0;i<a[r].length;i++){for(o=0;o<a[r][i].length-c;o++){if(!1===e(a[r][i][o],f,v,x,b))return!1;f++}b++}x++}break;case"GeometryCollection":for(r=0;r<s.geometries.length;r++)if(!1===qt(s.geometries[r],e,n))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function zt(t,e){var n;switch(t.type){case"FeatureCollection":for(n=0;n<t.features.length&&!1!==e(t.features[n].properties,n);n++);break;case"Feature":e(t.properties,0)}}function Jt(t,e){if("Feature"===t.type)e(t,0);else if("FeatureCollection"===t.type)for(var n=0;n<t.features.length&&!1!==e(t.features[n],n);n++);}function Wt(t,e){var n,r,i,o,s,u,a,l,h,c,f=0,p="FeatureCollection"===t.type,g="Feature"===t.type,d=p?t.features.length:1;for(n=0;n<d;n++){for(u=p?t.features[n].geometry:g?t.geometry:t,l=p?t.features[n].properties:g?t.properties:{},h=p?t.features[n].bbox:g?t.bbox:void 0,c=p?t.features[n].id:g?t.id:void 0,s=(a=!!u&&"GeometryCollection"===u.type)?u.geometries.length:1,i=0;i<s;i++)if(null!==(o=a?u.geometries[i]:u))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(o,f,l,h,c))return!1;break;case"GeometryCollection":for(r=0;r<o.geometries.length;r++)if(!1===e(o.geometries[r],f,l,h,c))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===e(null,f,l,h,c))return!1;f++}}function $t(t,e){Wt(t,(function(t,n,r,i,o){var s,u=null===t?null:t.type;switch(u){case null:case"Point":case"LineString":case"Polygon":return!1!==e(Dt.feature(t,r,{bbox:i,id:o}),n,0)&&void 0}switch(u){case"MultiPoint":s="Point";break;case"MultiLineString":s="LineString";break;case"MultiPolygon":s="Polygon"}for(var a=0;a<t.coordinates.length;a++){var l={type:s,coordinates:t.coordinates[a]};if(!1===e(Dt.feature(l,r),n,a))return!1}}))}function Ht(t,e){$t(t,(function(t,n,r){var i=0;if(t.geometry){var o=t.geometry.type;if("Point"!==o&&"MultiPoint"!==o){var s,u=0,a=0,l=0;return!1!==qt(t,(function(o,h,c,f,p){if(void 0===s||n>u||f>a||p>l)return s=o,u=n,a=f,l=p,void(i=0);var g=Dt.lineString([s,o],t.properties);if(!1===e(g,n,r,p,i))return!1;i++,s=o}))&&void 0}}}))}function Zt(t,e){if(!t)throw new Error("geojson is required");$t(t,(function(t,n,r){if(null!==t.geometry){var i=t.geometry.type,o=t.geometry.coordinates;switch(i){case"LineString":if(!1===e(t,n,r,0,0))return!1;break;case"Polygon":for(var s=0;s<o.length;s++)if(!1===e(Dt.lineString(o[s],t.properties),n,r,s))return!1}}}))}Vt.coordAll=function(t){var e=[];return qt(t,(function(t){e.push(t)})),e},Vt.coordEach=qt,Vt.coordReduce=function(t,e,n,r){var i=n;return qt(t,(function(t,r,o,s,u){i=0===r&&void 0===n?t:e(i,t,r,o,s,u)}),r),i},Vt.featureEach=Jt,Vt.featureReduce=function(t,e,n){var r=n;return Jt(t,(function(t,i){r=0===i&&void 0===n?t:e(r,t,i)})),r},Vt.findPoint=function(t,e){if(e=e||{},!Dt.isObject(e))throw new Error("options is invalid");var n,r=e.featureIndex||0,i=e.multiFeatureIndex||0,o=e.geometryIndex||0,s=e.coordIndex||0,u=e.properties;switch(t.type){case"FeatureCollection":r<0&&(r=t.features.length+r),u=u||t.features[r].properties,n=t.features[r].geometry;break;case"Feature":u=u||t.properties,n=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":n=t;break;default:throw new Error("geojson is invalid")}if(null===n)return null;var a=n.coordinates;switch(n.type){case"Point":return Dt.point(a,u,e);case"MultiPoint":return i<0&&(i=a.length+i),Dt.point(a[i],u,e);case"LineString":return s<0&&(s=a.length+s),Dt.point(a[s],u,e);case"Polygon":return o<0&&(o=a.length+o),s<0&&(s=a[o].length+s),Dt.point(a[o][s],u,e);case"MultiLineString":return i<0&&(i=a.length+i),s<0&&(s=a[i].length+s),Dt.point(a[i][s],u,e);case"MultiPolygon":return i<0&&(i=a.length+i),o<0&&(o=a[i].length+o),s<0&&(s=a[i][o].length-s),Dt.point(a[i][o][s],u,e)}throw new Error("geojson is invalid")},Vt.findSegment=function(t,e){if(e=e||{},!Dt.isObject(e))throw new Error("options is invalid");var n,r=e.featureIndex||0,i=e.multiFeatureIndex||0,o=e.geometryIndex||0,s=e.segmentIndex||0,u=e.properties;switch(t.type){case"FeatureCollection":r<0&&(r=t.features.length+r),u=u||t.features[r].properties,n=t.features[r].geometry;break;case"Feature":u=u||t.properties,n=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":n=t;break;default:throw new Error("geojson is invalid")}if(null===n)return null;var a=n.coordinates;switch(n.type){case"Point":case"MultiPoint":return null;case"LineString":return s<0&&(s=a.length+s-1),Dt.lineString([a[s],a[s+1]],u,e);case"Polygon":return o<0&&(o=a.length+o),s<0&&(s=a[o].length+s-1),Dt.lineString([a[o][s],a[o][s+1]],u,e);case"MultiLineString":return i<0&&(i=a.length+i),s<0&&(s=a[i].length+s-1),Dt.lineString([a[i][s],a[i][s+1]],u,e);case"MultiPolygon":return i<0&&(i=a.length+i),o<0&&(o=a[i].length+o),s<0&&(s=a[i][o].length-s-1),Dt.lineString([a[i][o][s],a[i][o][s+1]],u,e)}throw new Error("geojson is invalid")},Vt.flattenEach=$t,Vt.flattenReduce=function(t,e,n){var r=n;return $t(t,(function(t,i,o){r=0===i&&0===o&&void 0===n?t:e(r,t,i,o)})),r},Vt.geomEach=Wt,Vt.geomReduce=function(t,e,n){var r=n;return Wt(t,(function(t,i,o,s,u){r=0===i&&void 0===n?t:e(r,t,i,o,s,u)})),r},Vt.lineEach=Zt,Vt.lineReduce=function(t,e,n){var r=n;return Zt(t,(function(t,i,o,s){r=0===i&&void 0===n?t:e(r,t,i,o,s)})),r},Vt.propEach=zt,Vt.propReduce=function(t,e,n){var r=n;return zt(t,(function(t,i){r=0===i&&void 0===n?t:e(r,t,i)})),r},Vt.segmentEach=Ht,Vt.segmentReduce=function(t,e,n){var r=n,i=!1;return Ht(t,(function(t,o,s,u,a){r=!1===i&&void 0===n?t:e(r,t,o,s,u,a),i=!0})),r};var Kt={};Object.defineProperty(Kt,"__esModule",{value:!0});var Qt=Vt;function te(t){var e=[1/0,1/0,-1/0,-1/0];return Qt.coordEach(t,(function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])})),e}te.default=te,Kt.default=te;var ee=Ut,ne=Tt,re=Vt,ie=Kt.default,oe=re.featureEach;re.coordEach;var se=ne.featureCollection;function ue(t){var e=new ee(t);return e.insert=function(t){if("Feature"!==t.type)throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:ie(t),ee.prototype.insert.call(this,t)},e.load=function(t){var e=[];return Array.isArray(t)?t.forEach((function(t){if("Feature"!==t.type)throw new Error("invalid features");t.bbox=t.bbox?t.bbox:ie(t),e.push(t)})):oe(t,(function(t){if("Feature"!==t.type)throw new Error("invalid features");t.bbox=t.bbox?t.bbox:ie(t),e.push(t)})),ee.prototype.load.call(this,e)},e.remove=function(t,e){if("Feature"!==t.type)throw new Error("invalid feature");return t.bbox=t.bbox?t.bbox:ie(t),ee.prototype.remove.call(this,t,e)},e.clear=function(){return ee.prototype.clear.call(this)},e.search=function(t){var e=ee.prototype.search.call(this,this.toBBox(t));return se(e)},e.collides=function(t){return ee.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=ee.prototype.all.call(this);return se(t)},e.toJSON=function(){return ee.prototype.toJSON.call(this)},e.fromJSON=function(t){return ee.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var e;if(t.bbox)e=t.bbox;else if(Array.isArray(t)&&4===t.length)e=t;else if(Array.isArray(t)&&6===t.length)e=[t[0],t[1],t[3],t[4]];else if("Feature"===t.type)e=ie(t);else{if("FeatureCollection"!==t.type)throw new Error("invalid geojson");e=ie(t)}return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}},e}function ae(t,e){var n={},r=[];if("LineString"===t.type&&(t=a(t)),"LineString"===e.type&&(e=a(e)),"Feature"===t.type&&"Feature"===e.type&&null!==t.geometry&&null!==e.geometry&&"LineString"===t.geometry.type&&"LineString"===e.geometry.type&&2===t.geometry.coordinates.length&&2===e.geometry.coordinates.length){var i=le(t,e);return i&&r.push(i),c(r)}var o=Et.exports();return o.load(bt(e)),w(bt(t),(function(t){w(o.search(t),(function(e){var i=le(t,e);if(i){var o=v(i).join(",");n[o]||(n[o]=!0,r.push(i))}}))})),c(r)}function le(t,e){var n=v(t),r=v(e);if(2!==n.length)throw new Error("<intersects> line1 must only contain 2 coordinates");if(2!==r.length)throw new Error("<intersects> line2 must only contain 2 coordinates");var i=n[0][0],o=n[0][1],s=n[1][0],u=n[1][1],l=r[0][0],h=r[0][1],c=r[1][0],f=r[1][1],p=(f-h)*(s-i)-(c-l)*(u-o),g=(c-l)*(o-h)-(f-h)*(i-l),y=(s-i)*(o-h)-(u-o)*(i-l);if(0===p)return null;var m=g/p,x=y/p;return m>=0&&m<=1&&x>=0&&x<=1?function(t,e,n){if(void 0===n&&(n={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!d(t[0])||!d(t[1]))throw new Error("coordinates must contain numbers");return a({type:"Point",coordinates:t},e,n)}([i+m*(s-i),o+m*(u-o)]):null}function he(t,e,n){if(void 0===n&&(n={}),!t)throw new Error("point is required");if(!e)throw new Error("polygon is required");var r=function(t){if(!t)throw new Error("coord is required");if(!Array.isArray(t)){if("Feature"===t.type&&null!==t.geometry&&"Point"===t.geometry.type)return t.geometry.coordinates;if("Point"===t.type)return t.coordinates}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return t;throw new Error("coord must be GeoJSON Point or an Array of numbers")}(t),i=m(e),o=i.type,s=e.bbox,u=i.coordinates;if(s&&!1===function(t,e){return e[0]<=t[0]&&e[1]<=t[1]&&e[2]>=t[0]&&e[3]>=t[1]}(r,s))return!1;"Polygon"===o&&(u=[u]);for(var a=!1,l=0;l<u.length&&!a;l++)if(ce(r,u[l][0],n.ignoreBoundary)){for(var h=!1,c=1;c<u[l].length&&!h;)ce(r,u[l][c],!n.ignoreBoundary)&&(h=!0),c++;h||(a=!0)}return a}function ce(t,e,n){var r=!1;e[0][0]===e[e.length-1][0]&&e[0][1]===e[e.length-1][1]&&(e=e.slice(0,e.length-1));for(var i=0,o=e.length-1;i<e.length;o=i++){var s=e[i][0],u=e[i][1],a=e[o][0],l=e[o][1];if(t[1]*(s-a)+u*(a-t[0])+l*(t[0]-s)==0&&(s-t[0])*(a-t[0])<=0&&(u-t[1])*(l-t[1])<=0)return!n;u>t[1]!=l>t[1]&&t[0]<(a-s)*(t[1]-u)/(l-u)+s&&(r=!r)}return r}function fe(t,e){void 0===e&&(e={});var n=m(t);switch(e.properties||"Feature"!==t.type||(e.properties=t.properties),n.type){case"Polygon":return function(t,e){void 0===e&&(e={});var n=m(t).coordinates,r=e.properties?e.properties:"Feature"===t.type?t.properties:{};return pe(n,r)}(n,e);case"MultiPolygon":return function(t,e){void 0===e&&(e={});var n=m(t).coordinates,r=e.properties?e.properties:"Feature"===t.type?t.properties:{},i=[];return n.forEach((function(t){i.push(pe(t,r))})),c(i)}(n,e);default:throw new Error("invalid poly")}}function pe(t,e){return t.length>1?f(t,e):h(t[0],e)}function ge(t,e){var n=!0;return S(t,(function(t){S(e,(function(e){if(!1===n)return!1;n=function(t,e){switch(t.type){case"Point":switch(e.type){case"Point":return n=t.coordinates,r=e.coordinates,!(n[0]===r[0]&&n[1]===r[1]);case"LineString":return!de(e,t);case"Polygon":return!he(t,e)}break;case"LineString":switch(e.type){case"Point":return!de(t,e);case"LineString":return!function(t,e){if(ae(t,e).features.length>0)return!0;return!1}(t,e);case"Polygon":return!ye(e,t)}break;case"Polygon":switch(e.type){case"Point":return!he(e,t);case"LineString":return!ye(t,e);case"Polygon":return!function(t,e){for(var n=0,r=t.coordinates[0];n<r.length;n++){if(he(r[n],e))return!0}for(var i=0,o=e.coordinates[0];i<o.length;i++){if(he(o[i],t))return!0}if(ae(fe(t),fe(e)).features.length>0)return!0;return!1}(e,t)}}var n,r;return!1}(t.geometry,e.geometry)}))})),n}function de(t,e){for(var n=0;n<t.coordinates.length-1;n++)if(ve(t.coordinates[n],t.coordinates[n+1],e.coordinates))return!0;return!1}function ye(t,e){for(var n=0,r=e.coordinates;n<r.length;n++){if(he(r[n],t))return!0}return ae(e,fe(t)).features.length>0}function ve(t,e,n){var r=n[0]-t[0],i=n[1]-t[1],o=e[0]-t[0],s=e[1]-t[1];return 0==r*s-i*o&&(Math.abs(o)>=Math.abs(s)?o>0?t[0]<=n[0]&&n[0]<=e[0]:e[0]<=n[0]&&n[0]<=t[0]:s>0?t[1]<=n[1]&&n[1]<=e[1]:e[1]<=n[1]&&n[1]<=t[1])}function me(t){var e=t[0],n=t[1];return[n[0]-e[0],n[1]-e[1]]}function xe(t,e){return t[0]*e[1]-e[0]*t[1]}function be(t,e){return!function(t,e){return 0===xe(me(t),me(e))}(t,e)&&function(t,e){var n,r,i=t[0],o=me(t),s=e[0],u=me(e),a=xe(o,u),l=function(t,e){return[t[0]+e[0],t[1]+e[1]]}(i,function(t,e){return[t*e[0],t*e[1]]}(xe((r=i,[(n=s)[0]-r[0],n[1]-r[1]]),u)/a,o));return l}(t,e)}function we(t,e,n){if(!y(n=n||{}))throw new Error("options is invalid");var r=n.units;if(!t)throw new Error("geojson is required");if(null==e||isNaN(e))throw new Error("distance is required");var i=function(t,e){return"FeatureCollection"===t.type?"FeatureCollection":"GeometryCollection"===t.type?"GeometryCollection":"Feature"===t.type&&null!==t.geometry?t.geometry.type:t.type}(t),o=t.properties;switch(i){case"LineString":return Ee(t,e,r);case"MultiLineString":var s=[];return S(t,(function(t){s.push(Ee(t,e,r).geometry.coordinates)})),f(s,o);default:throw new Error("geometry "+i+" is not supported")}}function Ee(t,e,n){var r=[],i=g(e,n),o=v(t),s=[];return o.forEach((function(t,e){if(e!==o.length-1){var n=(l=t,h=o[e+1],c=i,f=Math.sqrt((l[0]-h[0])*(l[0]-h[0])+(l[1]-h[1])*(l[1]-h[1])),p=l[0]+c*(h[1]-l[1])/f,g=h[0]+c*(h[1]-l[1])/f,d=l[1]+c*(l[0]-h[0])/f,y=h[1]+c*(l[0]-h[0])/f,[[p,d],[g,y]]);if(r.push(n),e>0){var u=r[e-1],a=be(n,u);!1!==a&&(u[1]=a,n[0]=a),s.push(u[0]),e===o.length-2&&(s.push(n[0]),s.push(n[1]))}2===o.length&&(s.push(n[0]),s.push(n[1]))}var l,h,c,f,p,g,d,y})),h(s,t.properties)}function Se(t){var e=[1/0,1/0,-1/0,-1/0];return b(t,(function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])})),e}function Pe(t,n){var r,i,o;void 0===n&&(n={});var s=n.properties,u=null===(r=n.autoComplete)||void 0===r||r,a=null===(i=n.orderCoords)||void 0===i||i;if(null!==(o=n.mutate)&&void 0!==o&&o||(t=e(t)),"FeatureCollection"===t.type){var l=[];return t.features.forEach((function(t){l.push(v(_e(t,{},u,a)))})),p(l,s)}return _e(t,s,u,a)}function _e(t,e,n,r){e=e||("Feature"===t.type?t.properties:{});var i=m(t),o=i.coordinates,s=i.type;if(!o.length)throw new Error("line must contain coordinates");switch(s){case"LineString":return n&&(o=ke(o)),l([o],e);case"MultiLineString":var u=[],a=0;return o.forEach((function(t){if(n&&(t=ke(t)),r){var e=function(t){var e=t[0],n=t[1],r=t[2],i=t[3];return Math.abs(e-r)*Math.abs(n-i)}
/**
     * splaytree v3.1.1
     * Fast Splay tree for Node and browser
     *
     * @author Alexander Milevski <info@w8r.name>
     * @license MIT
     * @preserve
     */
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */(Se(h(t)));e>a?(u.unshift(t),a=e):u.push(t)}else u.push(t)})),l(u,e);default:throw new Error("geometry type "+s+" is not supported")}}function ke(t){var e=t[0],n=e[0],r=e[1],i=t[t.length-1],o=i[0],s=i[1];return n===o&&r===s||t.push(e),t}function Me(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}}Et.exports=ue,Et.exports.default=ue,Se.default=Se;var Ie=function(t,e){this.next=null,this.key=t,this.data=e,this.left=null,this.right=null};function Ce(t,e){return t>e?1:t<e?-1:0}function Fe(t,e,n){for(var r=new Ie(null,null),i=r,o=r;;){var s=n(t,e.key);if(s<0){if(null===e.left)break;if(n(t,e.left.key)<0){var u=e.left;if(e.left=u.right,u.right=e,null===(e=u).left)break}o.left=e,o=e,e=e.left}else{if(!(s>0))break;if(null===e.right)break;if(n(t,e.right.key)>0){u=e.right;if(e.right=u.left,u.left=e,null===(e=u).right)break}i.right=e,i=e,e=e.right}}return i.right=e.left,o.left=e.right,e.left=r.right,e.right=r.left,e}function Re(t,e,n,r){var i=new Ie(t,e);if(null===n)return i.left=i.right=null,i;var o=r(t,(n=Fe(t,n,r)).key);return o<0?(i.left=n.left,i.right=n,n.left=null):o>=0&&(i.right=n.right,i.left=n,n.right=null),i}function Le(t,e,n){var r=null,i=null;if(e){var o=n((e=Fe(t,e,n)).key,t);0===o?(r=e.left,i=e.right):o<0?(i=e.right,e.right=null,r=e):(r=e.left,e.left=null,i=e)}return{left:r,right:i}}function Ae(t,e,n,r,i){if(t){r(e+(n?"└── ":"├── ")+i(t)+"\n");var o=e+(n?"    ":"│   ");t.left&&Ae(t.left,o,!1,r,i),t.right&&Ae(t.right,o,!0,r,i)}}var Oe=function(){function t(t){void 0===t&&(t=Ce),this._root=null,this._size=0,this._comparator=t}return t.prototype.insert=function(t,e){return this._size++,this._root=Re(t,e,this._root,this._comparator)},t.prototype.add=function(t,e){var n=new Ie(t,e);null===this._root&&(n.left=n.right=null,this._size++,this._root=n);var r=this._comparator,i=Fe(t,this._root,r),o=r(t,i.key);return 0===o?this._root=i:(o<0?(n.left=i.left,n.right=i,i.left=null):o>0&&(n.right=i.right,n.left=i,i.right=null),this._size++,this._root=n),this._root},t.prototype.remove=function(t){this._root=this._remove(t,this._root,this._comparator)},t.prototype._remove=function(t,e,n){var r;return null===e?null:0===n(t,(e=Fe(t,e,n)).key)?(null===e.left?r=e.right:(r=Fe(t,e.left,n)).right=e.right,this._size--,r):e},t.prototype.pop=function(){var t=this._root;if(t){for(;t.left;)t=t.left;return this._root=Fe(t.key,this._root,this._comparator),this._root=this._remove(t.key,this._root,this._comparator),{key:t.key,data:t.data}}return null},t.prototype.findStatic=function(t){for(var e=this._root,n=this._comparator;e;){var r=n(t,e.key);if(0===r)return e;e=r<0?e.left:e.right}return null},t.prototype.find=function(t){return this._root&&(this._root=Fe(t,this._root,this._comparator),0!==this._comparator(t,this._root.key))?null:this._root},t.prototype.contains=function(t){for(var e=this._root,n=this._comparator;e;){var r=n(t,e.key);if(0===r)return!0;e=r<0?e.left:e.right}return!1},t.prototype.forEach=function(t,e){for(var n=this._root,r=[],i=!1;!i;)null!==n?(r.push(n),n=n.left):0!==r.length?(n=r.pop(),t.call(e,n),n=n.right):i=!0;return this},t.prototype.range=function(t,e,n,r){for(var i=[],o=this._comparator,s=this._root;0!==i.length||s;)if(s)i.push(s),s=s.left;else{if(o((s=i.pop()).key,e)>0)break;if(o(s.key,t)>=0&&n.call(r,s))return this;s=s.right}return this},t.prototype.keys=function(){var t=[];return this.forEach((function(e){var n=e.key;return t.push(n)})),t},t.prototype.values=function(){var t=[];return this.forEach((function(e){var n=e.data;return t.push(n)})),t},t.prototype.min=function(){return this._root?this.minNode(this._root).key:null},t.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},t.prototype.minNode=function(t){if(void 0===t&&(t=this._root),t)for(;t.left;)t=t.left;return t},t.prototype.maxNode=function(t){if(void 0===t&&(t=this._root),t)for(;t.right;)t=t.right;return t},t.prototype.at=function(t){for(var e=this._root,n=!1,r=0,i=[];!n;)if(e)i.push(e),e=e.left;else if(i.length>0){if(e=i.pop(),r===t)return e;r++,e=e.right}else n=!0;return null},t.prototype.next=function(t){var e=this._root,n=null;if(t.right){for(n=t.right;n.left;)n=n.left;return n}for(var r=this._comparator;e;){var i=r(t.key,e.key);if(0===i)break;i<0?(n=e,e=e.left):e=e.right}return n},t.prototype.prev=function(t){var e=this._root,n=null;if(null!==t.left){for(n=t.left;n.right;)n=n.right;return n}for(var r=this._comparator;e;){var i=r(t.key,e.key);if(0===i)break;i<0?e=e.left:(n=e,e=e.right)}return n},t.prototype.clear=function(){return this._root=null,this._size=0,this},t.prototype.toList=function(){return function(t){var e=t,n=[],r=!1,i=new Ie(null,null),o=i;for(;!r;)e?(n.push(e),e=e.left):n.length>0?e=(e=o=o.next=n.pop()).right:r=!0;return o.next=null,i.next}(this._root)},t.prototype.load=function(t,e,n){void 0===e&&(e=[]),void 0===n&&(n=!1);var r=t.length,i=this._comparator;if(n&&Ne(t,e,0,r-1,i),null===this._root)this._root=Be(t,e,0,r),this._size=r;else{var o=function(t,e,n){var r=new Ie(null,null),i=r,o=t,s=e;for(;null!==o&&null!==s;)n(o.key,s.key)<0?(i.next=o,o=o.next):(i.next=s,s=s.next),i=i.next;null!==o?i.next=o:null!==s&&(i.next=s);return r.next}(this.toList(),function(t,e){for(var n=new Ie(null,null),r=n,i=0;i<t.length;i++)r=r.next=new Ie(t[i],e[i]);return r.next=null,n.next}(t,e),i);r=this._size+r,this._root=Ye({head:o},0,r)}return this},t.prototype.isEmpty=function(){return null===this._root},Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),t.prototype.toString=function(t){void 0===t&&(t=function(t){return String(t.key)});var e=[];return Ae(this._root,"",!0,(function(t){return e.push(t)}),t),e.join("")},t.prototype.update=function(t,e,n){var r=this._comparator,i=Le(t,this._root,r),o=i.left,s=i.right;r(t,e)<0?s=Re(e,n,s,r):o=Re(e,n,o,r),this._root=function(t,e,n){return null===e?t:(null===t||((e=Fe(t.key,e,n)).left=t),e)}(o,s,r)},t.prototype.split=function(t){return Le(t,this._root,this._comparator)},t.prototype[Symbol.iterator]=function(){var t;return Me(this,(function(e){switch(e.label){case 0:t=this.minNode(),e.label=1;case 1:return t?[4,t]:[3,3];case 2:return e.sent(),t=this.next(t),[3,1];case 3:return[2]}}))},t}();function Be(t,e,n,r){var i=r-n;if(i>0){var o=n+Math.floor(i/2),s=t[o],u=e[o],a=new Ie(s,u);return a.left=Be(t,e,n,o),a.right=Be(t,e,o+1,r),a}return null}function Ye(t,e,n){var r=n-e;if(r>0){var i=e+Math.floor(r/2),o=Ye(t,e,i),s=t.head;return s.left=o,t.head=t.head.next,s.right=Ye(t,i+1,n),s}return null}function Ne(t,e,n,r,i){if(!(n>=r)){for(var o=t[n+r>>1],s=n-1,u=r+1;;){do{s++}while(i(t[s],o)<0);do{u--}while(i(t[u],o)>0);if(s>=u)break;var a=t[s];t[s]=t[u],t[u]=a,a=e[s],e[s]=e[u],e[u]=a}Ne(t,e,n,u,i),Ne(t,e,u+1,r,i)}}function Xe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function je(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function Ge(t,e,n){return e&&je(t.prototype,e),n&&je(t,n),t}var Ue=function(t,e){return t.ll.x<=e.x&&e.x<=t.ur.x&&t.ll.y<=e.y&&e.y<=t.ur.y},Te=function(t,e){if(e.ur.x<t.ll.x||t.ur.x<e.ll.x||e.ur.y<t.ll.y||t.ur.y<e.ll.y)return null;var n=t.ll.x<e.ll.x?e.ll.x:t.ll.x,r=t.ur.x<e.ur.x?t.ur.x:e.ur.x;return{ll:{x:n,y:t.ll.y<e.ll.y?e.ll.y:t.ll.y},ur:{x:r,y:t.ur.y<e.ur.y?t.ur.y:e.ur.y}}},Ve=Number.EPSILON;void 0===Ve&&(Ve=Math.pow(2,-52));var De=Ve*Ve,qe=function(t,e){if(-Ve<t&&t<Ve&&-Ve<e&&e<Ve)return 0;var n=t-e;return n*n<De*t*e?0:t<e?-1:1},ze=function(){function t(){Xe(this,t),this.reset()}return Ge(t,[{key:"reset",value:function(){this.xRounder=new Je,this.yRounder=new Je}},{key:"round",value:function(t,e){return{x:this.xRounder.round(t),y:this.yRounder.round(e)}}}]),t}(),Je=function(){function t(){Xe(this,t),this.tree=new Oe,this.round(0)}return Ge(t,[{key:"round",value:function(t){var e=this.tree.add(t),n=this.tree.prev(e);if(null!==n&&0===qe(e.key,n.key))return this.tree.remove(t),n.key;var r=this.tree.next(e);return null!==r&&0===qe(e.key,r.key)?(this.tree.remove(t),r.key):t}}]),t}(),We=new ze,$e=function(t,e){return t.x*e.y-t.y*e.x},He=function(t,e){return t.x*e.x+t.y*e.y},Ze=function(t,e,n){var r={x:e.x-t.x,y:e.y-t.y},i={x:n.x-t.x,y:n.y-t.y},o=$e(r,i);return qe(o,0)},Ke=function(t){return Math.sqrt(He(t,t))},Qe=function(t,e,n){var r={x:e.x-t.x,y:e.y-t.y},i={x:n.x-t.x,y:n.y-t.y};return He(i,r)/Ke(i)/Ke(r)},tn=function(t,e,n){return 0===e.y?null:{x:t.x+e.x/e.y*(n-t.y),y:n}},en=function(t,e,n){return 0===e.x?null:{x:n,y:t.y+e.y/e.x*(n-t.x)}},nn=function(){function t(e,n){Xe(this,t),void 0===e.events?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=n}return Ge(t,null,[{key:"compare",value:function(e,n){var r=t.comparePoints(e.point,n.point);return 0!==r?r:(e.point!==n.point&&e.link(n),e.isLeft!==n.isLeft?e.isLeft?1:-1:on.compare(e.segment,n.segment))}},{key:"comparePoints",value:function(t,e){return t.x<e.x?-1:t.x>e.x?1:t.y<e.y?-1:t.y>e.y?1:0}}]),Ge(t,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var e=t.point.events,n=0,r=e.length;n<r;n++){var i=e[n];this.point.events.push(i),i.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,e=0;e<t;e++){var n=this.point.events[e];if(void 0===n.segment.consumedBy)for(var r=e+1;r<t;r++){var i=this.point.events[r];void 0===i.consumedBy&&(n.otherSE.point.events===i.otherSE.point.events&&n.segment.consume(i.segment))}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],e=0,n=this.point.events.length;e<n;e++){var r=this.point.events[e];r!==this&&!r.segment.ringOut&&r.segment.isInResult()&&t.push(r)}return t}},{key:"getLeftmostComparator",value:function(t){var e=this,n=new Map,r=function(r){var i,o,s,u,a,l=r.otherSE;n.set(r,{sine:(i=e.point,o=t.point,s=l.point,u={x:o.x-i.x,y:o.y-i.y},a={x:s.x-i.x,y:s.y-i.y},$e(a,u)/Ke(a)/Ke(u)),cosine:Qe(e.point,t.point,l.point)})};return function(t,e){n.has(t)||r(t),n.has(e)||r(e);var i=n.get(t),o=i.sine,s=i.cosine,u=n.get(e),a=u.sine,l=u.cosine;return o>=0&&a>=0?s<l?1:s>l?-1:0:o<0&&a<0?s<l?-1:s>l?1:0:a<o?-1:a>o?1:0}}}]),t}(),rn=0,on=function(){function t(e,n,r,i){Xe(this,t),this.id=++rn,this.leftSE=e,e.segment=this,e.otherSE=n,this.rightSE=n,n.segment=this,n.otherSE=e,this.rings=r,this.windings=i}return Ge(t,null,[{key:"compare",value:function(t,e){var n=t.leftSE.point.x,r=e.leftSE.point.x,i=t.rightSE.point.x,o=e.rightSE.point.x;if(o<n)return 1;if(i<r)return-1;var s=t.leftSE.point.y,u=e.leftSE.point.y,a=t.rightSE.point.y,l=e.rightSE.point.y;if(n<r){if(u<s&&u<a)return 1;if(u>s&&u>a)return-1;var h=t.comparePoint(e.leftSE.point);if(h<0)return 1;if(h>0)return-1;var c=e.comparePoint(t.rightSE.point);return 0!==c?c:-1}if(n>r){if(s<u&&s<l)return-1;if(s>u&&s>l)return 1;var f=e.comparePoint(t.leftSE.point);if(0!==f)return f;var p=t.comparePoint(e.rightSE.point);return p<0?1:p>0?-1:1}if(s<u)return-1;if(s>u)return 1;if(i<o){var g=e.comparePoint(t.rightSE.point);if(0!==g)return g}if(i>o){var d=t.comparePoint(e.rightSE.point);if(d<0)return 1;if(d>0)return-1}if(i!==o){var y=a-s,v=i-n,m=l-u,x=o-r;if(y>v&&m<x)return 1;if(y<v&&m>x)return-1}return i>o?1:i<o||a<l?-1:a>l?1:t.id<e.id?-1:t.id>e.id?1:0}}]),Ge(t,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,e=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<e?t:e},ur:{x:this.rightSE.point.x,y:t>e?t:e}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var e=this.leftSE.point,n=this.rightSE.point,r=this.vector();if(e.x===n.x)return t.x===e.x?0:t.x<e.x?1:-1;var i=(t.y-e.y)/r.y,o=e.x+i*r.x;if(t.x===o)return 0;var s=(t.x-e.x)/r.x,u=e.y+s*r.y;return t.y===u?0:t.y<u?-1:1}},{key:"getIntersection",value:function(t){var e=this.bbox(),n=t.bbox(),r=Te(e,n);if(null===r)return null;var i=this.leftSE.point,o=this.rightSE.point,s=t.leftSE.point,u=t.rightSE.point,a=Ue(e,s)&&0===this.comparePoint(s),l=Ue(n,i)&&0===t.comparePoint(i),h=Ue(e,u)&&0===this.comparePoint(u),c=Ue(n,o)&&0===t.comparePoint(o);if(l&&a)return c&&!h?o:!c&&h?u:null;if(l)return h&&i.x===u.x&&i.y===u.y?null:i;if(a)return c&&o.x===s.x&&o.y===s.y?null:s;if(c&&h)return null;if(c)return o;if(h)return u;var f=function(t,e,n,r){if(0===e.x)return en(n,r,t.x);if(0===r.x)return en(t,e,n.x);if(0===e.y)return tn(n,r,t.y);if(0===r.y)return tn(t,e,n.y);var i=$e(e,r);if(0==i)return null;var o={x:n.x-t.x,y:n.y-t.y},s=$e(o,e)/i,u=$e(o,r)/i;return{x:(t.x+u*e.x+(n.x+s*r.x))/2,y:(t.y+u*e.y+(n.y+s*r.y))/2}}(i,this.vector(),s,t.vector());return null===f?null:Ue(r,f)?We.round(f.x,f.y):null}},{key:"split",value:function(e){var n=[],r=void 0!==e.events,i=new nn(e,!0),o=new nn(e,!1),s=this.rightSE;this.replaceRightSE(o),n.push(o),n.push(i);var u=new t(i,s,this.rings.slice(),this.windings.slice());return nn.comparePoints(u.leftSE.point,u.rightSE.point)>0&&u.swapEvents(),nn.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),r&&(i.checkForConsuming(),o.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var e=0,n=this.windings.length;e<n;e++)this.windings[e]*=-1}},{key:"consume",value:function(e){for(var n=this,r=e;n.consumedBy;)n=n.consumedBy;for(;r.consumedBy;)r=r.consumedBy;var i=t.compare(n,r);if(0!==i){if(i>0){var o=n;n=r,r=o}if(n.prev===r){var s=n;n=r,r=s}for(var u=0,a=r.rings.length;u<a;u++){var l=r.rings[u],h=r.windings[u],c=n.rings.indexOf(l);-1===c?(n.rings.push(l),n.windings.push(h)):n.windings[c]+=h}r.rings=null,r.windings=null,r.consumedBy=n,r.leftSE.consumedBy=n.leftSE,r.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return void 0!==this._prevInResult||(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null),this._prevInResult}},{key:"beforeState",value:function(){if(void 0!==this._beforeState)return this._beforeState;if(this.prev){var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}else this._beforeState={rings:[],windings:[],multiPolys:[]};return this._beforeState}},{key:"afterState",value:function(){if(void 0!==this._afterState)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var e=this._afterState.rings,n=this._afterState.windings,r=this._afterState.multiPolys,i=0,o=this.rings.length;i<o;i++){var s=this.rings[i],u=this.windings[i],a=e.indexOf(s);-1===a?(e.push(s),n.push(u)):n[a]+=u}for(var l=[],h=[],c=0,f=e.length;c<f;c++)if(0!==n[c]){var p=e[c],g=p.poly;if(-1===h.indexOf(g))if(p.isExterior)l.push(g);else{-1===h.indexOf(g)&&h.push(g);var d=l.indexOf(p.poly);-1!==d&&l.splice(d,1)}}for(var y=0,v=l.length;y<v;y++){var m=l[y].multiPoly;-1===r.indexOf(m)&&r.push(m)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(void 0!==this._isInResult)return this._isInResult;var t=this.beforeState().multiPolys,e=this.afterState().multiPolys;switch(dn.type){case"union":var n=0===t.length,r=0===e.length;this._isInResult=n!==r;break;case"intersection":var i,o;t.length<e.length?(i=t.length,o=e.length):(i=e.length,o=t.length),this._isInResult=o===dn.numMultiPolys&&i<o;break;case"xor":var s=Math.abs(t.length-e.length);this._isInResult=s%2==1;break;case"difference":var u=function(t){return 1===t.length&&t[0].isSubject};this._isInResult=u(t)!==u(e);break;default:throw new Error("Unrecognized operation type found ".concat(dn.type))}return this._isInResult}}],[{key:"fromRing",value:function(e,n,r){var i,o,s,u=nn.comparePoints(e,n);if(u<0)i=e,o=n,s=1;else{if(!(u>0))throw new Error("Tried to create degenerate segment at [".concat(e.x,", ").concat(e.y,"]"));i=n,o=e,s=-1}return new t(new nn(i,!0),new nn(o,!1),[r],[s])}}]),t}(),sn=function(){function t(e,n,r){if(Xe(this,t),!Array.isArray(e)||0===e.length)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=n,this.isExterior=r,this.segments=[],"number"!=typeof e[0][0]||"number"!=typeof e[0][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var i=We.round(e[0][0],e[0][1]);this.bbox={ll:{x:i.x,y:i.y},ur:{x:i.x,y:i.y}};for(var o=i,s=1,u=e.length;s<u;s++){if("number"!=typeof e[s][0]||"number"!=typeof e[s][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var a=We.round(e[s][0],e[s][1]);a.x===o.x&&a.y===o.y||(this.segments.push(on.fromRing(o,a,this)),a.x<this.bbox.ll.x&&(this.bbox.ll.x=a.x),a.y<this.bbox.ll.y&&(this.bbox.ll.y=a.y),a.x>this.bbox.ur.x&&(this.bbox.ur.x=a.x),a.y>this.bbox.ur.y&&(this.bbox.ur.y=a.y),o=a)}i.x===o.x&&i.y===o.y||this.segments.push(on.fromRing(o,i,this))}return Ge(t,[{key:"getSweepEvents",value:function(){for(var t=[],e=0,n=this.segments.length;e<n;e++){var r=this.segments[e];t.push(r.leftSE),t.push(r.rightSE)}return t}}]),t}(),un=function(){function t(e,n){if(Xe(this,t),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new sn(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var r=1,i=e.length;r<i;r++){var o=new sn(e[r],this,!1);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.interiorRings.push(o)}this.multiPoly=n}return Ge(t,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),e=0,n=this.interiorRings.length;e<n;e++)for(var r=this.interiorRings[e].getSweepEvents(),i=0,o=r.length;i<o;i++)t.push(r[i]);return t}}]),t}(),an=function(){function t(e,n){if(Xe(this,t),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{"number"==typeof e[0][0][0]&&(e=[e])}catch(t){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var r=0,i=e.length;r<i;r++){var o=new un(e[r],this);o.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=o.bbox.ll.x),o.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=o.bbox.ll.y),o.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=o.bbox.ur.x),o.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=o.bbox.ur.y),this.polys.push(o)}this.isSubject=n}return Ge(t,[{key:"getSweepEvents",value:function(){for(var t=[],e=0,n=this.polys.length;e<n;e++)for(var r=this.polys[e].getSweepEvents(),i=0,o=r.length;i<o;i++)t.push(r[i]);return t}}]),t}(),ln=function(){function t(e){Xe(this,t),this.events=e;for(var n=0,r=e.length;n<r;n++)e[n].segment.ringOut=this;this.poly=null}return Ge(t,null,[{key:"factory",value:function(e){for(var n=[],r=0,i=e.length;r<i;r++){var o=e[r];if(o.isInResult()&&!o.ringOut){for(var s=null,u=o.leftSE,a=o.rightSE,l=[u],h=u.point,c=[];s=u,u=a,l.push(u),u.point!==h;)for(;;){var f=u.getAvailableLinkedEvents();if(0===f.length){var p=l[0].point,g=l[l.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(p.x,",")+" ".concat(p.y,"]. Last matching segment found ends at")+" [".concat(g.x,", ").concat(g.y,"]."))}if(1===f.length){a=f[0].otherSE;break}for(var d=null,y=0,v=c.length;y<v;y++)if(c[y].point===u.point){d=y;break}if(null===d){c.push({index:l.length,point:u.point});var m=u.getLeftmostComparator(s);a=f.sort(m)[0].otherSE;break}var x=c.splice(d)[0],b=l.splice(x.index);b.unshift(b[0].otherSE),n.push(new t(b.reverse()))}n.push(new t(l))}}return n}}]),Ge(t,[{key:"getGeom",value:function(){for(var t=this.events[0].point,e=[t],n=1,r=this.events.length-1;n<r;n++){var i=this.events[n].point,o=this.events[n+1].point;0!==Ze(i,t,o)&&(e.push(i),t=i)}if(1===e.length)return null;var s=e[0],u=e[1];0===Ze(s,t,u)&&e.shift(),e.push(e[0]);for(var a=this.isExteriorRing()?1:-1,l=this.isExteriorRing()?0:e.length-1,h=this.isExteriorRing()?e.length:-1,c=[],f=l;f!=h;f+=a)c.push([e[f].x,e[f].y]);return c}},{key:"isExteriorRing",value:function(){if(void 0===this._isExteriorRing){var t=this.enclosingRing();this._isExteriorRing=!t||!t.isExteriorRing()}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return void 0===this._enclosingRing&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],e=1,n=this.events.length;e<n;e++){var r=this.events[e];nn.compare(t,r)>0&&(t=r)}for(var i=t.segment.prevInResult(),o=i?i.prevInResult():null;;){if(!i)return null;if(!o)return i.ringOut;if(o.ringOut!==i.ringOut)return o.ringOut.enclosingRing()!==i.ringOut?i.ringOut:i.ringOut.enclosingRing();i=o.prevInResult(),o=i?i.prevInResult():null}}}]),t}(),hn=function(){function t(e){Xe(this,t),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return Ge(t,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(null===t[0])return null;for(var e=0,n=this.interiorRings.length;e<n;e++){var r=this.interiorRings[e].getGeom();null!==r&&t.push(r)}return t}}]),t}(),cn=function(){function t(e){Xe(this,t),this.rings=e,this.polys=this._composePolys(e)}return Ge(t,[{key:"getGeom",value:function(){for(var t=[],e=0,n=this.polys.length;e<n;e++){var r=this.polys[e].getGeom();null!==r&&t.push(r)}return t}},{key:"_composePolys",value:function(t){for(var e=[],n=0,r=t.length;n<r;n++){var i=t[n];if(!i.poly)if(i.isExteriorRing())e.push(new hn(i));else{var o=i.enclosingRing();o.poly||e.push(new hn(o)),o.poly.addInterior(i)}}return e}}]),t}(),fn=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:on.compare;Xe(this,t),this.queue=e,this.tree=new Oe(n),this.segments=[]}return Ge(t,[{key:"process",value:function(t){var e=t.segment,n=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(e),n;var r=t.isLeft?this.tree.insert(e):this.tree.find(e);if(!r)throw new Error("Unable to find segment #".concat(e.id," ")+"[".concat(e.leftSE.point.x,", ").concat(e.leftSE.point.y,"] -> ")+"[".concat(e.rightSE.point.x,", ").concat(e.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var i=r,o=r,s=void 0,u=void 0;void 0===s;)null===(i=this.tree.prev(i))?s=null:void 0===i.key.consumedBy&&(s=i.key);for(;void 0===u;)null===(o=this.tree.next(o))?u=null:void 0===o.key.consumedBy&&(u=o.key);if(t.isLeft){var a=null;if(s){var l=s.getIntersection(e);if(null!==l&&(e.isAnEndpoint(l)||(a=l),!s.isAnEndpoint(l)))for(var h=this._splitSafely(s,l),c=0,f=h.length;c<f;c++)n.push(h[c])}var p=null;if(u){var g=u.getIntersection(e);if(null!==g&&(e.isAnEndpoint(g)||(p=g),!u.isAnEndpoint(g)))for(var d=this._splitSafely(u,g),y=0,v=d.length;y<v;y++)n.push(d[y])}if(null!==a||null!==p){var m=null;if(null===a)m=p;else if(null===p)m=a;else{m=nn.comparePoints(a,p)<=0?a:p}this.queue.remove(e.rightSE),n.push(e.rightSE);for(var x=e.split(m),b=0,w=x.length;b<w;b++)n.push(x[b])}n.length>0?(this.tree.remove(e),n.push(t)):(this.segments.push(e),e.prev=s)}else{if(s&&u){var E=s.getIntersection(u);if(null!==E){if(!s.isAnEndpoint(E))for(var S=this._splitSafely(s,E),P=0,_=S.length;P<_;P++)n.push(S[P]);if(!u.isAnEndpoint(E))for(var k=this._splitSafely(u,E),M=0,I=k.length;M<I;M++)n.push(k[M])}}this.tree.remove(e)}return n}},{key:"_splitSafely",value:function(t,e){this.tree.remove(t);var n=t.rightSE;this.queue.remove(n);var r=t.split(e);return r.push(n),void 0===t.consumedBy&&this.tree.insert(t),r}}]),t}(),pn="undefined"!=typeof process&&process.env.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,gn="undefined"!=typeof process&&process.env.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,dn=new(function(){function t(){Xe(this,t)}return Ge(t,[{key:"run",value:function(t,e,n){dn.type=t,We.reset();for(var r=[new an(e,!0)],i=0,o=n.length;i<o;i++)r.push(new an(n[i],!1));if(dn.numMultiPolys=r.length,"difference"===dn.type)for(var s=r[0],u=1;u<r.length;)null!==Te(r[u].bbox,s.bbox)?u++:r.splice(u,1);if("intersection"===dn.type)for(var a=0,l=r.length;a<l;a++)for(var h=r[a],c=a+1,f=r.length;c<f;c++)if(null===Te(h.bbox,r[c].bbox))return[];for(var p=new Oe(nn.compare),g=0,d=r.length;g<d;g++)for(var y=r[g].getSweepEvents(),v=0,m=y.length;v<m;v++)if(p.insert(y[v]),p.size>pn)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var x=new fn(p),b=p.size,w=p.pop();w;){var E=w.key;if(p.size===b){var S=E.segment;throw new Error("Unable to pop() ".concat(E.isLeft?"left":"right"," SweepEvent ")+"[".concat(E.point.x,", ").concat(E.point.y,"] from segment #").concat(S.id," ")+"[".concat(S.leftSE.point.x,", ").concat(S.leftSE.point.y,"] -> ")+"[".concat(S.rightSE.point.x,", ").concat(S.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(p.size>pn)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(x.segments.length>gn)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var P=x.process(E),_=0,k=P.length;_<k;_++){var M=P[_];void 0===M.consumedBy&&p.insert(M)}b=p.size,w=p.pop()}We.reset();var I=ln.factory(x.segments);return new cn(I).getGeom()}}]),t}()),yn=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return dn.run("difference",t,n)};function vn(t,e){var n=m(t),r=m(e),i=t.properties||{},o=yn(n.coordinates,r.coordinates);return 0===o.length?null:1===o.length?l(o[0],i):p(o,i)}const mn="split_polygon",xn="split_polygon_passing_draw_line_string",bn="split_polygon_highlight",wn={highlightColor:"#222",lineWidth:0,lineWidthUnit:"kilometers",onSelectFeatureRequest(){throw new Error("no Feature is selected to split.")}};var En=Object.freeze({__proto__:null,modeName:mn,passingModeName:xn,highlightPropertyName:bn,defaultOptions:wn});const Sn={};Sn.onSetup=function(t){const{featureIds:e=[],highlightColor:n=wn.highlightColor,lineWidth:r=wn.lineWidth,lineWidthUnit:i=wn.lineWidthUnit,onSelectFeatureRequest:o=wn.onSelectFeatureRequest}=t||{},s=this._ctx.api,u=[],a=this.getSelected();if(0!==e.length)u.push.apply(u,e.map((t=>s.get(t))));else{if(0===a.length)return o();u.push.apply(u,a.filter((t=>t.type===lt||t.type===ft)).map((t=>t.toGeoJSON())))}const l={options:{highlightColor:n,lineWidth:r,lineWidthUnit:i},featuresToSplit:u,api:s};return setTimeout(this.drawAndSplit.bind(this,l),0),this.highlighFeatures(l),l},Sn.drawAndSplit=function(t){const{api:e,options:n}=t,{lineWidth:r,lineWidthUnit:i}=n;try{this.changeMode(xn,{onDraw:n=>{const o=[];t.featuresToSplit.forEach((t=>{if(ge(t,n))return console.info(`Line was outside of Polygon ${t.id}`),void o.push(t);if(0===r){const r=(s=t.geometry,u=n.geometry,J(s,u));r.id=t.id,e.add(r),o.push(r)}else{const s=function(t,e,n){const{line_width:r,line_width_unit:i}=n||{},o=[],s=null;let u,a,l,c,f,p,g;if(void 0===r||void 0===i||t.type!=lt&&t.type!=ft||e.type!=ht)return s;if(ge(e,t))return s;if(l=ae(t,e),0===l.features.length)return s;for(o[0]=we(e,r,{units:i}),o[1]=we(e,-r,{units:i}),u=0;u<=1;u++){c=u;const n=[];for(a=0;a<e.coordinates.length;a++)n.push(e.coordinates[a]);for(a=o[c].geometry.coordinates.length-1;a>=0;a--)n.push(o[c].geometry.coordinates[a]);n.push(e.coordinates[0]),f=h(n),p=Pe(f),g=vn(t,p)}return g}(t.geometry,n.geometry,{line_width:r,line_width_unit:i});s.id=t.id,e.add(s),o.push(s)}var s,u})),this.fireUpdate(o),this.highlighFeatures(t,!1)},onCancel:()=>{this.deleteAll(),this.highlighFeatures(t,!1)}})}catch(t){console.error("🚀 ~ file: mode.js ~ line 116 ~ err",t)}},Sn.highlighFeatures=function(t,e=!0){const n=e?t.options.highlightColor:void 0;t.featuresToSplit.forEach((e=>{t.api.setFeatureProperty(e.id,bn,n)}))},Sn.toDisplayFeatures=function(t,e,n){n(e)},Sn.fireUpdate=function(t){this.map.fire(dt,{action:mn,features:t})};const Pn="user_split_polygon_highlight";function _n(t){const e=t.featureTarget;return!!e&&(!!e.properties&&e.properties.meta===vt)}function kn(t){return 27===t.keyCode}function Mn(t){return 13===t.keyCode}const In={onSetup:function(){const t=this.newFeature({type:at,properties:{},geometry:{type:ct,coordinates:[]}});return this.addFeature(t),this.clearSelectedFeatures(),this.updateUIClasses({mouse:et}),this.activateUIButton(ut),this.setActionableState({trash:!0}),{point:t}},stopDrawingAndRemove:function(t){this.deleteFeature([t.point.id],{silent:!0}),this.changeMode(pt)}};In.onTap=In.onClick=function(t,e){this.updateUIClasses({mouse:nt}),t.point.updateCoordinate("",e.lngLat.lng,e.lngLat.lat),this.map.fire(gt,{features:[t.point.toGeoJSON()]}),this.changeMode(pt,{featureIds:[t.point.id]})},In.onStop=function(t){this.activateUIButton(),t.point.getCoordinate().length||this.deleteFeature([t.point.id],{silent:!0})},In.toDisplayFeatures=function(t,e,n){const r=e.properties.id===t.point.id;if(e.properties.active=r?mt:xt,!r)return n(e)},In.onTrash=In.stopDrawingAndRemove,In.onKeyUp=function(t,e){if(kn(e)||Mn(e))return this.stopDrawingAndRemove(t,e)};const{onSetup:Cn,onClick:Fn,...Rn}=In;function Ln(t,e){return!!t.lngLat&&(t.lngLat.lng===e[0]&&t.lngLat.lat===e[1])}var An={enable(t){setTimeout((()=>{t.map&&t.map.doubleClickZoom&&t._ctx&&t._ctx.store&&t._ctx.store.getInitialConfigValue&&t._ctx.store.getInitialConfigValue("doubleClickZoom")&&t.map.doubleClickZoom.enable()}),0)},disable(t){setTimeout((()=>{t.map&&t.map.doubleClickZoom&&t.map.doubleClickZoom.disable()}),0)}};function On(t,e,n,r){return{type:at,properties:{meta:vt,parent:t,coord_path:n,active:r?mt:xt},geometry:{type:ct,coordinates:e}}}const Bn={onSetup:function(t){const e=(t=t||{}).featureId;let n,r,i="forward";if(e){if(n=this.getFeature(e),!n)throw new Error("Could not find a feature with the provided featureId");let o=t.from;if(o&&"Feature"===o.type&&o.geometry&&"Point"===o.geometry.type&&(o=o.geometry),o&&"Point"===o.type&&o.coordinates&&2===o.coordinates.length&&(o=o.coordinates),!o||!Array.isArray(o))throw new Error("Please use the `from` property to indicate which point to continue the line from");const s=n.coordinates.length-1;if(n.coordinates[s][0]===o[0]&&n.coordinates[s][1]===o[1])r=s+1,n.addCoordinate(r,...n.coordinates[s]);else{if(n.coordinates[0][0]!==o[0]||n.coordinates[0][1]!==o[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");i="backwards",r=0,n.addCoordinate(r,...n.coordinates[0])}}else n=this.newFeature({type:at,properties:{},geometry:{type:ht,coordinates:[]}}),r=0,this.addFeature(n);return this.clearSelectedFeatures(),An.disable(this),this.updateUIClasses({mouse:et}),this.activateUIButton(st),this.setActionableState({trash:!0}),{line:n,currentVertexPosition:r,direction:i}},clickAnywhere:function(t,e){if(t.currentVertexPosition>0&&Ln(e,t.line.coordinates[t.currentVertexPosition-1])||"backwards"===t.direction&&Ln(e,t.line.coordinates[t.currentVertexPosition+1]))return this.changeMode(pt,{featureIds:[t.line.id]});this.updateUIClasses({mouse:et}),t.line.updateCoordinate(t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),"forward"===t.direction?(t.currentVertexPosition++,t.line.updateCoordinate(t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat)):t.line.addCoordinate(0,e.lngLat.lng,e.lngLat.lat)},clickOnVertex:function(t){return this.changeMode(pt,{featureIds:[t.line.id]})},onMouseMove:function(t,e){t.line.updateCoordinate(t.currentVertexPosition,e.lngLat.lng,e.lngLat.lat),_n(e)&&this.updateUIClasses({mouse:rt})}};Bn.onTap=Bn.onClick=function(t,e){if(_n(e))return this.clickOnVertex(t,e);this.clickAnywhere(t,e)},Bn.onKeyUp=function(t,e){Mn(e)?this.changeMode(pt,{featureIds:[t.line.id]}):kn(e)&&(this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(pt))},Bn.onStop=function(t){An.enable(this),this.activateUIButton(),void 0!==this.getFeature(t.line.id)&&(t.line.removeCoordinate(`${t.currentVertexPosition}`),t.line.isValid()?this.map.fire(gt,{features:[t.line.toGeoJSON()]}):(this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(pt,{},{silent:!0})))},Bn.onTrash=function(t){this.deleteFeature([t.line.id],{silent:!0}),this.changeMode(pt)},Bn.toDisplayFeatures=function(t,e,n){const r=e.properties.id===t.line.id;if(e.properties.active=r?mt:xt,!r)return n(e);e.geometry.coordinates.length<2||(e.properties.meta=yt,n(On(t.line.id,e.geometry.coordinates["forward"===t.direction?e.geometry.coordinates.length-2:1],""+("forward"===t.direction?e.geometry.coordinates.length-2:1),!1)),n(e))};const{onSetup:Yn,onMouseMove:Nn,...Xn}=Bn,jn={originOnSetup:Yn,originOnMouseMove:Nn,...Xn};jn.onSetup=function(t){const e=this.originOnSetup(),{onDraw:n,onCancel:r}=t;return e.onDraw=n,e.onCancel=r,e},jn.onMouseMove=function(t,e){this.updateUIClasses({mouse:et}),this.originOnMouseMove(t,e)},jn.onStop=function(t){const e=t.line;this.updateUIClasses({mouse:it}),An.enable(this),this.activateUIButton();void 0!==this.getFeature(e.id)?(e.removeCoordinate(`${t.currentVertexPosition}`),e.isValid()&&("function"==typeof t.onDraw?t.onDraw(e.toGeoJSON()):this.map.fire("draw.passing-create",{features:[e.toGeoJSON()]})),this.deleteFeature([e.id],{silent:!0}),this.changeMode(pt,{},{silent:!0})):"function"==typeof t.onCancel&&t.onCancel()};const Gn={onSetup:function(){const t=this.newFeature({type:at,properties:{},geometry:{type:lt,coordinates:[[]]}});return this.addFeature(t),this.clearSelectedFeatures(),An.disable(this),this.updateUIClasses({mouse:et}),this.activateUIButton(ot),this.setActionableState({trash:!0}),{polygon:t,currentVertexPosition:0}},clickAnywhere:function(t,e){if(t.currentVertexPosition>0&&Ln(e,t.polygon.coordinates[0][t.currentVertexPosition-1]))return this.changeMode(pt,{featureIds:[t.polygon.id]});this.updateUIClasses({mouse:et}),t.polygon.updateCoordinate(`0.${t.currentVertexPosition}`,e.lngLat.lng,e.lngLat.lat),t.currentVertexPosition++,t.polygon.updateCoordinate(`0.${t.currentVertexPosition}`,e.lngLat.lng,e.lngLat.lat)},clickOnVertex:function(t){return this.changeMode(pt,{featureIds:[t.polygon.id]})},onMouseMove:function(t,e){t.polygon.updateCoordinate(`0.${t.currentVertexPosition}`,e.lngLat.lng,e.lngLat.lat),_n(e)&&this.updateUIClasses({mouse:rt})}};Gn.onTap=Gn.onClick=function(t,e){return _n(e)?this.clickOnVertex(t,e):this.clickAnywhere(t,e)},Gn.onKeyUp=function(t,e){kn(e)?(this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(pt)):Mn(e)&&this.changeMode(pt,{featureIds:[t.polygon.id]})},Gn.onStop=function(t){this.updateUIClasses({mouse:it}),An.enable(this),this.activateUIButton(),void 0!==this.getFeature(t.polygon.id)&&(t.polygon.removeCoordinate(`0.${t.currentVertexPosition}`),t.polygon.isValid()?this.map.fire(gt,{features:[t.polygon.toGeoJSON()]}):(this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(pt,{},{silent:!0})))},Gn.toDisplayFeatures=function(t,e,n){const r=e.properties.id===t.polygon.id;if(e.properties.active=r?mt:xt,!r)return n(e);if(0===e.geometry.coordinates.length)return;const i=e.geometry.coordinates[0].length;if(!(i<3)){if(e.properties.meta=yt,n(On(t.polygon.id,e.geometry.coordinates[0][0],"0.0",!1)),i>3){const r=e.geometry.coordinates[0].length-3;n(On(t.polygon.id,e.geometry.coordinates[0][r],`0.${r}`,!1))}if(i<=4){const t=[[e.geometry.coordinates[0][0][0],e.geometry.coordinates[0][0][1]],[e.geometry.coordinates[0][1][0],e.geometry.coordinates[0][1][1]]];if(n({type:at,properties:e.properties,geometry:{coordinates:t,type:ht}}),3===i)return}return n(e)}},Gn.onTrash=function(t){this.deleteFeature([t.polygon.id],{silent:!0}),this.changeMode(pt)};const{onSetup:Un,onMouseMove:Tn,...Vn}=Gn,Dn="select_feature",qn=`${Dn}_highlight`,zn={highlightColor:"#222"},Jn={};function Wn(t){return{...t,[Dn]:Jn}}Jn.onSetup=function(t){const{selectHighlightColor:e,onSelect:n,onCancel:r}=t,i={hoveredFeatureID:null,selectedFeatureID:null};i.onSelect=n,i.onCancel=r,i.api=this._ctx.api;const{selectHighlightColor:o=zn.highlightColor}=this._ctx.options;return i.options={selectHighlightColor:e||o},i},Jn.onMouseMove=function(t,e){const{api:n}=t,{featureTarget:r}=e;if(r){this.updateUIClasses({mouse:rt});const e=r.properties.id;null!==t.hoveredFeatureID&&t.hoveredFeatureID!==e&&n.setFeatureProperty(t.hoveredFeatureID,qn,void 0),t.hoveredFeatureID=e,n.setFeatureProperty(t.hoveredFeatureID,qn,t.options.selectHighlightColor)}else t.hoveredFeatureID&&n.setFeatureProperty(t.hoveredFeatureID,qn,void 0),t.hoveredFeatureID=null},Jn.onClick=function(t,e){t.selectedFeatureID=t.hoveredFeatureID,this.onStop(t,e)},Jn.toDisplayFeatures=function(t,e,n){n(e)},Jn.onKeyUp=function(t,e){kn(e)&&this.changeMode(pt)},Jn.onStop=function(t){this.updateUIClasses({mouse:it}),An.enable(this),this.activateUIButton(),t.selectedFeatureID?("function"==typeof t.onSelect?t.onSelect(t.selectedFeatureID):this.map.fire("draw.select_mode.select",{featureID:t.selectedFeatureID}),t.selectedFeatureID=null,this.changeMode(pt,{},{silent:!0})):"function"==typeof t.onCancel&&t.onCancel(),t.hoveredFeatureID&&(this._ctx.api.setFeatureProperty(t.hoveredFeatureID,qn,void 0),t.hoveredFeatureID=null)},t.Constants=En,t.default=function(t){return{...Wn(t),[xn]:jn,[mn]:Sn}},t.drawStyles=t=>t.map((t=>t.id.endsWith("inactive")?{...t,filter:[...t.filter,["!has",Pn]]}:t)).concat([{id:"split_polygon-fill-active",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["has",Pn]],paint:{"fill-color":["get",Pn],"fill-outline-color":["get",Pn],"fill-opacity":.1}},{id:"split_polygon-stroke-active",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["has",Pn]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":["get",Pn],"line-dasharray":[.2,2],"line-width":2}}]),t.splitPolygonMode=Sn,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=index.js.map
